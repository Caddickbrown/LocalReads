const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DbTFBFyd.js","assets/ui-DWrLetS6.js","assets/vendor-DnQQq7lD.js","assets/charts-CHhKfMJ9.js","assets/index-CwBU1vPS.js"])))=>i.map(i=>d[i]);
import{j as e,X as ht,B as mt,U as xt,T as ps,S as Da,F as Ia,L as Je,P as ct,a as Fa,b as Ae,C as Qe,c as Pe,d as Et,e as Ct,f as Ma,g as Ba,h as $a,i as Be,k as Ke,l as Pa,m as Ut,R as dt,D as jt,n as vt,H as zt,o as Wt,A as Bs,p as $s,q as Ps,K as Us,r as Ua}from"./ui-DWrLetS6.js";import{a as Wa,R as es,r as c}from"./vendor-DnQQq7lD.js";import{R as Ga,B as Ya,C as Va,X as Ka,Y as Ha,T as Xa,a as qa}from"./charts-CHhKfMJ9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();var Ws,bs=Wa;Ws=bs.createRoot,bs.hydrateRoot;const fs=["Book","Audiobook","Ebook","Comic","Manga","Graphic Novel","Art/Photography Book"],Gs=["To Read","Reading","Paused","Finished","Abandoned"],Ja="modulepreload",Qa=function(s){return"/"+s},ys={},Gt=function(t,a,n){let r=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),u=i?.nonce||i?.getAttribute("nonce");r=Promise.allSettled(a.map(d=>{if(d=Qa(d),d in ys)return;ys[d]=!0;const p=d.endsWith(".css"),x=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${x}`))return;const b=document.createElement("link");if(b.rel=p?"stylesheet":Ja,p||(b.as="script"),b.crossOrigin="",b.href=d,u&&b.setAttribute("nonce",u),document.head.appendChild(b),p)return new Promise((E,w)=>{b.addEventListener("load",E),b.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i}return r.then(i=>{for(const u of i||[])u.status==="rejected"&&o(u.reason);return t().catch(o)})},ws={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,sept:9,oct:10,nov:11,dec:12};function Ns(s){return String(s).padStart(2,"0")}function Za(s,t,a){if(s<1e3||s>9999||t<1||t>12||a<1||a>31||new Set([4,6,9,11]).has(t)&&a>30)return!1;if(t===2){const r=s%4===0&&(s%100!==0||s%400===0);if(a>(r?29:28))return!1}return!0}function lt(s,t,a){return Za(s,t,a)?`${s}-${Ns(t)}-${Ns(a)}`:null}function js(s){return s>=100?s:s>=70?1900+s:2e3+s}function Tt(s,t="auto"){if(!s)return null;const a=String(s).trim();if(!a)return null;const n=a.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T].*)?$/);if(n){const d=Number(n[1]),p=Number(n[2]),x=Number(n[3]);return lt(d,p,x)}const r=a.match(/^\s*(\d{4})[-\/.](\d{1,2})[-\/.](\d{1,2})\s*$/);if(r){const d=Number(r[1]),p=Number(r[2]),x=Number(r[3]);return lt(d,p,x)}const o=a.match(/^\s*(\d{1,2})[-\/.](\d{1,2})[-\/.](\d{2,4})\s*$/);if(o){const d=Number(o[1]),p=Number(o[2]);let x=Number(o[3]);x=js(x);let b,E;return d>12&&p<=12?(b=d,E=p):p>12&&d<=12?(b=p,E=d):(t==="auto"?"MDY":t)==="DMY"?(b=d,E=p):(E=d,b=p),lt(x,E,b)}const i=a.replace(/,/g," ").split(/\s+/).filter(Boolean);if(i.length>=3){const d=i.map(x=>x.toLowerCase()),p=d.findIndex(x=>ws[x]!=null);if(p>=0){const x=ws[d[p]],b=d.map(w=>Number(w)).map(w=>Number.isFinite(w)?Number(w):NaN),E=b.findIndex(w=>Number.isFinite(w)&&(w>=70||w>=1e3));if(E>=0){let w=b[E];w<100&&(w=js(w));let S=NaN;for(let T=0;T<b.length;T++){if(T===E)continue;const I=b[T];if(Number.isFinite(I)&&I>=1&&I<=31){S=I;break}}if(Number.isFinite(S))return lt(w,x,Number(S))}}}const u=new Date(a);if(!isNaN(u.getTime())){const d=u.getFullYear(),p=u.getMonth()+1,x=u.getDate();return lt(d,p,x)}return null}const Ys="localreads.datePreference";function ts(){return typeof localStorage>"u"?"auto":localStorage.getItem(Ys)||"auto"}function en(s){typeof localStorage>"u"||localStorage.setItem(Ys,s)}function tn(s,t,a,n){if(typeof t=="function"?s!==t||!n:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?n:a==="a"?n.call(s):n?n.value:t.get(s)}function sn(s,t,a,n,r){if(typeof t=="function"?s!==t||!0:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(s,a),a}var _t;const ve="__TAURI_TO_IPC_KEY__";function an(s,t=!1){return window.__TAURI_INTERNALS__.transformCallback(s,t)}async function y(s,t={},a){return window.__TAURI_INTERNALS__.invoke(s,t,a)}class nn{get rid(){return tn(this,_t,"f")}constructor(t){_t.set(this,void 0),sn(this,_t,t)}async close(){return y("plugin:resources|close",{rid:this.rid})}}_t=new WeakMap;class gt{constructor(t){this.path=t}static async load(t){const a=await y("plugin:sql|load",{db:t});return new gt(a)}static get(t){return new gt(t)}async execute(t,a){const[n,r]=await y("plugin:sql|execute",{db:this.path,query:t,values:a??[]});return{lastInsertId:r,rowsAffected:n}}async select(t,a){return await y("plugin:sql|select",{db:this.path,query:t,values:a??[]})}async close(t){return await y("plugin:sql|close",{db:t})}}var Yt;(function(s){s[s.Audio=1]="Audio",s[s.Cache=2]="Cache",s[s.Config=3]="Config",s[s.Data=4]="Data",s[s.LocalData=5]="LocalData",s[s.Document=6]="Document",s[s.Download=7]="Download",s[s.Picture=8]="Picture",s[s.Public=9]="Public",s[s.Video=10]="Video",s[s.Resource=11]="Resource",s[s.Temp=12]="Temp",s[s.AppConfig=13]="AppConfig",s[s.AppData=14]="AppData",s[s.AppLocalData=15]="AppLocalData",s[s.AppCache=16]="AppCache",s[s.AppLog=17]="AppLog",s[s.Desktop=18]="Desktop",s[s.Executable=19]="Executable",s[s.Font=20]="Font",s[s.Home=21]="Home",s[s.Runtime=22]="Runtime",s[s.Template=23]="Template"})(Yt||(Yt={}));async function Vs(){return y("plugin:path|resolve_directory",{directory:Yt.AppConfig})}async function Ks(...s){return y("plugin:path|join",{paths:s})}let Ye=null,pt=null;function rn(){const s=typeof window<"u"&&window.__TAURI_INTERNALS__!=null,t=typeof window<"u"&&window.__TAURI__!=null;return console.log("Tauri environment check:",{hasTauriInternals:s,hasTauriAPI:t,userAgent:typeof navigator<"u"?navigator.userAgent:"N/A",platform:typeof navigator<"u"?navigator.platform:"N/A"}),s||t}async function $(){if(!Ye){if(console.log("Initializing database connection..."),rn())try{const s=await ln();console.log("SQLite file location:",s),Ye=gt.load(`sqlite:${s}`),console.log("Database loaded successfully")}catch(s){console.error("Failed to resolve database path, using fallback:",s);try{Ye=gt.load("sqlite:localreads.sqlite"),console.log("Using fallback database path")}catch(t){throw console.error("Fallback database loading also failed:",t),new Error(`Failed to load database: ${t instanceof Error?t.message:"Unknown error"}`)}}else{console.warn("Tauri environment not detected, using development fallback");{const s="Database is unavailable: not running inside the Tauri app. Please use the native window (npm run tauri:dev) or the installed app.";throw console.error(s),new Error(s)}}try{console.log("Initializing database schema..."),await on(),console.log("Database initialized successfully")}catch(s){throw console.error("Failed to initialize database:",s),s}}return Ye}async function ln(){if(pt)return pt;const s=await Vs();return await Ks(s,"localreads.sqlite")}async function on(){const s=await Ye;if(!s)throw new Error("Database promise is null");await s.execute(`
    CREATE TABLE IF NOT EXISTS books (
      id TEXT PRIMARY KEY,
      title TEXT NOT NULL,
      author TEXT NOT NULL,
      series_name TEXT,
      series_number INTEGER,
      series_json TEXT,
      obtained TEXT,
      type TEXT NOT NULL DEFAULT 'Book',
      status TEXT NOT NULL DEFAULT 'To Read',
      comments TEXT,
      formats_json TEXT,
      next_up_priority BOOLEAN DEFAULT FALSE
    );

    CREATE TABLE IF NOT EXISTS tags (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT UNIQUE NOT NULL
    );

    CREATE TABLE IF NOT EXISTS book_tags (
      book_id TEXT NOT NULL,
      tag_id INTEGER NOT NULL,
      FOREIGN KEY (book_id) REFERENCES books (id) ON DELETE CASCADE,
      FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE,
      PRIMARY KEY (book_id, tag_id)
    );

    CREATE TABLE IF NOT EXISTS reads (
      id TEXT PRIMARY KEY,
      book_id TEXT NOT NULL,
      start_date TEXT,
      end_date TEXT,
      rating INTEGER,
      review TEXT,
      format TEXT,
      current_page INTEGER DEFAULT 0,
      total_pages INTEGER DEFAULT 0,
      progress_percentage INTEGER DEFAULT 0,
      FOREIGN KEY (book_id) REFERENCES books (id) ON DELETE CASCADE
    );

    CREATE TABLE IF NOT EXISTS highlights (
      id TEXT PRIMARY KEY,
      book_id TEXT NULL,
      text TEXT NOT NULL,
      created_at TEXT DEFAULT CURRENT_TIMESTAMP,
      commentary TEXT,
      source_title TEXT,
      source_author TEXT,
      FOREIGN KEY (book_id) REFERENCES books (id) ON DELETE SET NULL
    );

    CREATE TABLE IF NOT EXISTS reading_goals (
      id TEXT PRIMARY KEY,
      goal_type TEXT NOT NULL,
      target_period TEXT NOT NULL,
      target_count INTEGER NOT NULL,
      created_at TEXT DEFAULT CURRENT_TIMESTAMP
    );
  `);try{await s.execute("ALTER TABLE reads ADD COLUMN format TEXT")}catch{}try{await s.execute("ALTER TABLE highlights ADD COLUMN created_at TEXT DEFAULT CURRENT_TIMESTAMP")}catch{}try{await s.execute("ALTER TABLE reads ADD COLUMN current_page INTEGER DEFAULT 0")}catch{}try{await s.execute("ALTER TABLE reads ADD COLUMN total_pages INTEGER DEFAULT 0")}catch{}try{await s.execute("ALTER TABLE reads ADD COLUMN progress_percentage INTEGER DEFAULT 0")}catch{}try{await s.execute("ALTER TABLE books ADD COLUMN next_up_priority BOOLEAN DEFAULT FALSE")}catch{}try{await s.execute("ALTER TABLE books ADD COLUMN series_json TEXT")}catch{}try{await s.execute("ALTER TABLE books ADD COLUMN comments TEXT")}catch{}try{await s.execute("ALTER TABLE books ADD COLUMN formats_json TEXT")}catch{}try{console.log("Creating performance indexes..."),await s.execute(`
      CREATE INDEX IF NOT EXISTS idx_books_title ON books(title COLLATE NOCASE);
      CREATE INDEX IF NOT EXISTS idx_books_author ON books(author COLLATE NOCASE);
      CREATE INDEX IF NOT EXISTS idx_books_status ON books(status);
      CREATE INDEX IF NOT EXISTS idx_books_type ON books(type);
      CREATE INDEX IF NOT EXISTS idx_books_series_name ON books(series_name COLLATE NOCASE);
      CREATE INDEX IF NOT EXISTS idx_reads_book_id ON reads(book_id);
      CREATE INDEX IF NOT EXISTS idx_reads_end_date ON reads(end_date);
      CREATE INDEX IF NOT EXISTS idx_reads_start_date ON reads(start_date);
      CREATE INDEX IF NOT EXISTS idx_book_tags_book_id ON book_tags(book_id);
      CREATE INDEX IF NOT EXISTS idx_book_tags_tag_id ON book_tags(tag_id);
      CREATE INDEX IF NOT EXISTS idx_tags_name ON tags(name COLLATE NOCASE);
    `),console.log("Performance indexes created successfully")}catch(t){console.warn("Could not create performance indexes:",t)}await dn();try{const t=await s.select("SELECT COUNT(*) as count FROM books");t.length>0&&t[0].count===0&&(console.log("Database is empty, adding sample data..."),await cn(s))}catch(t){console.warn("Could not check/add sample data:",t)}}async function cn(s){try{await s.execute(`
      INSERT INTO books (id, title, author, series_name, series_number, obtained, type, status) VALUES
      ('book1', 'The Name of the Wind', 'Patrick Rothfuss', 'The Kingkiller Chronicle', 1, 'Owned', 'Book', 'Finished'),
      ('book2', 'Project Hail Mary', 'Andy Weir', NULL, NULL, 'Library', 'Audiobook', 'Finished'),
      ('book3', 'The Pragmatic Programmer', 'Andrew Hunt, David Thomas', NULL, NULL, 'Owned', 'Ebook', 'To Read'),
      ('book4', 'Atomic Habits', 'James Clear', NULL, NULL, 'Wishlist', 'Book', 'To Read'),
      ('book5', 'Dune', 'Frank Herbert', NULL, NULL, 'Borrowed', 'Book', 'Finished')
    `),await s.execute(`
      INSERT INTO tags (id, name) VALUES
      (1, 'fantasy'),
      (2, 'sci-fi'),
      (3, 'non-fiction'),
      (4, 'dev'),
      (5, 'self-help'),
      (6, 'classic'),
      (7, 'favourites')
    `),await s.execute(`
      INSERT INTO book_tags (book_id, tag_id) VALUES
      ('book1', 1), ('book1', 7),
      ('book2', 2),
      ('book3', 3), ('book3', 4),
      ('book4', 3), ('book4', 5),
      ('book5', 2), ('book5', 6)
    `),await s.execute(`
      INSERT INTO reads (id, book_id, start_date, end_date, rating) VALUES
      ('read1', 'book1', '2023-01-15', '2023-02-20', 5),
      ('read2', 'book2', '2023-03-10', '2023-04-05', 4),
      ('read5', 'book5', '2023-05-01', '2023-06-15', 5)
    `),console.log("Sample data added successfully")}catch(t){console.error("Failed to add sample data:",t)}}async function dn(){const s=await Ye;if(s)try{const t=await s.select("PRAGMA table_info(highlights)"),a=Array.isArray(t)?t.map(p=>String(p.name)):[],n=a.includes("commentary"),r=a.includes("source_title"),o=a.includes("source_author"),u=!!(Array.isArray(t)?t.find(p=>String(p.name)==="book_id"):null)?.notnull;if(n&&r&&o&&!u)return;if(!n&&r&&o&&!u){try{await s.execute("ALTER TABLE highlights ADD COLUMN commentary TEXT")}catch{}return}await s.execute("BEGIN"),await s.execute(`
      CREATE TABLE IF NOT EXISTS highlights_new (
        id TEXT PRIMARY KEY,
        book_id TEXT REFERENCES books(id) ON DELETE SET NULL,
        text TEXT NOT NULL,
        created_at TEXT DEFAULT CURRENT_TIMESTAMP,
        commentary TEXT,
        source_title TEXT,
        source_author TEXT
      );
    `);const d=`
      INSERT INTO highlights_new (id, book_id, text, created_at, commentary)
      SELECT id, book_id, text, created_at, ${n?"commentary":"NULL"} FROM highlights
    `;await s.execute(d),await s.execute("DROP TABLE highlights"),await s.execute("ALTER TABLE highlights_new RENAME TO highlights"),await s.execute("COMMIT")}catch{try{await(await $()).execute("ROLLBACK")}catch{}}}async function un(){try{if(pt)return pt;const s=await Vs();return await Ks(s,"localreads.sqlite")}catch{return"localreads.sqlite"}}async function hn(s){pt=s,Ye=null}const st=()=>Math.random().toString(36).slice(2,10);function V(s){let t=0;return s.replace(/\?/g,()=>`$${++t}`)}async function Ee(s){const t=await $(),a=[],n=[];if(s?.q){a.push("(lower(b.title) LIKE ? OR lower(b.author) LIKE ? OR lower(b.series_name) LIKE ? OR lower(b.series_json) LIKE ? OR lower(b.tags) LIKE ?)");const o=`%${s.q.toLowerCase()}%`;n.push(o,o,o,o,o)}s?.status&&s.status!=="All"&&(a.push("b.status = ?"),n.push(s.status)),s?.tag&&s.tag!=="All"&&(a.push("lower(b.tags) LIKE ?"),n.push(`%${s.tag.toLowerCase()}%`)),s?.year!=null&&(a.push("r2.end_date BETWEEN ? AND ?"),n.push(`${s.year}-01-01`,`${s.year}-12-31`));const r=`
  SELECT b.*,
         (
           SELECT COUNT(*) FROM reads r WHERE r.book_id = b.id
         ) AS reads_count,
         (
           SELECT COUNT(*) 
           FROM highlights h 
           WHERE h.book_id = b.id
         ) AS highlights_count,
         (
           SELECT json_object(
             'id', r2.id,
             'book_id', r2.book_id,
             'start_date', r2.start_date,
             'end_date', r2.end_date,
             'rating', r2.rating,
              'review', r2.review,
              'format', r2.format,
              'current_page', r2.current_page,
              'total_pages', r2.total_pages,
              'progress_percentage', r2.progress_percentage
           )
           FROM reads r2
           WHERE r2.book_id = b.id AND (r2.end_date IS NOT NULL)
           ORDER BY r2.end_date DESC
           LIMIT 1
         ) AS latest
  FROM books b
  /* Join reads only when year filter is active */
  ${s?.year!=null?"LEFT JOIN reads r2 ON r2.book_id = b.id":""}
  ${a.length?"WHERE "+a.join(" AND "):""}
  ORDER BY b.title COLLATE NOCASE ASC
  ${s?.limit?`LIMIT ${s.limit}`:""}
  ${s?.offset?`OFFSET ${s.offset}`:""};
  `;try{return(await t.select(V(r),n)).map(i=>{const u=[],d=[];try{const E=i.series_json?JSON.parse(String(i.series_json)):[];if(Array.isArray(E))for(const w of E)w&&typeof w=="object"&&w.name&&u.push({name:String(w.name),number:w.number!=null?Number(w.number):null})}catch{}try{const E=i.formats_json?JSON.parse(String(i.formats_json)):[];if(Array.isArray(E))for(const w of E)w&&typeof w=="object"&&w.format&&d.push({format:String(w.format),obtained:w.obtained!=null?String(w.obtained):null})}catch{}const p=String(i.series_name||"").trim(),x=i.series_number??null,b=u.filter(E=>!(E.name===p&&(E.number??null)===(x??null)));return{id:i.id,title:i.title,author:i.author,series_name:i.series_name,series_number:i.series_number,series:b,obtained:i.obtained,type:i.type,status:i.status,comments:i.comments??null,formats:d,next_up_priority:!!i.next_up_priority,tags:String(i.tags||""),reads_count:Number(i.reads_count||0),highlightsCount:Number(i.highlights_count||0),latest:i.latest?JSON.parse(i.latest):null}})}catch(o){console.error("Complex query failed, trying simple fallback:",o);try{const i=`
        SELECT b.*, 
               '' as tag_names,
               0 as reads_count,
               0 as highlights_count,
               NULL as latest
        FROM books b
        ${a.length?"WHERE "+a.join(" AND "):""}
        ORDER BY b.title COLLATE NOCASE ASC
        ${s?.limit?`LIMIT ${s.limit}`:""}
        ${s?.offset?`OFFSET ${s.offset}`:""}
      `;return(await t.select(V(i),n)).map(d=>({id:d.id,title:d.title,author:d.author,series_name:d.series_name,series_number:d.series_number,series:[],obtained:d.obtained,type:d.type,status:d.status,comments:d.comments??null,formats:[],next_up_priority:!!d.next_up_priority,tags:"",reads_count:0,highlightsCount:0,latest:null}))}catch(i){throw console.error("Fallback query also failed:",i),new Error(`Failed to load books: ${i instanceof Error?i.message:"Unknown error"}`)}}}async function Hs(s){const t=await $(),a=[],n=[];if(s?.q){a.push("(lower(b.title) LIKE ? OR lower(b.author) LIKE ? OR lower(b.series_name) LIKE ?)");const i=`%${s.q.toLowerCase()}%`;n.push(i,i,i)}s?.status&&s.status!=="All"&&(a.push("b.status = ?"),n.push(s.status)),s?.tag&&s.tag!=="All"&&(a.push("t.name = ?"),n.push(s.tag)),s?.year!=null&&(a.push("r2.end_date BETWEEN ? AND ?"),n.push(`${s.year}-01-01`,`${s.year}-12-31`));const r=`
  SELECT COUNT(DISTINCT b.id) as count
  FROM books b
  LEFT JOIN book_tags bt ON bt.book_id = b.id
  LEFT JOIN tags t ON t.id = bt.tag_id
  ${s?.year!=null?"LEFT JOIN reads r2 ON r2.book_id = b.id":""}
  ${a.length?"WHERE "+a.join(" AND "):""}
  `,o=await t.select(V(r),n);return Number(o[0]?.count||0)}async function Xs(s){const t=await $(),a=`%${s.toLowerCase()}%`,n=await t.select(V("SELECT DISTINCT author FROM books WHERE lower(author) LIKE ? ORDER BY author COLLATE NOCASE LIMIT 200"),[a]),r=u=>u.split(/[;,]/).map(d=>d.trim()).filter(Boolean),o=n.flatMap(u=>r(String(u.author||"")));return Array.from(new Set(o))}async function Vt(s){const t=await $(),a=`%${s.toLowerCase()}%`;return(await t.select(V("SELECT DISTINCT series_name AS name FROM books WHERE series_name IS NOT NULL AND series_name <> '' AND lower(series_name) LIKE ? ORDER BY series_name COLLATE NOCASE LIMIT 20"),[a])).map(r=>r.name).filter(Boolean)}async function qs(s){const t=await $(),a=`%${s.toLowerCase()}%`;return(await t.select(V("SELECT DISTINCT t.name FROM tags t WHERE lower(t.name) LIKE ? ORDER BY t.name COLLATE NOCASE LIMIT 20"),[a])).map(r=>r.name).filter(Boolean)}async function yt(s){console.log("upsertBook called with:",s);const t=await $();console.log("Database connection obtained");const a=s.id||st();console.log("Generated/using ID:",a);const n=V(`INSERT INTO books (id, title, author, series_name, series_number, series_json, obtained, type, status, comments, formats_json, next_up_priority, tags)
     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
     ON CONFLICT(id) DO UPDATE SET
       title=?, author=?, series_name=?, series_number=?, series_json=?, obtained=?, type=?, status=?, comments=?, formats_json=?, next_up_priority=?, tags=?`),r=[];if(s.series_name&&r.push({name:String(s.series_name),number:s.series_number??null}),s.series&&Array.isArray(s.series)&&s.series.length)for(const x of s.series)x&&x.name&&r.push({name:String(x.name),number:x.number??null});const o=new Set,i=r.filter(x=>{const b=`${x.name}::${x.number??""}`;return o.has(b)?!1:(o.add(b),!0)}),u=i.length?JSON.stringify(i.map(x=>({name:x.name,number:x.number??null}))):null,d=s.formats&&Array.isArray(s.formats)&&s.formats.length?JSON.stringify(s.formats.filter(x=>x&&x.format).map(x=>({format:x.format,obtained:x.obtained??null}))):null,p=[a,s.title,s.author,s.series_name??null,s.series_number??null,u,s.obtained??null,s.type??"Book",s.status??"To Read",s.comments??null,d,s.next_up_priority?1:0,s.tags??"",s.title,s.author,s.series_name??null,s.series_number??null,u,s.obtained??null,s.type??"Book",s.status??"To Read",s.comments??null,d,s.next_up_priority?1:0,s.tags??""];return console.log("Executing SQL:",n),console.log("With parameters:",p),await t.execute(n,p),console.log("Book upserted successfully with ID:",a),a}async function St(s){await(await $()).execute(V("DELETE FROM books WHERE id = ?"),[s])}async function Js(s,t){await(await $()).execute(V("UPDATE books SET next_up_priority = ? WHERE id = ?"),[t?1:0,s])}async function ss(s,t){const a=await $(),n=t.filter(Boolean).join(";");await a.execute(V("UPDATE books SET tags = ? WHERE id = ?"),[n,s])}async function Qs(s){const a=await(await $()).select(V(`
    SELECT tags FROM books WHERE id = ?
  `),[s]);return a.length===0||!a[0].tags?[]:String(a[0].tags).split(";").filter(Boolean)}async function at(s){const t=await $(),a=s.id||st();return await t.execute(V(`INSERT INTO reads (id, book_id, start_date, end_date, rating, review, format)
     VALUES (?, ?, ?, ?, ?, ?, ?)
     ON CONFLICT(id) DO UPDATE SET start_date=?, end_date=?, rating=?, review=?, format=?`),[a,s.book_id,s.start_date??null,s.end_date??null,s.rating??null,s.review??null,s.format??null,s.start_date??null,s.end_date??null,s.rating??null,s.review??null,s.format??null]),a}async function Kt(s){await(await $()).execute(V("DELETE FROM reads WHERE id = ?"),[s])}async function bt(s){return(await $()).select(V("SELECT * FROM reads WHERE book_id = ? ORDER BY COALESCE(end_date, start_date) DESC"),[s])}async function Zs(){const s=await $();try{const t=await s.select("PRAGMA table_info(highlights)"),a=Array.isArray(t)?t.map(p=>String(p.name)):[],n=a.includes("commentary"),r=a.includes("source_title"),o=a.includes("source_author"),u=!!(Array.isArray(t)?t.find(p=>String(p.name)==="book_id"):null)?.notnull;if(n&&r&&o&&!u)return;if(!n&&r&&o&&!u){await s.execute("ALTER TABLE highlights ADD COLUMN commentary TEXT");return}await s.execute("BEGIN"),await s.execute(`
      CREATE TABLE IF NOT EXISTS highlights_new (
        id TEXT PRIMARY KEY,
        book_id TEXT REFERENCES books(id) ON DELETE SET NULL,
        text TEXT NOT NULL,
        created_at TEXT DEFAULT CURRENT_TIMESTAMP,
        commentary TEXT,
        source_title TEXT,
        source_author TEXT
      );
    `);const d=`
      INSERT INTO highlights_new (id, book_id, text, created_at, commentary)
      SELECT id, book_id, text, created_at, ${n?"commentary":"NULL"} FROM highlights
    `;await s.execute(d),await s.execute("DROP TABLE highlights"),await s.execute("ALTER TABLE highlights_new RENAME TO highlights"),await s.execute("COMMIT")}catch{try{await(await $()).execute("ROLLBACK")}catch{}}}async function ea(s,t,a,n,r,o){await Zs();const i=await $(),u=st();return await i.execute(V("INSERT INTO highlights (id, book_id, text, created_at, commentary, source_title, source_author) VALUES (?, ?, ?, COALESCE(?, CURRENT_TIMESTAMP), ?, ?, ?)"),[u,s??null,t,a??null,n??null,r??null,o??null]),u}async function ta(s){await(await $()).execute(V("DELETE FROM highlights WHERE id = ?"),[s])}async function sa(s,t,a,n,r,o){await Zs();const i=await $(),u=["text = ?"],d=[t];a&&(u.push("created_at = ?"),d.push(a)),typeof n<"u"&&(u.push("commentary = ?"),d.push(n)),d.push(s),await i.execute(V(`UPDATE highlights SET ${u.join(", ")} WHERE id = ?`),d)}async function aa(){return(await(await $()).select(`
    SELECT strftime('%Y', end_date) AS year, COUNT(*) AS finished
    FROM reads WHERE end_date IS NOT NULL AND end_date <> ''
    GROUP BY 1 ORDER BY 1
  `)).map(a=>({year:a.year,finished:Number(a.finished)}))}async function na(s){const t=await $(),a=await t.select(V("SELECT COUNT(*) as c FROM reads WHERE end_date LIKE ?"),[`${s}-%`]),n=new Date,r=String(n.getFullYear()),o=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),u=await t.select(V("SELECT COUNT(*) as c FROM reads WHERE end_date LIKE ?"),[`${r}-${o}-%`]),d=await t.select(V("SELECT COUNT(*) as c FROM reads WHERE end_date = ?"),[`${r}-${o}-${i}`]),p=await t.select(`
    SELECT COUNT(*) as c FROM reads
    WHERE end_date IS NOT NULL AND end_date <> ''
      AND strftime('%Y', end_date) = strftime('%Y','now')
      AND strftime('%W', end_date) = strftime('%W','now')
  `),x=await t.select("SELECT COUNT(*) as c FROM books WHERE status = 'To Read'"),b=await t.select("SELECT COUNT(*) as c FROM books WHERE status = 'Reading'"),E=await t.select(`
    SELECT COUNT(*) as c FROM reads 
    WHERE end_date IS NOT NULL AND end_date <> ''
  `),w=await t.select("SELECT COUNT(*) as c FROM highlights");return{finishedThisYear:Number(a?.[0]?.c||0),finishedThisMonth:Number(u?.[0]?.c||0),finishedThisWeek:Number(p?.[0]?.c||0),finishedToday:Number(d?.[0]?.c||0),toRead:Number(x?.[0]?.c||0),reading:Number(b?.[0]?.c||0),totalFinished:Number(E?.[0]?.c||0),gemsTotal:Number(w?.[0]?.c||0)}}async function ra(s=10){const t=await $(),a=await t.select(V(`
    SELECT 
      'finished' as activity_type,
      b.title,
      b.author,
      b.series_name,
      b.series_number,
      r.end_date as activity_date,
      r.rating,
      r.review,
      b.type
    FROM reads r
    JOIN books b ON b.id = r.book_id
    WHERE r.end_date IS NOT NULL AND r.end_date <> ''
    ORDER BY r.end_date DESC
    LIMIT ?
  `),[s]),n=await t.select(V(`
    SELECT 
      'started' as activity_type,
      b.title,
      b.author,
      b.series_name,
      b.series_number,
      r.start_date as activity_date,
      NULL as rating,
      NULL as review,
      b.type
    FROM reads r
    JOIN books b ON b.id = r.book_id
    WHERE r.start_date IS NOT NULL AND r.start_date <> ''
      AND (r.end_date IS NULL OR r.end_date = '')
    ORDER BY r.start_date DESC
    LIMIT ?
  `),[s]),r=await t.select(V(`
    SELECT 
      'highlight' as activity_type,
      COALESCE(b.title, h.source_title) as title,
      COALESCE(b.author, h.source_author) as author,
      b.series_name,
      b.series_number,
      substr(h.created_at, 1, 10) as activity_date,
      NULL as rating,
      COALESCE(h.commentary, h.text) as review,
      COALESCE(b.type, 'Gem') as type
    FROM highlights h
    LEFT JOIN books b ON b.id = h.book_id
    WHERE h.created_at IS NOT NULL
    ORDER BY h.created_at DESC
    LIMIT ?
  `),[s]);return[...a.map(i=>({...i,activity_date:i.activity_date})),...n.map(i=>({...i,activity_date:i.activity_date})),...r.map(i=>({...i,activity_date:i.activity_date}))].sort((i,u)=>{const d=new Date(i.activity_date).getTime();return new Date(u.activity_date).getTime()-d}).slice(0,s)}async function Ht(s){const t=await $();let a="SELECT * FROM reading_goals";const n=[];return s&&(a+=" WHERE goal_type = ?",n.push(s)),a+=" ORDER BY target_period DESC",await t.select(V(a),n)}async function ia(s,t,a){const n=await $(),r=st();return await n.execute(V("DELETE FROM reading_goals WHERE goal_type = ? AND target_period = ?"),[s,t]),await n.execute(V(`
    INSERT INTO reading_goals (id, goal_type, target_period, target_count)
    VALUES (?, ?, ?, ?)
  `),[r,s,t,a]),{id:r,goalType:s,targetPeriod:t,targetCount:a}}async function Xt(s,t){const a=await $();let n;s==="monthly"?n=`
      SELECT COUNT(*) as completed_count
      FROM reads 
      WHERE end_date IS NOT NULL 
        AND end_date <> ''
        AND strftime('%Y-%m', end_date) = ?
    `:n=`
      SELECT COUNT(*) as completed_count
      FROM reads 
      WHERE end_date IS NOT NULL 
        AND end_date <> ''
        AND strftime('%Y', end_date) = ?
    `;const r=await a.select(V(n),[t]);return Number(r?.[0]?.completed_count??0)}async function qt(){const s=new Date,t=s.getFullYear().toString(),a=`${t}-${String(s.getMonth()+1).padStart(2,"0")}`,[n,r]=await Promise.all([Ht("monthly"),Ht("yearly")]),o=n.find(p=>p.target_period===a),i=r.find(p=>p.target_period===t),[u,d]=await Promise.all([Xt("monthly",a),Xt("yearly",t)]);return{monthly:o?{goal:o,progress:u,percentage:Math.round(u/o.target_count*100)}:null,yearly:i?{goal:i,progress:d,percentage:Math.round(d/i.target_count*100)}:null}}const la=s=>'"'+String(s).split('"').join('""')+'"';async function Jt(s){const t=["title","author","seriesNames","seriesNumbers","obtained","type","status","comments","tags","latestStart","latestEnd","latestRating","latestReview","highlightsCount"],a=s.map(n=>{const r=[];n.series_name&&r.push({name:String(n.series_name),number:n.series_number??null});let o=[];if(Array.isArray(n.series))o=n.series;else if(n.series_json)try{const x=JSON.parse(String(n.series_json));Array.isArray(x)&&(o=x.filter(b=>b&&typeof b=="object"&&b.name).map(b=>({name:String(b.name),number:b.number!=null?Number(b.number):null})))}catch{}if(Array.isArray(o))for(const x of o)x&&x.name&&r.push({name:String(x.name),number:x.number??null});const i=new Set,u=[];for(const x of r){const b=`${x.name}::${x.number??""}`;i.has(b)||(i.add(b),u.push(x))}const d=u.map(x=>x.name).join(";"),p=u.map(x=>x.number==null?"":String(x.number)).join(";");return[n.title,n.author,d,p,n.obtained??"",n.type,n.status,n.comments||"",(n.tags||[]).join(";"),n.latest?.start_date||"",n.latest?.end_date||"",n.latest?.rating??"",n.latest?.review||"",n.highlightsCount??0].map(x=>la(String(x)))});return[t.join(","),...a.map(n=>n.join(","))].join(`
`)}async function mn(s){const t=s.split(/\r?\n/).filter(Boolean),a=t.shift().split(","),n=o=>a.indexOf(o),r=ts();for(const o of t){let i=[],u="",d=!1;for(let W=0;W<o.length;W++){const B=o[W];B==='"'?d&&o[W+1]==='"'?(u+='"',W++):d=!d:B===","&&!d?(i.push(u),u=""):u+=B}i.push(u);const p=i[n("title")]||"";if(!p)continue;const x=i[n("author")]||"",b=n("seriesName")>=0&&i[n("seriesName")]||null,E=n("seriesNumber")>=0&&i[n("seriesNumber")]?Number(i[n("seriesNumber")]):null,w=n("seriesNames")>=0,S=n("seriesNumbers")>=0,T=w&&i[n("seriesNames")]||"",I=S&&i[n("seriesNumbers")]||"",N=i[n("obtained")]||null,R=i[n("type")]||"Book",h=i[n("status")]||"To Read",f=n("comments")>=0&&i[n("comments")]||null,g=(i[n("tags")]||"").split(";").filter(Boolean),L=i[n("latestStart")]||null,A=i[n("latestEnd")]||null,M=Tt(L,r)||(L&&L.includes("-")?L:null),J=Tt(A,r)||(A&&A.includes("-")?A:null),K=i[n("latestRating")]?Number(i[n("latestRating")]):null,xe=i[n("latestReview")]||null,ge=[];if(b&&ge.push({name:String(b),number:E??null}),T){const W=T.split(";").map(Z=>Z.trim()).filter(Boolean),B=I.split(";").map(Z=>Z.trim());for(let Z=0;Z<W.length;Z++){const X=W[Z],C=Z<B.length?B[Z]:"",U=C===""||isNaN(Number(C))?null:Number(C);ge.push({name:X,number:U})}}const te=new Set,he=[];for(const W of ge){const B=`${W.name}::${W.number??""}`;te.has(B)||(te.add(B),he.push({name:W.name,number:W.number??null}))}const ae=b?{name:b,number:E??null}:he[0]||null,_e=he.length>0?ae?[ae,...he.filter(W=>!(W.name===ae.name&&(W.number??null)===(ae.number??null)))]:he:[],v=Math.random().toString(36).slice(2,10);await yt({id:v,title:p,author:x,series_name:(ae?.name??null)||void 0,series_number:ae?.number??null,series:_e.length?_e:void 0,obtained:N,type:R,status:h,comments:f||void 0}),await ss(v,g),(M||J||K||xe)&&await at({id:Math.random().toString(36).slice(2,10),book_id:v,start_date:M||void 0,end_date:J||void 0,rating:K||void 0,review:xe||void 0})}}async function oa(){const s=await $(),t=await s.select("SELECT * FROM books"),a=await s.select("SELECT * FROM tags"),n=await s.select("SELECT * FROM book_tags"),r=await s.select("SELECT * FROM reads"),o=await s.select("SELECT * FROM highlights");return JSON.stringify({books:t,tags:a,book_tags:n,reads:r,highlights:o},null,2)}async function ca(s){const t=await $(),a=JSON.parse(s||"{}");await t.execute("DELETE FROM book_tags"),await t.execute("DELETE FROM tags"),await t.execute("DELETE FROM reads"),await t.execute("DELETE FROM highlights"),await t.execute("DELETE FROM books");for(const n of a.books||[])await t.execute(V("INSERT INTO books (id, title, author, series_name, series_number, series_json, obtained, type, status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)"),[n.id,n.title,n.author,n.series_name??null,n.series_number??null,n.series_json??null,n.obtained??null,n.type,n.status]);for(const n of a.tags||[])await t.execute(V("INSERT OR IGNORE INTO tags (id, name) VALUES (?, ?)"),[n.id??null,n.name]);for(const n of a.book_tags||[])await t.execute(V("INSERT INTO book_tags (book_id, tag_id) VALUES (?, ?)"),[n.book_id,n.tag_id]);for(const n of a.reads||[])await t.execute(V("INSERT INTO reads (id, book_id, start_date, end_date, rating, review, format) VALUES (?, ?, ?, ?, ?, ?, ?)"),[n.id,n.book_id,n.start_date??null,n.end_date??null,n.rating??null,n.review??null,n.format??null]);for(const n of a.highlights||[])await t.execute(V("INSERT INTO highlights (id, book_id, text, created_at) VALUES (?, ?, ?, ?)"),[n.id,n.book_id,n.text,n.created_at??null])}async function as(){const t=await(await $()).select(`
    SELECT h.id, COALESCE(b.title, h.source_title) AS book, COALESCE(b.author, h.source_author) AS author, h.text, h.created_at, h.commentary
    FROM highlights h LEFT JOIN books b ON b.id = h.book_id
    ORDER BY h.rowid DESC
  `),a=["id","book","author","text","created_at","commentary"],n=o=>'"'+String(o).split('"').join('""')+'"',r=t.map(o=>[o.id,o.book,o.author,o.text,o.created_at,o.commentary??""].map(n).join(","));return[a.join(","),...r].join(`
`)}async function da(){const t=await(await $()).select(`
    SELECT 
      r.id,
      r.book_id,
      b.title AS title,
      b.author AS author,
      r.start_date,
      r.end_date,
      r.rating,
      r.review,
      r.format,
      r.current_page,
      r.total_pages,
      r.progress_percentage
    FROM reads r
    JOIN books b ON b.id = r.book_id
    ORDER BY COALESCE(r.end_date, r.start_date) DESC, r.rowid DESC
  `),a=["id","book_id","title","author","start_date","end_date","rating","review","format","current_page","total_pages","progress_percentage"],n=t.map(r=>[r.id,r.book_id,r.title,r.author,r.start_date??"",r.end_date??"",r.rating??"",r.review??"",r.format??"",r.current_page??"",r.total_pages??"",r.progress_percentage??""].map(o=>la(String(o))).join(","));return[a.join(","),...n].join(`
`)}async function ua(s){const t=await $(),a=s.split(/\r?\n/).filter(Boolean);if(a.length===0)return;const n=a.shift().split(","),r=u=>n.indexOf(u),o=u=>r(u)>=0,i=ts();for(const u of a){let d=[],p="",x=!1;for(let A=0;A<u.length;A++){const M=u[A];M==='"'?x&&u[A+1]==='"'?(p+='"',A++):x=!x:M===","&&!x?(d.push(p),p=""):p+=M}d.push(p);const b=o("id")&&d[r("id")]?d[r("id")]:Math.random().toString(36).slice(2,10),E=o("book_id")&&d[r("book_id")]||"",w=o("title")&&d[r("title")]||"",S=o("author")&&d[r("author")]||"";let T=E;if(!T){if(!w)continue;const A=await t.select(V("SELECT id FROM books WHERE lower(title) = ? AND lower(author) = ? LIMIT 1"),[String(w).toLowerCase(),String(S).toLowerCase()]);A.length>0?T=A[0].id:(T=Math.random().toString(36).slice(2,10),await yt({id:T,title:w,author:S,type:"Book",status:"To Read"}))}const I=o("start_date")&&d[r("start_date")]||null,N=o("end_date")&&d[r("end_date")]||null,R=Tt(I,i)||(I&&I.includes("-")?I:null),h=Tt(N,i)||(N&&N.includes("-")?N:null),f=o("rating")&&d[r("rating")]?Number(d[r("rating")]):null,g=o("review")&&d[r("review")]||null,L=o("format")&&d[r("format")]||null;o("current_page")&&d[r("current_page")]&&Number(d[r("current_page")]),o("total_pages")&&d[r("total_pages")]&&Number(d[r("total_pages")]),o("progress_percentage")&&d[r("progress_percentage")]&&Number(d[r("progress_percentage")]),await at({id:b,book_id:T,start_date:R||void 0,end_date:h||void 0,rating:f??void 0,review:g??void 0,format:L??void 0})}}async function Qt(){return un()}async function ha(s){return hn(s)}async function ma(s){const t=await $(),a=s.split(/\r?\n/).filter(Boolean);if(a.length===0)return;const n=a.shift().split(","),r=i=>n.indexOf(i),o=i=>r(i)>=0;for(const i of a){let u=[],d="",p=!1;for(let R=0;R<i.length;R++){const h=i[R];h==='"'?p&&i[R+1]==='"'?(d+='"',R++):p=!p:h===","&&!p?(u.push(d),d=""):d+=h}u.push(d);const x=o("book")?u[r("book")]:o("title")?u[r("title")]:"",b=o("author")?u[r("author")]:"",E=o("text")?u[r("text")]:"",w=o("created_at")&&u[r("created_at")]||null,S=o("commentary")&&u[r("commentary")]||null;if(!x||!E)continue;const T=await t.select(V("SELECT id FROM books WHERE lower(title) = ? AND lower(author) = ? LIMIT 1"),[String(x).toLowerCase(),String(b).toLowerCase()]);let I;T.length>0?I=T[0].id:(I=st(),await yt({id:I,title:x,author:b,type:"Book",status:"To Read"}));const N=o("id")&&u[r("id")]?u[r("id")]:st();await t.execute(V("INSERT INTO highlights (id, book_id, text, created_at, commentary) VALUES (?, ?, ?, COALESCE(?, CURRENT_TIMESTAMP), ?)"),[N,I,E,w,S])}}async function xa(){const a=await(await $()).select("SELECT COUNT(*) as count FROM books WHERE status = 'To Read'");return Number(a[0]?.count||0)}async function ga(){const a=await(await $()).select(`
    SELECT COUNT(*) as count
    FROM (
      SELECT b.id
      FROM books b
      INNER JOIN reads r ON r.book_id = b.id
      GROUP BY b.id
      HAVING COUNT(r.id) > 1
    )
  `);return Number(a[0]?.count||0)}async function pa(){const s=await $(),t=new Date().getFullYear(),n=await s.select(`
    SELECT COUNT(DISTINCT b.id) as count
    FROM books b
    INNER JOIN reads r ON r.book_id = b.id
    WHERE r.end_date BETWEEN ? AND ?
  `,[`${t}-01-01`,`${t}-12-31`]);return Number(n[0]?.count||0)}async function ba(){try{const s=await $(),t=await s.select(`
      SELECT id, title, author, obtained 
      FROM books 
      WHERE obtained IS NOT NULL 
      AND obtained NOT IN ('Owned', 'Borrowed', 'Library', 'Wishlist', 'On Order')
      ORDER BY title COLLATE NOCASE ASC
    `),a=await s.select(`
      SELECT id, title, author, type 
      FROM books 
      WHERE type NOT IN ('Book', 'Audiobook', 'Ebook', 'Comic', 'Manga', 'Graphic Novel', 'Art/Photography Book')
      ORDER BY title COLLATE NOCASE ASC
    `),n=await s.select(`
      SELECT id, title, author, status 
      FROM books 
      WHERE status NOT IN ('To Read', 'Reading', 'Paused', 'Finished', 'Abandoned')
      ORDER BY title COLLATE NOCASE ASC
    `);return{nonCompliantObtained:t,nonCompliantTypes:a,nonCompliantStatuses:n}}catch(s){throw console.error("Failed to find non-compliant data:",s),s}}const xn=Object.freeze(Object.defineProperty({__proto__:null,addHighlight:ea,countBooks:Hs,countFinishedThisYear:pa,countNextUpBooks:xa,countReReads:ga,countsByYear:aa,databasePath:Qt,deleteBook:St,deleteHighlight:ta,deleteRead:Kt,exportCsvFor:Jt,exportHighlightsCsv:as,exportJson:oa,exportReadsCsv:da,findNonCompliantData:ba,getCurrentGoalStatus:qt,getGoalProgress:Xt,getReadingGoals:Ht,getRecentActivity:ra,importCsv:mn,importHighlightsCsv:ma,importJson:ca,importReadsCsv:ua,listBooks:Ee,readsForBook:bt,searchAuthors:Xs,searchSeries:Vt,searchTags:qs,setDatabasePath:ha,setReadingGoal:ia,setTagsForBook:ss,statsTiles:na,tagsForBook:Qs,toggleNextUpPriority:Js,updateHighlight:sa,upsertBook:yt,upsertRead:at},Symbol.toStringTag,{value:"Module"})),Q=({className:s="",...t})=>e.jsx("input",{...t,className:`w-full px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-950 outline-none focus:ring-2 ring-zinc-300 dark:ring-zinc-700 transition-colors ${s}`}),Ze=({className:s="",...t})=>e.jsx("textarea",{...t,className:`w-full px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-950 outline-none focus:ring-2 ring-zinc-300 dark:ring-zinc-700 transition-colors ${s}`}),_=({children:s,className:t="",variant:a="primary",size:n="md",...r})=>{const o="inline-flex items-center justify-center font-medium rounded-xl transition-all duration-200 focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",i={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"},u={primary:"bg-indigo-600 hover:bg-indigo-700 text-white focus:ring-indigo-500 shadow-sm hover:shadow btn-primary",secondary:"bg-zinc-200 hover:bg-zinc-300 dark:bg-zinc-700 dark:hover:bg-zinc-600 text-zinc-900 dark:text-zinc-100 focus:ring-zinc-500 border border-zinc-300 dark:border-zinc-600 btn-secondary",danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500 shadow-sm hover:shadow",ghost:"hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-700 dark:text-zinc-300 focus:ring-zinc-500"};return e.jsx("button",{...r,className:`${o} ${i[n]} ${u[a]} ${t}`,children:s})},we=({children:s,className:t=""})=>e.jsx("div",{className:`rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 shadow-sm card ${t}`,children:s}),Ne=({children:s,className:t=""})=>e.jsx("div",{className:`p-4 border-b border-zinc-200 dark:border-zinc-800 ${t}`,children:s}),je=({children:s,className:t=""})=>e.jsx("div",{className:`p-4 ${t}`,children:s}),G=({children:s,className:t="",variant:a="default",size:n="md"})=>{const r="inline-flex items-center rounded-full border text-xs font-medium",o={sm:"px-2 py-0.5",md:"px-2.5 py-1"},i={default:"border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300",primary:"border-indigo-300 dark:border-indigo-700 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300",secondary:"border-zinc-300 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800 text-zinc-800 dark:text-zinc-200",success:"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300",warning:"border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300",danger:"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300"};return e.jsx("span",{className:`${r} ${o[n]} ${i[a]} ${t}`,children:s})},Ve=({children:s,className:t="",...a})=>e.jsx("select",{...a,className:`w-full px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-950 outline-none focus:ring-2 ring-zinc-300 dark:ring-zinc-700 transition-colors ${t}`,children:s}),ns=({children:s,className:t="",onClick:a})=>e.jsx("div",{className:`fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-backdrop ${t}`,onClick:a,children:s}),Re=({className:s="",size:t="md"})=>{const a={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsx("div",{className:`${a[t]} border-2 border-zinc-300 border-t-indigo-600 rounded-full animate-spin ${s}`})},Ue=({icon:s,title:t,description:a,action:n,className:r="",tips:o=[],illustration:i="default"})=>{const u={books:e.jsxs("div",{className:"text-6xl mb-4 opacity-20 select-none font-mono leading-none",children:["ðŸ“š",e.jsx("br",{}),"ðŸ“– ðŸ“•"]}),search:e.jsxs("div",{className:"text-6xl mb-4 opacity-20 select-none font-mono leading-none",children:["ðŸ”",e.jsx("br",{}),"ðŸ“„ ðŸ“„"]}),highlights:e.jsxs("div",{className:"text-6xl mb-4 opacity-20 select-none font-mono leading-none",children:["âœ¨",e.jsx("br",{}),"ðŸ“ ðŸ’­"]}),dashboard:e.jsxs("div",{className:"text-6xl mb-4 opacity-20 select-none font-mono leading-none",children:["ðŸ“Š",e.jsx("br",{}),"ðŸ“ˆ ðŸ“‰"]}),default:null};return e.jsxs("div",{className:`text-center py-16 empty-state ${r}`,children:[u[i],!u[i]&&s&&e.jsx("div",{className:"mx-auto w-16 h-16 text-zinc-300 dark:text-zinc-600 mb-6 flex items-center justify-center",children:s}),e.jsx("h3",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100 mb-3",children:t}),a&&e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400 mb-6 max-w-md mx-auto leading-relaxed",children:a}),o.length>0&&e.jsxs("div",{className:"mb-8 max-w-lg mx-auto",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3",children:"ðŸ’¡ Tips:"}),e.jsx("ul",{className:"text-sm text-zinc-600 dark:text-zinc-400 space-y-2 text-left",children:o.map((d,p)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-zinc-400 mt-1",children:"â€¢"}),e.jsx("span",{children:d})]},p))})]}),n&&e.jsx("div",{className:"space-y-2",children:n})]})},gn=({checked:s,onChange:t,label:a,className:n="",size:r="md"})=>{const o={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"},i={sm:"text-sm",md:"text-base",lg:"text-lg"};return e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer ${n}`,children:[e.jsxs("div",{className:`relative ${o[r]}`,children:[e.jsx("input",{type:"checkbox",checked:s,onChange:u=>t(u.target.checked),className:"sr-only"}),e.jsx("div",{className:`
            ${o[r]} rounded border-2 transition-all duration-200
            ${s?"bg-indigo-600 border-indigo-600 dark:bg-indigo-500 dark:border-indigo-500":"bg-white border-zinc-300 dark:bg-zinc-800 dark:border-zinc-600 hover:border-indigo-400 dark:hover:border-indigo-400"}
          `,children:s&&e.jsx("svg",{className:`${o[r]} text-white absolute inset-0 p-0.5`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),a&&e.jsx("span",{className:`text-zinc-900 dark:text-zinc-100 ${i[r]} select-none`,children:a})]})},ft=({value:s,className:t="",showLabel:a=!0,size:n="md",color:r="primary"})=>{const o=Math.max(0,Math.min(100,s)),i={sm:"h-1",md:"h-2",lg:"h-3"},u={primary:"bg-indigo-600",success:"bg-green-600",warning:"bg-yellow-600",danger:"bg-red-600"};return e.jsxs("div",{className:`w-full ${t}`,children:[e.jsx("div",{className:`w-full ${i[n]} bg-zinc-200 dark:bg-zinc-700 rounded-full overflow-hidden`,children:e.jsx("div",{className:`h-full ${u[r]} transition-all duration-300 ease-out`,style:{width:`${o}%`}})}),a&&e.jsx("div",{className:"flex justify-between items-center mt-1 text-xs text-zinc-600 dark:text-zinc-400",children:e.jsxs("span",{children:[o,"% complete"]})})]})},fa=es.createContext(null),pn=({children:s})=>{const[t,a]=c.useState([]),n=c.useCallback(o=>{const i=Math.random().toString(36).slice(2),u={...o,id:i,duration:o.duration??5e3};a(d=>[...d,u]),u.duration!==1/0&&setTimeout(()=>{r(i)},u.duration)},[]),r=c.useCallback(o=>{a(i=>i.filter(u=>u.id!==o))},[]);return e.jsxs(fa.Provider,{value:{toasts:t,addToast:n,removeToast:r},children:[s,e.jsx(fn,{toasts:t,removeToast:r})]})},bn=()=>{const s=c.useContext(fa);if(!s)throw new Error("useToast must be used within a ToastProvider");return s},fn=({toasts:s,removeToast:t})=>e.jsx("div",{className:"fixed top-4 right-4 z-[9999] space-y-2 pointer-events-none",children:s.map(a=>e.jsx(yn,{toast:a,onRemove:t},a.id))}),yn=({toast:s,onRemove:t})=>{const[a,n]=c.useState(!1),[r,o]=c.useState(!1);c.useEffect(()=>{const p=setTimeout(()=>n(!0),10);return()=>clearTimeout(p)},[]);const i=()=>{o(!0),setTimeout(()=>t(s.id),200)},u=()=>{const p="pointer-events-auto transform transition-all duration-200 ease-out shadow-lg rounded-xl border p-4 max-w-sm";switch(s.type){case"success":return`${p} bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-700 text-green-800 dark:text-green-200`;case"error":return`${p} bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-700 text-red-800 dark:text-red-200`;case"warning":return`${p} bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700 text-yellow-800 dark:text-yellow-200`;case"info":return`${p} bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700 text-blue-800 dark:text-blue-200`;default:return`${p} bg-zinc-50 dark:bg-zinc-900/20 border-zinc-200 dark:border-zinc-700 text-zinc-800 dark:text-zinc-200`}},d=()=>{switch(s.type){case"success":return"âœ“";case"error":return"âœ•";case"warning":return"âš ";case"info":return"â„¹";default:return"â€¢"}};return e.jsx("div",{className:`${u()} ${a&&!r?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center text-sm font-bold",children:d()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:s.title}),s.message&&e.jsx("div",{className:"text-sm opacity-90 mt-1",children:s.message})]}),e.jsx("button",{onClick:i,className:"flex-shrink-0 w-4 h-4 opacity-60 hover:opacity-100 transition-opacity",children:"âœ•"})]})})};function rs(s,t=[]){c.useEffect(()=>{const a=n=>{const r=n.target;if(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.contentEditable==="true")return;const o=s.find(i=>{const u=i.key.toLowerCase()===n.key.toLowerCase(),d=(i.ctrlKey||!1)===n.ctrlKey,p=(i.metaKey||!1)===n.metaKey,x=(i.altKey||!1)===n.altKey,b=(i.shiftKey||!1)===n.shiftKey;return u&&d&&p&&x&&b});o&&(n.preventDefault(),o.action())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},t)}function ya({book:s,onClose:t,onSave:a}){const n=typeof window<"u"&&!!(window.__TAURI__||window.__TAURI_INTERNALS__),[r,o]=c.useState({title:"",author:"",series_name:"",series_number:null,obtained:null,type:"Book",status:"To Read",next_up_priority:!1}),[i,u]=c.useState([]),[d,p]=c.useState(""),[x,b]=c.useState({start_date:"",end_date:"",rating:void 0,review:"",format:void 0,current_page:void 0,total_pages:void 0,progress_percentage:void 0}),[E,w]=c.useState([]),[S,T]=c.useState(null),[I,N]=c.useState(!1),[R,h]=c.useState(""),[f,g]=c.useState([]),[L,A]=c.useState([]),[M,J]=c.useState([]),[K,xe]=c.useState(null),[ge,te]=c.useState([]),[he,ae]=c.useState(!1),[_e,v]=c.useState(!1),[W,B]=c.useState(!1),[Z,X]=c.useState([]),[C,U]=c.useState(!1);c.useEffect(()=>{if(s){const m=String(s.series_name||"").trim().toLowerCase(),j=s.series_number??null,z=Array.isArray(s.series)?s.series.filter(P=>{const me=String(P?.name||"").trim().toLowerCase(),De=P?.number??null;return!(me===m&&(De??null)===(j??null))}):[];o({...s,series:z});try{const P=s.formats||[];X(P)}catch{X([])}le(s.id),Oe(s.id)}},[s]),c.useEffect(()=>{ee("formats",Z)},[Z]);const le=async m=>{try{const j=await bt(m);if(w(j),j.length>0){const z=j[0];b({start_date:z.start_date||"",end_date:z.end_date||"",rating:z.rating||void 0,review:z.review||"",format:z.format||void 0,current_page:z.current_page||void 0,total_pages:z.total_pages||void 0,progress_percentage:z.progress_percentage||void 0}),T(z.id)}else T(null),b({start_date:"",end_date:"",rating:void 0,review:"",format:void 0,current_page:void 0,total_pages:void 0,progress_percentage:void 0})}catch(j){console.error("Error loading read data:",j)}},Oe=async m=>{try{const j=await Qs(m);u(j)}catch(j){console.error("Error loading tags:",j)}},ee=(m,j)=>{o(z=>({...z,[m]:j}))},[H,se]=c.useState(!1),[oe,ne]=c.useState(!1);c.useEffect(()=>{const m=setTimeout(async()=>{try{if(!H){g([]);return}const z=String(r.author||"").split(";").slice(-1)[0].trim();g(z?await Xs(z):[])}catch{}},200);return()=>clearTimeout(m)},[r.author,H]),c.useEffect(()=>{const m=setTimeout(async()=>{try{if(!oe){A([]);return}const j=(r.series_name||"").trim();A(j?await Vt(j):[])}catch{}},200);return()=>clearTimeout(m)},[r.series_name,oe]),c.useEffect(()=>{const m=setTimeout(async()=>{try{if(K==null){J([]);return}const P=((r.series||[])[K]?.name||"").trim();J(P?await Vt(P):[])}catch{}},200);return()=>clearTimeout(m)},[r.series,K]),c.useEffect(()=>{const m=setTimeout(async()=>{try{const j=d.trim();te(j?await qs(j):[])}catch{}},200);return()=>clearTimeout(m)},[d]);const re=(m,j)=>{b(z=>({...z,[m]:j}))},We=()=>{d.trim()&&!i.includes(d.trim())&&(u(m=>[...m,d.trim()]),p(""))},nt=m=>{u(j=>j.filter(z=>z!==m))},fe=async m=>{if(m.preventDefault(),h("Submittingâ€¦"),console.log("Form submitted with data:",{formData:r,tags:i,readData:x}),!r.title?.trim()||!r.author?.trim()){alert("Title and Author are required");return}N(!0);try{console.log("Attempting to save book..."),h("Saving bookâ€¦");const j=await yt(r);console.log("Book saved with ID:",j),h("Book saved. Saving tagsâ€¦"),console.log("Saving tags:",i),await ss(j,i),console.log("Tags saved successfully"),h("Tags saved."),console.log("All data saved successfully, closing dialog"),h("Saved!"),a(),window.dispatchEvent(new CustomEvent("refresh-library")),window.dispatchEvent(new CustomEvent("refresh-gems")),t()}catch(j){console.error("Error saving book:",j);const z=String(j?.message||j);h(`Error: ${z}`),z.includes("__TAURI_INTERNALS")?alert("Saving requires the Tauri runtime. Make sure you are running the desktop app window (npm run tauri:dev) or the installed app, not just the browser preview."):alert(`Error saving book: ${z}. Please try again.`)}finally{N(!1)}},He=m=>{m.key==="Enter"&&(m.preventDefault(),We())};return e.jsx(ns,{onClick:t,children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:m=>m.stopPropagation(),children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s?"Edit Book":"Add New Book"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-xl transition-colors",children:e.jsx(ht,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:fe,className:"p-6 space-y-6",noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"Title *"]}),e.jsx(Q,{value:r.title||"",onChange:m=>ee("title",m.target.value),onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),fe(m))},placeholder:"Book title",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),"Author *"]}),e.jsx(Q,{value:r.author||"",onChange:m=>ee("author",m.target.value),onFocus:()=>se(!0),onBlur:()=>setTimeout(()=>se(!1),150),onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),fe(m))},placeholder:"Author name(s); separate multiple with ;",required:!0}),e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:'Use ";" to separate multiple authors'}),f.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-2 text-xs",children:f.slice(0,6).map(m=>e.jsx("button",{type:"button",onClick:()=>{const j=String(r.author||""),z=j.split(";").map(P=>P.trim()).filter((P,me,De)=>!(me===De.length-1&&P===""));z.length===0||j.indexOf(";")===-1?ee("author",m):(z[z.length-1]=m,ee("author",z.join("; ")))},className:"px-2 py-1 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700",children:m},m))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Primary Series Name"}),e.jsx(Q,{value:r.series_name||"",onChange:m=>ee("series_name",m.target.value),onFocus:()=>ne(!0),onBlur:()=>setTimeout(()=>ne(!1),150),placeholder:"Series name (optional)"}),L.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-2 text-xs",children:L.slice(0,6).map(m=>e.jsx("button",{type:"button",onClick:()=>ee("series_name",m),className:"px-2 py-1 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700",children:m},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Primary Series Number"}),e.jsx(Q,{type:"number",min:"1",value:r.series_number||"",onChange:m=>ee("series_number",m.target.value?parseInt(m.target.value):null),placeholder:"Book number in series"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Other Series (optional)"}),e.jsxs("div",{className:"space-y-2",children:[(r.series||[]).map((m,j)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsxs("div",{className:"col-span-8",children:[e.jsx(Q,{value:m.name||"",onChange:z=>{const P=[...r.series||[]];P[j]={...P[j],name:z.target.value},ee("series",P)},onFocus:()=>{xe(j),B(!0)},onBlur:()=>setTimeout(()=>{xe(z=>z===j?null:z),B(!1)},150),placeholder:"Series name"}),W&&K===j&&M.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-2 text-xs",children:M.slice(0,6).map(z=>e.jsx("button",{type:"button",onClick:()=>{const P=[...r.series||[]];P[j]={...P[j],name:z},ee("series",P)},className:"px-2 py-1 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700",children:z},z))})]}),e.jsx("div",{className:"col-span-3",children:e.jsx(Q,{type:"number",min:"1",value:m.number??"",onChange:z=>{const P=[...r.series||[]];P[j]={...P[j],number:z.target.value?parseInt(z.target.value):null},ee("series",P)},placeholder:"#"})}),e.jsx("div",{className:"col-span-1",children:e.jsx(_,{type:"button",variant:"secondary",onClick:()=>{const z=[...r.series||[]];z.splice(j,1),ee("series",z)},children:"âœ•"})})]},j)),e.jsx(_,{type:"button",variant:"secondary",onClick:()=>{const m=[...r.series||[],{name:"",number:null}];ee("series",m)},children:"+ Add Series"})]}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:"Primary series is used for sorting; others are stored and shown on details."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsx(Ve,{className:"w-1/2",value:r.status||"To Read",onChange:m=>ee("status",m.target.value),children:Gs.map(m=>e.jsx("option",{value:m,children:m},m))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-3 text-sm font-medium",children:[e.jsx("input",{type:"checkbox",checked:r.next_up_priority||!1,onChange:m=>ee("next_up_priority",m.target.checked),className:"w-4 h-4 text-indigo-600 border-zinc-300 rounded focus:ring-indigo-500 focus:ring-2"}),e.jsx("span",{children:"â­ Mark as Next Up Priority"})]}),e.jsx("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1 ml-7",children:"Books marked as Next Up will always appear at the top of your reading queue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Formats"}),e.jsxs("div",{className:"space-y-3",children:[(Z.length?Z:[{format:r.type||"Book",obtained:r.obtained||null}]).map((m,j)=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-2/5",value:m.format||"Book",onChange:z=>{const P=[...Z],me=P[j]??{format:m.format||r.type||"Book",obtained:m.obtained??(r.obtained||null)};P[j]={...me,format:z.target.value},X(P),j===0&&ee("type",z.target.value)},children:fs.map(z=>e.jsx("option",{value:z,children:z},z))}),e.jsx("div",{className:"flex flex-wrap gap-3 text-sm ml-2",children:["Owned","Borrowed","Library","Wishlist","On Order"].map(z=>e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.obtained===z,onChange:P=>{const me=[...Z],De=me[j]??{format:m.format||r.type||"Book",obtained:m.obtained??(r.obtained||null)};me[j]={...De,obtained:P.target.checked?z:null},X(me),j===0&&ee("obtained",P.target.checked?z:null)}}),z]},z))})]}),j>0&&e.jsx(_,{type:"button",variant:"secondary",onClick:()=>{const z=[...Z];z.splice(j,1),X(z)},children:"âœ•"})]},j)),e.jsx(_,{type:"button",variant:"secondary",onClick:()=>{X(m=>[...m,{format:"Book",obtained:null}])},children:"+ Add Format"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Comments"}),e.jsx(Ze,{value:r.comments||"",placeholder:"Notes about this bookâ€¦",rows:3,onChange:m=>ee("comments",m.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4"}),"Tags"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{value:d,onChange:m=>p(m.target.value),onKeyPress:He,placeholder:"Add a tag and press Enter"}),e.jsx(_,{type:"button",onClick:We,variant:"secondary",children:"Add"})]}),ge.length>0&&e.jsxs("div",{className:"mt-2 p-3 bg-zinc-50 dark:bg-zinc-800/50 rounded-xl border border-zinc-200 dark:border-zinc-700",children:[e.jsxs("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 mb-2 flex items-center gap-1",children:[e.jsx(ps,{className:"w-3 h-3"}),"Suggested tags:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ge.slice(0,8).map((m,j)=>e.jsxs("button",{type:"button",onClick:()=>{i.includes(m)||(u(z=>[...z,m]),p(""))},disabled:i.includes(m),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105 hover:shadow-sm ${i.includes(m)?"bg-zinc-200 dark:bg-zinc-700 text-zinc-500 dark:text-zinc-400 cursor-not-allowed":"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-indigo-900/50 cursor-pointer"}`,style:{animationDelay:`${j*50}ms`,animation:"fadeInUp 0.3s ease-out forwards"},children:["#",m]},m))})]}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(m=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-200 rounded-full text-sm",children:[m,e.jsx("button",{type:"button",onClick:()=>nt(m),className:"hover:bg-indigo-200 dark:hover:bg-indigo-800 rounded-full p-0.5",children:e.jsx(ht,{className:"w-3 h-3"})})]},m))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Started Reading"}),e.jsx(Q,{type:"date",value:x.start_date||"",onChange:m=>re("start_date",m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Finished Reading"}),e.jsx(Q,{type:"date",value:x.end_date||"",onChange:m=>re("end_date",m.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Rating (1-5)"}),e.jsxs(Ve,{value:x.rating||"",onChange:m=>re("rating",m.target.value?parseInt(m.target.value):void 0),children:[e.jsx("option",{value:"",children:"No rating"}),[1,2,3,4,5].map(m=>e.jsxs("option",{value:m,children:[m," ",m===1?"star":"stars"]},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Format (optional)"}),e.jsxs(Ve,{className:"w-1/2",value:x.format||"",onChange:m=>re("format",m.target.value||void 0),children:[e.jsx("option",{value:"",children:"Same as book"}),fs.map(m=>e.jsx("option",{value:m,children:m},m))]})]})]}),(r.status==="Reading"||r.status==="Paused"||x.current_page||x.total_pages)&&e.jsxs("div",{className:"mt-4 p-3 rounded-xl border border-indigo-200 dark:border-indigo-800 bg-indigo-50 dark:bg-indigo-950",children:[e.jsx("h4",{className:"text-sm font-medium text-indigo-900 dark:text-indigo-100 mb-3",children:"Reading Progress"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Current Page"}),e.jsx(Q,{type:"number",min:"0",value:x.current_page||"",onChange:m=>{const j=parseInt(m.target.value)||0,z=x.total_pages||0,P=z>0?Math.round(j/z*100):0;re("current_page",j),re("progress_percentage",P)},placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Total Pages"}),e.jsx(Q,{type:"number",min:"1",value:x.total_pages||"",onChange:m=>{const j=parseInt(m.target.value)||0,z=x.current_page||0,P=j>0?Math.round(z/j*100):0;re("total_pages",j),re("progress_percentage",P)},placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Progress %"}),e.jsx(Q,{type:"number",min:"0",max:"100",value:x.progress_percentage||"",onChange:m=>{const j=parseInt(m.target.value)||0,z=x.total_pages||0,P=z>0?Math.round(j/100*z):0;re("progress_percentage",j),re("current_page",P)},placeholder:"0"})]})]}),(x.progress_percentage||0)>0&&e.jsx("div",{className:"mt-3",children:e.jsx(ft,{value:x.progress_percentage||0,showLabel:!1,size:"sm",color:"primary"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Review"}),e.jsx(Ze,{value:x.review||"",placeholder:"Your thoughts on this book...",rows:3,onChange:m=>re("review",m.target.value)})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(_,{type:"button",variant:"secondary",onClick:async()=>{if(!r.id&&!s?.id){alert("Save the book first before adding a read.");return}const m=r.id||s?.id,j=await at({...S?{id:S}:{},...x,book_id:m});T(j),await le(m)},children:"Save Read Entry"}),S&&e.jsx(_,{type:"button",variant:"secondary",onClick:async()=>{if(!S||!confirm("Delete this read entry?"))return;await Kt(S);const m=r.id||s?.id;await le(m)},children:"Delete Read Entry"}),e.jsx(_,{type:"button",variant:"secondary",onClick:()=>{T(null),b({start_date:"",end_date:"",rating:void 0,review:"",format:void 0})},children:"New Read Entry"})]}),E.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 mb-2",children:"Existing Reads"}),e.jsx("div",{className:"space-y-2",children:E.map(m=>e.jsx("div",{className:`p-2 rounded-xl border ${S===m.id?"border-indigo-400":"border-zinc-200 dark:border-zinc-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs",children:[m.start_date||"-"," â†’ ",m.end_date||"-",m.rating?` Â· ${m.rating}â˜…`:"",m.format?` Â· ${m.format}`:""]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",variant:"secondary",onClick:()=>{T(m.id),b({start_date:m.start_date||"",end_date:m.end_date||"",rating:m.rating||void 0,review:m.review||"",format:m.format||void 0})},children:"Edit"}),e.jsx(_,{type:"button",variant:"secondary",onClick:async()=>{if(!confirm("Delete this read entry?"))return;await Kt(m.id);const j=r.id||s?.id;await le(j)},children:"Delete"})]})]})},m.id))})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4 border-t border-zinc-200 dark:border-zinc-800",children:[!n&&e.jsx("div",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-xl px-3 py-2",children:'Saving is only available in the desktop app window. Close the browser tab and use the LocalReads window opened by "npm run tauri:dev" or the installed app.'}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(_,{type:"submit",onClick:m=>fe(m),disabled:I,className:"flex-1 flex items-center justify-center gap-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:"sm"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Da,{className:"w-4 h-4"}),s?"Update Book":"Add Book"]})}),e.jsx(_,{type:"button",variant:"secondary",onClick:t,className:"px-6",children:"Cancel"}),R&&e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 ml-2 whitespace-pre",children:R})]})]})]})]})})}function wn(s){const t=a=>a.split(/[;,]/).map(n=>n.trim().toLowerCase()).filter(Boolean).sort().join(";");return`${s.title.trim().toLowerCase()}|${t(s.author||"")}`}const Nn=({columnConfigs:s,columnVisibility:t,onToggleColumn:a})=>{const[n,r]=c.useState(!1),o=c.useRef(null);c.useEffect(()=>{const u=d=>{o.current&&!o.current.contains(d.target)&&r(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const i=Object.values(t).filter(Boolean).length;return e.jsxs("div",{className:"relative",ref:o,children:[e.jsxs(_,{variant:"secondary",size:"sm",onClick:()=>r(!n),className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"w-4 h-4"}),e.jsxs("span",{children:["Columns (",i,")"]}),e.jsx(Ct,{className:`w-4 h-4 transition-transform duration-200 ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-lg z-50",children:e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100 mb-3",children:"Show Columns"}),e.jsx("div",{className:"space-y-2",children:s.map(u=>e.jsx(gn,{checked:t[u.key],onChange:()=>!u.alwaysVisible&&a(u.key),label:u.label,size:"sm",className:`w-full ${u.alwaysVisible?"opacity-50 cursor-not-allowed":""}`},u.key))}),e.jsx("div",{className:"mt-4 pt-3 border-t border-zinc-200 dark:border-zinc-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"secondary",size:"sm",onClick:()=>{s.forEach(u=>{!u.alwaysVisible&&!t[u.key]&&a(u.key)})},className:"text-xs flex-1",children:"Show All"}),e.jsx(_,{variant:"secondary",size:"sm",onClick:()=>{s.forEach(u=>{!u.alwaysVisible&&t[u.key]!==u.defaultVisible&&a(u.key)})},className:"text-xs flex-1",children:"Reset"})]})})]})})]})};function vs({onOpenHighlights:s,onOpenDashboard:t,refreshSignal:a,globalSearch:n}){const r=n||"",[o,i]=c.useState("All"),[u,d]=c.useState("All"),[p,x]=c.useState(null),[b,E]=c.useState([]),[w,S]=c.useState([]),[T,I]=c.useState(!1),[N,R]=c.useState(null),[h,f]=c.useState("title"),[g,L]=c.useState("asc"),[A,M]=c.useState(0),[J,K]=c.useState(null),[xe,ge]=c.useState(!0),[te,he]=c.useState(1),[ae,_e]=c.useState(!0),[v,W]=c.useState(!1),[B,Z]=c.useState(0),[X,C]=c.useState(50),[U,le]=c.useState(0),[Oe,ee]=c.useState(0),[H,se]=c.useState(0),[oe,ne]=c.useState(!1),[re,We]=c.useState([]),[nt,fe]=c.useState(!1),[He,m]=c.useState(!1),[j,z]=c.useState(null),[P,me]=c.useState(!1),[De,rt]=c.useState(!1),{addToast:pe}=bn(),[Ot,Ge]=c.useState(0),os=[{key:"title",label:"Title",sortable:!0,defaultVisible:!0,alwaysVisible:!0},{key:"author",label:"Author",sortable:!0,defaultVisible:!0},{key:"series",label:"Series",sortable:!0,defaultVisible:!0},{key:"type",label:"Type",sortable:!0,defaultVisible:!0},{key:"status",label:"Status",sortable:!0,defaultVisible:!0},{key:"progress",label:"Progress",sortable:!1,defaultVisible:!0},{key:"tags",label:"Tags",sortable:!0,defaultVisible:!0},{key:"start_date",label:"Start Date",sortable:!0,defaultVisible:!1},{key:"end_date",label:"End Date",sortable:!0,defaultVisible:!1},{key:"rating",label:"Rating",sortable:!1,defaultVisible:!0},{key:"actions",label:"Actions",sortable:!1,defaultVisible:!0,alwaysVisible:!0}],[F,Ca]=c.useState(()=>{const l=localStorage.getItem("library-columns");if(l)try{return JSON.parse(l)}catch{}return os.reduce((O,k)=>(O[k.key]=k.defaultVisible,O),{})});c.useEffect(()=>{localStorage.setItem("library-columns",JSON.stringify(F))},[F]);const za=l=>{Ca(O=>({...O,[l]:!O[l]}))},cs=c.useCallback(async()=>{try{const[l,O,k]=await Promise.all([xa(),ga(),pa()]);le(l),ee(O),se(k)}catch(l){console.error("Error loading smart list counts:",l)}},[]),Xe=c.useCallback(async(l=1,O=!1)=>{l===1?ge(!0):W(!0);try{const k=(l-1)*X,D=await Ee({q:r,status:o,tag:u,year:p,limit:X,offset:k});if(O?E(Y=>[...Y,...D]):(E(D),he(1)),_e(D.length===X),l===1)try{const Y=await Hs({q:r,status:o,tag:u,year:p});Z(Y)}catch(Y){console.error("Error counting books:",Y),Z(D.length)}}catch(k){console.error("Error loading books:",k)}finally{ge(!1),W(!1)}},[r,o,u,p,X]),[Ta,La]=c.useState(r);c.useEffect(()=>{const l=setTimeout(()=>{La(r)},300);return()=>clearTimeout(l)},[r]),c.useEffect(()=>{const l=setTimeout(()=>{Xe(1,!1)},200);return()=>clearTimeout(l)},[Ta,o,u,p,a,A,Xe]),c.useEffect(()=>{cs()},[a,A,cs]);const ds=c.useCallback(()=>{if(!v&&ae){const l=te+1;he(l),Xe(l,!0)}},[v,ae,te,Xe]),us=c.useCallback(l=>{C(l),he(1),setTimeout(()=>{E([]),_e(!0),Xe(1,!1)},300)},[Xe]);c.useEffect(()=>{(async()=>{const l=Array.from(new Set(b.flatMap(O=>O.tags&&O.tags.trim()?O.tags.split(";").map(k=>k.trim()):[]))).sort();S(l)})()},[b]),c.useEffect(()=>{const l=()=>{R(null),I(!0)},O=q=>{R(q.detail),I(!0)},k=()=>{M(q=>q+1)},D=q=>{console.log("handleFilterYear called with event:",q);const de=Number(q.detail);console.log("Year extracted:",de,"isNaN:",Number.isNaN(de)),Number.isNaN(de)||(console.log("Setting year to:",de),x(de))},Y=q=>{const{type:de,value:Ce}=q.detail;d("All");const Ft={year:`ðŸ“… Finished in ${Ce}`,month:"ðŸ“† Finished this month",week:"ðŸ—“ï¸ Finished this week",day:"â­ Finished today",status:`${Ce==="To Read"?"ðŸ“š":"ðŸ‘€"} ${Ce}`};switch(K(Ft[de]||`Filter: ${de}`),de){case"year":x(Ce),i("All");break;case"month":case"week":case"day":i("Finished"),x(null);break;case"status":i(Ce),x(null);break}},ce=()=>{I(!0)},be=()=>{ne(!0),it()},ie=()=>{m(!0),Dt()};return window.addEventListener("new-book",l),window.addEventListener("edit-book",O),window.addEventListener("refresh-library",k),window.addEventListener("filter-year",D),window.addEventListener("dashboard-filter",Y),window.addEventListener("add-book",ce),window.addEventListener("show-duplicates",be),window.addEventListener("show-non-compliant",ie),()=>{window.removeEventListener("new-book",l),window.removeEventListener("edit-book",O),window.removeEventListener("refresh-library",k),window.removeEventListener("filter-year",D),window.removeEventListener("dashboard-filter",Y),window.removeEventListener("add-book",ce),window.removeEventListener("show-duplicates",be),window.removeEventListener("show-non-compliant",ie)}},[]);const it=c.useCallback(async()=>{fe(!0);try{const l=await Ee({}),O=new Map;l.forEach(D=>{const Y=wn(D);O.has(Y)||O.set(Y,[]),O.get(Y).push(D)});const k=Array.from(O.values()).filter(D=>D.length>1).sort((D,Y)=>{const ce=D[0].title.toLowerCase(),be=Y[0].title.toLowerCase();return ce!==be?ce.localeCompare(be):D[0].author.toLowerCase().localeCompare(Y[0].author.toLowerCase())});We(k)}catch(l){console.error("Error finding duplicates:",l),pe({title:"Error finding duplicates",message:"Error finding duplicates. Please try again.",type:"error"})}finally{fe(!1)}},[pe]),Dt=c.useCallback(async()=>{me(!0);try{const l=await ba();z(l)}catch(l){console.error("Error finding non-compliant data:",l),pe({title:"Error finding non-compliant data",message:"Error finding non-compliant data. Please try again.",type:"error"})}finally{me(!1)}},[pe]),It=c.useCallback(async l=>{m(!1),z(null),me(!1),rt(!0);try{const k=(await Ee({})).find(D=>D.id===l);k?(R(k),I(!0)):(rt(!1),pe({title:"Book not found",message:"Could not find the book in the database. It may have been deleted.",type:"error"}))}catch(O){rt(!1),console.error("Error fetching book data:",O),pe({title:"Error",message:"Failed to fetch book data. Please try again.",type:"error"})}},[pe]);c.useEffect(()=>{const l=O=>{O.key==="Escape"&&oe&&(ne(!1),We([]),fe(!1))};if(oe)return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[oe]),c.useEffect(()=>{const l=O=>{O.key==="Escape"&&He&&(m(!1),z(null),me(!1))};if(He)return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[He]);const hs=c.useCallback(async(l,O)=>{if(confirm(`Are you sure you want to merge these ${l.length} books? The first book will be kept and all reading history from the others will be transferred to it.`))try{const k=l[O],D=l.filter((ie,q)=>q!==O),Y=D.map(ie=>bt(ie.id)),ce=await Promise.all(Y);for(let ie=0;ie<D.length;ie++){const q=D[ie],de=ce[ie];for(const Ce of de)await at({...Ce,id:void 0,book_id:k.id})}for(const ie of D)await St(ie.id);window.dispatchEvent(new CustomEvent("refresh-library")),await it();const be=ce.reduce((ie,q)=>ie+q.length,0);pe({title:"Success",message:`Successfully merged ${D.length} duplicate books. Transferred ${be} reading records to "${k.title}".`,type:"success"})}catch(k){console.error("Error merging duplicates:",k),pe({title:"Error merging duplicates",message:`Error merging duplicates: ${k}. Please try again.`,type:"error"}),ne(!1)}},[it,pe]),Aa=c.useCallback(async()=>{if(confirm(`Are you sure you want to merge ALL ${re.length} duplicate groups? This will process ${re.reduce((l,O)=>l+O.length-1,0)} duplicate books at once.`)){fe(!0);try{let l=0,O=0,k=0;for(const D of re){if(D.length<=1)continue;const Y=D[0],ce=D.slice(1),be=ce.map(q=>bt(q.id)),ie=await Promise.all(be);for(let q=0;q<ce.length;q++){const de=ce[q],Ce=ie[q];for(const Ft of Ce)await at({...Ft,id:void 0,book_id:Y.id})}for(const q of ce)await St(q.id);l+=ce.length,O+=ie.reduce((q,de)=>q+de.length,0),k++}window.dispatchEvent(new CustomEvent("refresh-library")),await it(),pe({title:"Bulk Merge Complete!",message:`Successfully processed ${k} duplicate groups, merged ${l} books, and transferred ${O} reading records.`,type:"success",duration:8e3})}catch(l){console.error("Error in bulk merge:",l),pe({title:"Error in bulk merge",message:`Error during bulk merge: ${l}. Some books may have been processed. Please check your library.`,type:"error",duration:8e3})}finally{fe(!1)}}},[re,it,pe]),ms=new Date().getFullYear();rs([{key:"f",action:()=>{const l=document.querySelector('input[placeholder*="Search"]');l&&(l.focus(),l.select())},description:"Focus Search (Library)"},{key:"c",action:()=>{i("All"),d("All"),x(null),K(null),Ge(0),window.dispatchEvent(new CustomEvent("clear-global-search"))},description:"Clear All Filters"},{key:"1",action:()=>{i("To Read"),d("All"),x(null),K(null)},description:"Show To Read Books"},{key:"2",action:()=>{i("Reading"),d("All"),x(null),K(null)},description:"Show Currently Reading"},{key:"3",action:()=>{i("Finished"),d("All"),x(null),K(null)},description:"Show Finished Books"},{key:"4",action:()=>{i("All"),d("All"),x(ms),K(null)},description:"Show This Year"},{key:"Escape",action:()=>{i("All"),d("All"),x(null),K(null),Ge(0);const l=document.activeElement;l&&(l.tagName==="INPUT"||l.tagName==="SELECT")&&l.blur()},description:"Clear Filters & Escape"}],[r,o,u,p,ms]);const Nt=c.useMemo(()=>{let l=[...b];if(Ot){const O=k=>{const D=Math.sin(k)*1e4;return D-Math.floor(D)};for(let k=l.length-1;k>0;k--){const D=Math.floor(O(Ot+k)*(k+1));[l[k],l[D]]=[l[D],l[k]]}return l}return l.sort((O,k)=>{let D,Y;if(h==="start_date"?(D=O.latest?.start_date||"",Y=k.latest?.start_date||""):h==="end_date"?(D=O.latest?.end_date||"",Y=k.latest?.end_date||""):h==="tags"?(D=O.tags&&O.tags.trim()?O.tags.split(";").sort()[0]:"",Y=k.tags&&k.tags.trim()?k.tags.split(";").sort()[0]:""):h==="series_name"?(D=O.series_name||"",Y=k.series_name||""):(D=O[h]||"",Y=k[h]||""),D==null&&(D=""),Y==null&&(Y=""),h==="start_date"||h==="end_date"){const ce=D?new Date(D):new Date("9999-12-31"),be=Y?new Date(Y):new Date("9999-12-31");return g==="asc"?ce.getTime()-be.getTime():be.getTime()-ce.getTime()}else if(h==="series_name"){const ce=String(D).toLowerCase(),be=String(Y).toLowerCase(),ie=ce.localeCompare(be);if(ie!==0)return g==="asc"?ie:-ie;const q=O.series_number||0,de=k.series_number||0;return g==="asc"?q-de:de-q}else return D=String(D).toLowerCase(),Y=String(Y).toLowerCase(),g==="asc"?D.localeCompare(Y):Y.localeCompare(D)})},[b,h,g,Ot]),xs=l=>{R(l),I(!0)},gs=async l=>{if(confirm("Are you sure you want to delete this book? This action cannot be undone."))try{await St(l),window.dispatchEvent(new CustomEvent("refresh-library"))}catch(O){console.error("Error deleting book:",O),pe({title:"Error deleting book",message:"Error deleting book. Please try again.",type:"error"})}},Ra=()=>{I(!1),R(null),De?(rt(!1),setTimeout(()=>{m(!0),Dt()},100)):window.dispatchEvent(new CustomEvent("refresh-library"))},Oa=l=>{h===l?L(g==="asc"?"desc":"asc"):(f(l),L("asc"))},Ie=({field:l,children:O})=>e.jsxs("button",{onClick:()=>Oa(l),className:"flex items-center gap-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 px-2 py-1 rounded transition-colors",children:[O,h===l&&e.jsx("span",{className:"text-xs",children:g==="asc"?"â†‘":"â†“"})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-2",children:e.jsxs(we,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Ia,{className:"w-4 h-4"})," Filters"]})}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ve,{value:o,onChange:l=>i(l.target.value),children:[e.jsx("option",{value:"All",children:"All (status)"}),Gs.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsxs(Ve,{value:u,onChange:l=>d(l.target.value),children:[e.jsx("option",{value:"All",children:"All (tags)"}),w.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsx(_,{onClick:()=>Ge(Date.now()),variant:"secondary",size:"sm",className:"w-full justify-center",children:"ðŸŽ² Shuffle Books"}),p!==null&&e.jsxs("div",{className:"flex items-center justify-between text-xs bg-indigo-50 dark:bg-indigo-900/30 px-3 py-2 rounded-xl",children:[e.jsxs("span",{children:["Year filter: ",e.jsx("strong",{children:p})]}),e.jsx(_,{onClick:()=>x(null),variant:"secondary",size:"sm",children:"Clear"})]}),J&&e.jsxs("div",{className:"flex items-center justify-between text-xs bg-emerald-50 dark:bg-emerald-900/30 px-3 py-2 rounded-xl border border-emerald-200 dark:border-emerald-800",children:[e.jsxs("span",{children:["Dashboard filter: ",e.jsx("strong",{children:J})]}),e.jsx(_,{onClick:()=>{K(null),i("All"),d("All"),x(null)},variant:"secondary",size:"sm",children:"Clear All"})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"})," Smart Lists"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>{i("To Read"),d("All"),x(null),K(null),Ge(0)},children:e.jsxs(G,{className:"cursor-pointer badge-primary hover:scale-105 hover:shadow-lg transition-all duration-200 hover:rotate-1 hover:-translate-y-1",children:["ðŸ“š Next Up (",U,")"]})}),e.jsx("button",{onClick:()=>{i("All"),d("All"),x(new Date().getFullYear()),K(null)},children:e.jsxs(G,{className:"cursor-pointer badge-primary hover:scale-105 hover:shadow-lg transition-all duration-200 hover:-rotate-1 hover:-translate-y-1",children:["ðŸ† Finished This Year (",H,")"]})}),e.jsx("button",{onClick:()=>{i("All"),d("All"),x(null),K(null),Ge(0)},children:e.jsxs(G,{className:"cursor-pointer badge-primary hover:scale-105 hover:shadow-lg transition-all duration-200 hover:rotate-1 hover:-translate-y-1",children:["ðŸ”„ Re-reads (",Oe,")"]})})]}),(r!==""||o!=="All"||u!=="All"||p!==null)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-zinc-200 dark:border-zinc-700",children:e.jsx(_,{onClick:()=>{i("All"),d("All"),x(null),K(null),Ge(0),window.dispatchEvent(new CustomEvent("clear-global-search"))},variant:"secondary",size:"sm",className:"w-full",children:"ðŸ“– Show All Books"})})]}),e.jsx("div",{children:e.jsxs(_,{className:"w-full bg-gradient-to-br from-indigo-500 to-violet-500 text-white hover:scale-105 hover:shadow-lg hover:from-indigo-600 hover:to-violet-600 transition-all duration-200",onClick:()=>I(!0),children:[e.jsx(ct,{className:"w-4 h-4 mr-2 hover:rotate-90 transition-transform"}),"Add Book"]})})]})})]})}),e.jsx("div",{className:"col-span-12 md:col-span-10",children:e.jsxs(we,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-heading-2 flex items-center gap-2",children:[e.jsx(Fa,{className:"w-5 h-5"}),"Library (",b.length," of ",B??"..."," books)"]}),ae&&e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["Showing ",b.length," books â€¢ Load more to see all"]}),xe&&e.jsxs("div",{className:"text-sm text-indigo-600 dark:text-indigo-400 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-3 h-3 animate-spin"}),"Loading books..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Sort by:"}),e.jsxs(Ve,{value:h,onChange:l=>f(l.target.value),className:"w-40",children:[e.jsx("option",{value:"title",children:"Title"}),e.jsx("option",{value:"author",children:"Author"}),e.jsx("option",{value:"series_name",children:"Series"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"type",children:"Type"}),e.jsx("option",{value:"tags",children:"Tags"}),e.jsx("option",{value:"start_date",children:"Start Date"}),e.jsx("option",{value:"end_date",children:"End Date"})]})]}),e.jsx(Nn,{columnConfigs:os,columnVisibility:F,onToggleColumn:za})]})]})}),e.jsx(je,{className:"relative",children:e.jsxs("div",{className:"relative",children:[xe&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 mb-6 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[e.jsx(Re,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Loading your library..."})]}),!xe&&Nt.length===0&&e.jsx("div",{className:"py-12",children:e.jsx(Ue,{illustration:r||o!=="All"||u!=="All"||p!==null?"search":"books",title:r||o!=="All"||u!=="All"||p!==null?"No books found":"Welcome to LocalReads!",description:r||o!=="All"||u!=="All"||p!==null?"No books match your current search or filters. Try adjusting them to see what you're looking for.":"Your reading journey starts here. Add your first book to begin tracking your library.",tips:r||o!=="All"||u!=="All"||p!==null?["Clear your search query to see all books","Try different filter combinations","Use broader search terms","Check if you've spelled the title or author correctly"]:["Press Ctrl+N to quickly add a new book","Import your existing library using CSV files","Add tags to organize your books by genre or theme","Track multiple reads for books you revisit","Large libraries load 50 books at a time for better performance"],action:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(_,{onClick:()=>I(!0),children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),r||o!=="All"||u!=="All"||p!==null?"Add New Book":"Add Your First Book"]}),(r||o!=="All"||u!=="All"||p!==null)&&e.jsx("div",{children:e.jsx(_,{variant:"secondary",onClick:()=>{i("All"),d("All"),x(null),K(null),Ge(0),window.dispatchEvent(new CustomEvent("clear-global-search"))},children:"Clear All Filters"})})]})})}),Nt.length>0&&e.jsxs("div",{className:"transition-all duration-500",children:[xe&&e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsx(Ae,{className:"w-4 h-4 animate-spin"}),"Loading books..."]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[Nt.map((l,O)=>e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl border border-zinc-200 dark:border-zinc-700 p-4 hover:shadow-md transition-all duration-300",style:{animationDelay:`${O*30}ms`,animation:"fadeInUp 0.3s ease-out forwards"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-3",children:[e.jsx("h3",{className:"font-semibold text-lg text-zinc-900 dark:text-zinc-100 truncate hover:text-indigo-600 dark:hover:text-indigo-400 cursor-pointer",onClick:()=>xs(l),title:"Open book details",children:l.title}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400 truncate",children:l.author}),(l.series_name||l.series&&l.series.length>0)&&e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-500 truncate",title:[l.series_name&&(l.series_number!=null&&l.series_number>0?`${l.series_name} #${l.series_number}`:l.series_name),...(l.series||[]).map(k=>k.number!=null&&k.number>0?`${k.name} #${k.number}`:k.name)].filter(Boolean).join(" â€¢ "),children:[l.series_name||l.series&&l.series[0]?.name,(()=>{const k=l.series_number!=null?l.series_number:l.series&&l.series[0]?.number;return k!=null?` #${k}`:""})(),l.series&&l.series.length>0&&(l.series_name?l.series.length:Math.max(0,(l.series||[]).length-1))>0&&e.jsxs("span",{className:"ml-1 opacity-70",children:["+",l.series_name?l.series.length:l.series.length-1]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(ks,{status:l.status}),e.jsx(G,{variant:"secondary",size:"sm",children:l.type})]})]}),(l.status==="Reading"||l.status==="Paused")&&l.latest?.progress_percentage?e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Progress"}),e.jsxs("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:[l.latest.current_page||0," / ",l.latest.total_pages||0]})]}),e.jsx(ft,{value:l.latest.progress_percentage,size:"sm",showLabel:!1,color:l.status==="Reading"?"primary":"warning"})]}):null,l.tags&&l.tags.trim()&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.tags.split(";").slice(0,4).map((k,D)=>e.jsx("button",{onClick:()=>d(k.trim()),children:e.jsx(G,{variant:"primary",size:"sm",className:"hover:scale-105 transition-transform duration-200 cursor-pointer",children:k.trim()})},k)),l.tags.split(";").length>4&&e.jsxs(G,{variant:"primary",size:"sm",className:"opacity-60",children:["+",l.tags.split(";").length-4]})]})}),(l.latest?.start_date||l.latest?.end_date)&&e.jsxs("div",{className:"text-sm text-zinc-500 dark:text-zinc-400 mb-3 space-y-1",children:[l.latest?.start_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-3 h-3"}),"Started: ",l.latest.start_date]}),l.latest?.end_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-3 h-3"}),"Finished: ",l.latest.end_date]})]}),l.latest?.rating&&e.jsxs("div",{className:"flex items-center gap-1 mb-3",children:[[...Array(l.latest.rating)].map((k,D)=>e.jsx(Pe,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"},D)),e.jsxs("span",{className:"text-sm text-zinc-500 dark:text-zinc-400 ml-1",children:["(",l.latest.rating,"/5)"]})]}),e.jsx("div",{className:"flex gap-2 pt-3 border-t border-zinc-200 dark:border-zinc-700",children:e.jsx(_,{onClick:()=>gs(l.id),size:"sm",variant:"danger",className:"min-h-[44px]",children:e.jsx(Et,{className:"w-4 h-4"})})})]},l.id)),ae&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(_,{onClick:ds,disabled:v,variant:"secondary",className:"w-full max-w-md transition-all duration-300",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading more books..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Load More Books (",X,")"]})})}),v&&e.jsx("div",{className:"flex justify-center pt-4 animate-in fade-in-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsx(Ae,{className:"w-4 h-4 animate-spin"}),"Loading more books..."]})}),e.jsx("div",{className:"flex justify-center pt-4 border-t border-zinc-200 dark:border-zinc-700",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-sm w-full max-w-md",children:[e.jsx("span",{className:"text-zinc-600 dark:text-zinc-400",children:"Books per page:"}),e.jsx("div",{className:"flex gap-1 w-full",children:[50,100,200].map(l=>e.jsx("button",{onClick:()=>us(l),className:`flex-1 px-3 py-2 rounded-lg transition-all duration-200 ${X===l?"bg-indigo-500 text-white shadow-md":"bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600"}`,children:l},l))}),e.jsxs("span",{className:"text-zinc-500 dark:text-zinc-400 text-xs",children:["Total: ",B," books"]})]})})]},`mobile-${r}-${o}-${u}-${p}-${A}`),e.jsxs("div",{className:"hidden lg:block overflow-x-auto",children:[xe&&e.jsx("div",{className:"mb-6 animate-in fade-in-0",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200 dark:border-zinc-800",children:[F.title&&e.jsx("th",{className:"text-left py-3 px-2 w-80",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.author&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})}),F.series&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})}),F.type&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-12"})}),F.status&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})}),F.progress&&e.jsx("th",{className:"text-left py-3 px-2 w-32",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})}),F.tags&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-12"})}),F.start_date&&e.jsx("th",{className:"text-left py-3 px-2 w-40",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.end_date&&e.jsx("th",{className:"text-left py-3 px-2 w-40",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.rating&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-12"})}),F.actions&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})})]})}),e.jsx("tbody",{children:[...Array(3)].map((l,O)=>e.jsxs("tr",{className:"border-b border-zinc-100 dark:border-zinc-800",children:[F.title&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-48"})}),F.author&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-24"})}),F.series&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.type&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})}),F.status&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.progress&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-24"})}),F.tags&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.start_date&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.end_date&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-20"})}),F.rating&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-12"})}),F.actions&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"h-5 bg-zinc-200 dark:bg-zinc-700 rounded skeleton w-16"})})]},O))})]})}),e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200 dark:border-zinc-800",children:[F.title&&e.jsx("th",{className:"text-left py-3 px-2 w-80",children:e.jsx(Ie,{field:"title",children:"Title"})}),F.author&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx(Ie,{field:"author",children:"Author"})}),F.series&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx(Ie,{field:"series_name",children:"Series"})}),F.type&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx(Ie,{field:"type",children:"Type"})}),F.status&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx(Ie,{field:"status",children:"Status"})}),F.progress&&e.jsx("th",{className:"text-left py-3 px-2 w-32",children:"Progress"}),F.tags&&e.jsx("th",{className:"text-left py-3 px-2",children:e.jsx(Ie,{field:"tags",children:"Tags"})}),F.start_date&&e.jsx("th",{className:"text-left py-3 px-2 w-40",children:e.jsx(Ie,{field:"start_date",children:"Start Date"})}),F.end_date&&e.jsx("th",{className:"text-left py-3 px-2 w-40",children:e.jsx(Ie,{field:"end_date",children:"End Date"})}),F.rating&&e.jsx("th",{className:"text-left py-3 px-2",children:"Rating"}),F.actions&&e.jsx("th",{className:"text-left py-3 px-2",children:"Actions"})]})}),e.jsx("tbody",{children:Nt.map((l,O)=>e.jsxs("tr",{className:"border-b border-zinc-100 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-all duration-300 hover:shadow-sm hover:scale-[1.01] hover:-translate-y-0.5 group",style:{animationDelay:`${O*30}ms`,animation:"fadeInUp 0.3s ease-out forwards"},children:[F.title&&e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors cursor-pointer",onClick:()=>xs(l),title:"Open book details",children:l.title}),l.obtained&&e.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300 transition-colors",children:l.obtained})]}),F.author&&e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center gap-1 group/author hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer",children:[e.jsx(xt,{className:"w-3 h-3 text-zinc-400 group-hover/author:text-blue-500 group-hover/author:scale-110 transition-all"}),l.author]})}),F.series&&e.jsx("td",{className:"py-3 px-2",children:(l.series_name||l.series&&l.series.length>0)&&e.jsxs("div",{className:"text-sm",title:[l.series_name&&(l.series_number!=null?`${l.series_name} #${l.series_number}`:l.series_name),...(l.series||[]).map(k=>k.number!=null?`${k.name} #${k.number}`:k.name)].filter(Boolean).join(" â€¢ "),children:[l.series_name||l.series&&l.series[0]?.name,(()=>{const k=l.series_number!=null?l.series_number:l.series&&l.series[0]?.number;return k!=null&&k>0?e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 ml-1",children:["#",k]}):null})(),l.series&&l.series.length>0&&(l.series_name?l.series.length:Math.max(0,(l.series||[]).length-1))>0&&e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 ml-1",children:["+",l.series_name?l.series.length:l.series.length-1]})]})}),F.type&&e.jsx("td",{className:"py-3 px-2",children:e.jsx(G,{variant:"secondary",size:"sm",className:"hover:scale-105 transition-transform duration-200 cursor-pointer",children:l.type})}),F.status&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"hover:scale-105 transition-transform duration-200 cursor-pointer inline-block",children:e.jsx(ks,{status:l.status})})}),F.progress&&e.jsx("td",{className:"py-3 px-2",children:(l.status==="Reading"||l.status==="Paused")&&l.latest?.progress_percentage?e.jsxs("div",{className:"w-full",children:[e.jsx(ft,{value:l.latest.progress_percentage,size:"sm",showLabel:!1,color:l.status==="Reading"?"primary":"warning"}),e.jsxs("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-1",children:[l.latest.current_page||0," / ",l.latest.total_pages||0]})]}):l.status==="Finished"&&l.latest?.progress_percentage===100?e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 font-medium",children:"âœ“ Complete"}):e.jsx("div",{className:"text-xs text-zinc-400",children:"â€”"})}),F.tags&&e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.tags&&l.tags.trim()?l.tags.split(";").slice(0,3).map((k,D)=>e.jsx(G,{variant:"primary",size:"sm",className:"hover:scale-105 transition-all duration-200 cursor-pointer hover:shadow-sm",children:k.trim()},k)):null,l.tags&&l.tags.trim()&&l.tags.split(";").length>3&&e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 hover:text-zinc-700 dark:hover:text-zinc-200 transition-colors cursor-pointer",children:["+",l.tags.split(";").length-3]})]})}),F.start_date&&e.jsx("td",{className:"py-3 px-2",children:l.latest?.start_date?e.jsxs("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 flex items-center gap-1 hover:text-green-600 dark:hover:text-green-400 transition-colors cursor-pointer group/date",children:[e.jsx(Qe,{className:"w-3 h-3 text-green-500 group-hover/date:scale-110 transition-transform"}),l.latest.start_date]}):e.jsx("span",{className:"text-zinc-400 text-sm",children:"-"})}),F.end_date&&e.jsx("td",{className:"py-3 px-2",children:l.latest?.end_date?e.jsxs("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 flex items-center gap-1 hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer group/date",children:[e.jsx(Qe,{className:"w-3 h-3 text-blue-500 group-hover/date:scale-110 transition-transform"}),l.latest.end_date]}):e.jsx("span",{className:"text-zinc-400 text-sm",children:"-"})}),F.rating&&e.jsx("td",{className:"py-3 px-2",children:l.latest?.rating?e.jsxs("div",{className:"flex items-center gap-1 hover:scale-105 transition-transform cursor-pointer group/rating",children:[e.jsx(Pe,{className:"w-3 h-3 fill-yellow-400 text-yellow-400 group-hover/rating:scale-125 transition-transform"}),e.jsx("span",{className:"group-hover/rating:text-yellow-600 dark:group-hover/rating:text-yellow-300 transition-colors",children:l.latest.rating})]}):e.jsx("span",{className:"text-zinc-400 text-sm",children:"-"})}),F.actions&&e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"flex items-center gap-1 opacity-60 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx(_,{size:"sm",variant:"ghost",onClick:()=>gs(l.id),className:"p-1 hover:scale-110 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200 hover:shadow-md",title:"Delete book",children:e.jsx(Et,{className:"w-3 h-3 text-red-600 hover:text-red-700 transition-colors"})})})})]},l.id))},`${r}-${o}-${u}-${p}-${A}`)]}),ae&&e.jsx("div",{className:"flex justify-center pt-6 border-t border-zinc-200 dark:border-zinc-700",children:e.jsx(_,{onClick:ds,disabled:v,variant:"secondary",size:"lg",className:"px-8 transition-all duration-300",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading more books..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Load More Books (",X,")"]})})}),v&&e.jsx("div",{className:"flex justify-center pt-4 animate-in fade-in-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsx(Ae,{className:"w-4 h-4 animate-spin"}),"Loading more books..."]})}),e.jsx("div",{className:"flex justify-center pt-4 border-t border-zinc-200 dark:border-zinc-700",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("span",{className:"text-zinc-600 dark:text-zinc-400",children:"Books per page:"}),e.jsx("div",{className:"flex gap-1",children:[50,100,200].map(l=>e.jsx("button",{onClick:()=>us(l),className:`px-3 py-1 rounded-lg transition-all duration-200 ${X===l?"bg-indigo-500 text-white shadow-md":"bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600"}`,children:l},l))}),e.jsxs("span",{className:"text-zinc-500 dark:text-zinc-400 text-xs",children:["(Total: ",B," books)"]})]})})]})]},`content-${r}-${o}-${u}-${p}-${A}`)]})})]})})]}),T&&e.jsx(ya,{book:N,onClose:()=>{I(!1),R(null),De&&(rt(!1),setTimeout(()=>{m(!0),Dt()},100))},onSave:Ra}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:l=>{l.target===l.currentTarget&&(ne(!1),We([]),fe(!1))},children:e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-zinc-200 dark:border-zinc-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"w-6 h-6 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-heading-2 text-zinc-900 dark:text-zinc-100",children:"Duplicate Books Found"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mt-1",children:"Merge duplicates to clean up your library. The modal stays open so you can work through all groups."})]}),re.length>0&&e.jsxs(G,{variant:"primary",size:"md",children:[re.length," groups"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[re.length>0&&e.jsx(_,{onClick:Aa,disabled:nt,variant:"primary",size:"sm",className:"flex items-center gap-2",children:nt?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 animate-spin"}),"Merging..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4"}),"Merge Everything"]})}),e.jsx(_,{onClick:()=>{ne(!1),We([]),fe(!1)},variant:"secondary",size:"sm",children:"Close"})]})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:nt?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Re,{size:"lg"}),e.jsx("span",{className:"ml-3 text-zinc-600 dark:text-zinc-400",children:"Finding duplicates..."})]}):re.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-heading-3 text-zinc-900 dark:text-zinc-100 mb-2",children:"No Duplicates Found!"}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400",children:"Your library is clean and organized."})]}):e.jsx("div",{className:"space-y-6",children:re.map((l,O)=>e.jsxs("div",{className:"border border-zinc-200 dark:border-zinc-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:l[0].title}),e.jsxs(G,{variant:"warning",size:"sm",children:[l.length," duplicates"]})]}),e.jsx("div",{className:"space-y-3",children:l.map((k,D)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${D===0?"border-green-200 dark:border-green-700 bg-green-50 dark:bg-green-900/20":"border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800"}`,children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:k.title}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["by ",k.author]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(G,{variant:"secondary",size:"sm",children:k.type}),e.jsx(G,{variant:k.status==="Finished"?"success":"default",size:"sm",children:k.status}),k.series_name&&e.jsxs(G,{variant:"primary",size:"sm",children:[k.series_name,k.series_number!=null?` #${k.series_number}`:""]}),k.tags&&k.tags.trim()&&e.jsxs(G,{variant:"secondary",size:"sm",children:[k.tags.split(";").slice(0,2).join(", "),k.tags.split(";").length>2&&` +${k.tags.split(";").length-2}`]})]})]})})}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:D===0?e.jsx(G,{variant:"success",size:"sm",children:"Keep This One"}):e.jsxs(_,{onClick:()=>hs(l,D),variant:"danger",size:"sm",children:[e.jsx(Et,{className:"w-4 h-4"}),"Merge & Delete"]})})]},k.id))}),e.jsx("div",{className:"mt-4 pt-3 border-t border-zinc-200 dark:border-zinc-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsx("span",{children:"The first book (green) will be kept. All reading history from duplicates will be transferred to it. The modal will stay open to continue working with other duplicates."}),e.jsxs(_,{onClick:()=>hs(l,0),variant:"primary",size:"sm",disabled:l.length===1,children:["Merge All (",l.length-1," to merge)"]})]})})]},O))})})]})}),He&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:l=>{l.target===l.currentTarget&&(m(!1),z(null),me(!1))},children:e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-zinc-200 dark:border-zinc-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"w-6 h-6 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-heading-2 text-zinc-900 dark:text-zinc-100",children:"Data Compliance Issues Found"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mt-1",children:"Review and fix data that doesn't match predefined options. Click on any book to edit it."})]}),j&&e.jsxs(G,{variant:"warning",size:"md",children:[j.nonCompliantObtained.length+j.nonCompliantTypes.length+j.nonCompliantStatuses.length," issues"]})]}),e.jsx(_,{onClick:()=>{m(!1),z(null),me(!1)},variant:"secondary",size:"sm",children:"Close"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:P?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Re,{size:"lg"}),e.jsx("span",{className:"ml-3 text-zinc-600 dark:text-zinc-400",children:"Finding non-compliant data..."})]}):j?j.nonCompliantObtained.length===0&&j.nonCompliantTypes.length===0&&j.nonCompliantStatuses.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-heading-3 text-zinc-900 dark:text-zinc-100 mb-2",children:"No Compliance Issues Found!"}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400",children:"All your books have valid values for obtained status, book type, and reading status."})]}):e.jsxs("div",{className:"space-y-8",children:[j.nonCompliantObtained.length>0&&e.jsxs("div",{className:"border border-orange-200 dark:border-orange-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"ðŸ“š Obtained Status Issues"}),e.jsxs(G,{variant:"warning",size:"sm",children:[j.nonCompliantObtained.length," books"]})]}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-3",children:["Valid options: ",e.jsx("strong",{children:"Owned, Borrowed, Library, Wishlist, On Order"})]}),e.jsx("div",{className:"space-y-3",children:j.nonCompliantObtained.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-orange-200 dark:border-orange-700 bg-orange-50 dark:bg-orange-900/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:l.title}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["by ",l.author]}),e.jsx("div",{className:"mt-1",children:e.jsxs(G,{variant:"warning",size:"sm",children:['Current: "',l.obtained,'"']})})]}),e.jsx(_,{onClick:()=>It(l.id),variant:"primary",size:"sm",children:"Edit Book"})]},l.id))})]}),j.nonCompliantTypes.length>0&&e.jsxs("div",{className:"border border-orange-200 dark:border-orange-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"ðŸ“– Book Type Issues"}),e.jsxs(G,{variant:"warning",size:"sm",children:[j.nonCompliantTypes.length," books"]})]}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-3",children:["Valid options: ",e.jsx("strong",{children:"Book, Audiobook, Ebook, Comic, Manga, Graphic Novel, Art/Photography Book"})]}),e.jsx("div",{className:"space-y-3",children:j.nonCompliantTypes.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-orange-200 dark:border-orange-700 bg-orange-50 dark:bg-orange-900/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:l.title}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["by ",l.author]}),e.jsx("div",{className:"mt-1",children:e.jsxs(G,{variant:"warning",size:"sm",children:['Current: "',l.type,'"']})})]}),e.jsx(_,{onClick:()=>It(l.id),variant:"primary",size:"sm",children:"Edit Book"})]},l.id))})]}),j.nonCompliantStatuses.length>0&&e.jsxs("div",{className:"border border-orange-200 dark:border-orange-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("h4",{className:"text-heading-4 text-zinc-900 dark:text-zinc-100",children:"ðŸ“– Reading Status Issues"}),e.jsxs(G,{variant:"warning",size:"sm",children:[j.nonCompliantStatuses.length," books"]})]}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-3",children:["Valid options: ",e.jsx("strong",{children:"To Read, Reading, Paused, Finished, Abandoned"})]}),e.jsx("div",{className:"space-y-3",children:j.nonCompliantStatuses.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-orange-200 dark:border-orange-700 bg-orange-50 dark:bg-orange-900/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-zinc-900 dark:text-zinc-100",children:l.title}),e.jsxs("div",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:["by ",l.author]}),e.jsx("div",{className:"mt-1",children:e.jsxs(G,{variant:"warning",size:"sm",children:['Current: "',l.status,'"']})})]}),e.jsx(_,{onClick:()=>It(l.id),variant:"primary",size:"sm",children:"Edit Book"})]},l.id))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"â“"}),e.jsx("h3",{className:"text-heading-3 text-zinc-900 dark:text-zinc-100 mb-2",children:"No Data Loaded"}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400",children:"Something went wrong loading the data."})]})})]})})]})}const ks=({status:s})=>{const t=a=>{switch(a){case"To Read":return"default";case"Reading":return"primary";case"Paused":return"warning";case"Finished":return"success";case"Abandoned":return"danger";default:return"default"}};return e.jsx(G,{variant:t(s),size:"sm",children:s})};function Es({onBack:s,onYearClick:t}){const[a,n]=c.useState([]),[r,o]=c.useState({finishedThisYear:0,toRead:0,reading:0,totalFinished:0}),[i,u]=c.useState([]),[d,p]=c.useState({monthly:null,yearly:null}),[x,b]=c.useState(!0),[E,w]=c.useState(!0),[S,T]=c.useState(null),[I,N]=c.useState(""),R=new Date().getFullYear();c.useEffect(()=>{(async()=>{b(!0),w(!0);try{const[g,L,A,M]=await Promise.all([aa(),na(R),ra(8),qt()]);n(g),o(L),u(A),p(M)}finally{b(!1),w(!1)}})()},[]);const h=(g,L)=>{s(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("dashboard-filter",{detail:{type:g,value:L}}))},100)},f=async g=>{const L=parseInt(I);if(!L||L<=0)return;const A=new Date,M=g==="monthly"?`${A.getFullYear()}-${String(A.getMonth()+1).padStart(2,"0")}`:A.getFullYear().toString();try{await ia(g,M,L);const J=await qt();p(J),T(null),N("")}catch(J){console.error("Failed to set goal:",J)}};return e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs(we,{className:"col-span-12",children:[e.jsxs(Ne,{children:[e.jsxs("h2",{className:"dashboard-title flex items-center gap-2",children:[e.jsx(Ba,{className:"w-5 h-5"})," Dashboard & Stats"]}),e.jsx("p",{className:"dashboard-subtitle",children:"Click any tile to filter your library"})]}),e.jsx(je,{children:x?e.jsx("div",{className:"grid grid-cols-12 gap-4",children:[...Array(7)].map((g,L)=>e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsx("div",{className:"p-6 dashboard-stat rounded-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Re,{size:"md"})})})},L))}):e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx(Fe,{label:"Finished this year",value:r.finishedThisYear,onClick:()=>h("year",R),icon:"ðŸ“…"}),e.jsx(Fe,{label:"Finished this month",value:r.finishedThisMonth||0,onClick:()=>h("month","current"),icon:"ðŸ“†"}),e.jsx(Fe,{label:"Finished this week",value:r.finishedThisWeek||0,onClick:()=>h("week","current"),icon:"ðŸ—“ï¸"}),e.jsx(Fe,{label:"Finished today",value:r.finishedToday||0,onClick:()=>h("day","current"),icon:"â­"}),e.jsx(Fe,{label:"To Read",value:r.toRead,onClick:()=>h("status","To Read"),icon:"ðŸ“š"}),e.jsx(Fe,{label:"Reading now",value:r.reading,onClick:()=>h("status","Reading"),icon:"ðŸ‘€"}),e.jsx(Fe,{label:"Total Finished",value:r.totalFinished,onClick:()=>h("status","Finished"),icon:"ðŸ†"}),e.jsx(Fe,{label:"Gems total",value:r.gemsTotal||0,onClick:()=>h("gems"),icon:"âœ¨"}),e.jsxs(we,{className:"col-span-12",children:[e.jsxs(Ne,{children:[e.jsx("h3",{className:"text-heading-2 flex items-center gap-2",children:"ðŸŽ¯ Reading Goals"}),e.jsx("p",{className:"text-body-small text-zinc-600 dark:text-zinc-400",children:"Set and track your monthly and yearly reading targets"})]}),e.jsx(je,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-zinc-700 dark:text-zinc-300",children:"This Month"}),d.monthly?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:[d.monthly.progress," / ",d.monthly.goal.target_count," books"]}),e.jsxs("span",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:[d.monthly.percentage,"%"]})]}),e.jsx(ft,{value:d.monthly.percentage,size:"md",showLabel:!1,color:d.monthly.percentage>=100?"success":d.monthly.percentage>=75?"primary":"warning"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:d.monthly.percentage>=100?"ðŸŽ‰ Goal achieved!":`${d.monthly.goal.target_count-d.monthly.progress} books to go`}),e.jsx(_,{size:"sm",variant:"secondary",onClick:()=>{T("monthly"),N(d.monthly.goal.target_count.toString())},children:"Edit Goal"})]})]}):S==="monthly"?e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{type:"number",min:"1",placeholder:"Books per month",value:I,onChange:g=>N(g.target.value),className:"flex-1"}),e.jsx(_,{onClick:()=>f("monthly"),children:"Set Goal"}),e.jsx(_,{variant:"secondary",onClick:()=>{T(null),N("")},children:"Cancel"})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-zinc-400 text-sm mb-3",children:"ðŸ“… No monthly goal set"}),e.jsx(_,{onClick:()=>T("monthly"),children:"Set Monthly Goal"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-zinc-700 dark:text-zinc-300",children:"This Year"}),d.yearly?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:[d.yearly.progress," / ",d.yearly.goal.target_count," books"]}),e.jsxs("span",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:[d.yearly.percentage,"%"]})]}),e.jsx(ft,{value:d.yearly.percentage,size:"md",showLabel:!1,color:d.yearly.percentage>=100?"success":d.yearly.percentage>=75?"primary":"warning"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:d.yearly.percentage>=100?"ðŸŽ‰ Goal achieved!":`${d.yearly.goal.target_count-d.yearly.progress} books to go`}),e.jsx(_,{size:"sm",variant:"secondary",onClick:()=>{T("yearly"),N(d.yearly.goal.target_count.toString())},children:"Edit Goal"})]})]}):S==="yearly"?e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{type:"number",min:"1",placeholder:"Books per year",value:I,onChange:g=>N(g.target.value),className:"flex-1"}),e.jsx(_,{onClick:()=>f("yearly"),children:"Set Goal"}),e.jsx(_,{variant:"secondary",onClick:()=>{T(null),N("")},children:"Cancel"})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-zinc-400 text-sm mb-3",children:"ðŸ—“ï¸ No yearly goal set"}),e.jsx(_,{onClick:()=>T("yearly"),children:"Set Yearly Goal"})]})]})]})})]}),e.jsxs(we,{className:"col-span-12",children:[e.jsxs(Ne,{children:[e.jsx("h3",{className:"font-semibold flex items-center gap-2",children:"ðŸ“ Recent Activity"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Your latest reading milestones and highlights"})]}),e.jsx(je,{children:i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-zinc-400 text-sm",children:"ðŸ“š No recent activity yet"}),e.jsx("div",{className:"text-xs text-zinc-500 mt-2",children:"Start reading and adding highlights to see your activity here"})]}):e.jsx("div",{className:"space-y-3",children:i.map((g,L)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-zinc-50 dark:bg-zinc-800/50 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:[e.jsxs("div",{className:"flex-shrink-0 mt-1",children:[g.activity_type==="finished"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 text-sm",children:"âœ“"})}),g.activity_type==="started"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 text-sm",children:"ðŸ“–"})}),g.activity_type==="highlight"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center",children:e.jsx("span",{className:"text-yellow-600 dark:text-yellow-400 text-sm",children:"âœ¨"})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100",children:[g.activity_type==="finished"&&"Finished reading",g.activity_type==="started"&&"Started reading",g.activity_type==="highlight"&&"Added highlight to"," ",e.jsx("span",{className:"font-semibold",children:g.title})]}),e.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:["by ",g.author,g.series_name&&` â€¢ ${g.series_name}`,g.series_number!=null?` #${g.series_number}`:""]}),g.activity_type==="finished"&&g.rating&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[[...Array(g.rating)].map((A,M)=>e.jsx("span",{className:"text-yellow-400 text-xs",children:"â˜…"},M)),e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 ml-1",children:[g.rating,"/5"]})]}),g.activity_type==="highlight"&&g.review&&e.jsxs("div",{className:"mt-1 text-xs text-zinc-600 dark:text-zinc-400 italic",children:['"',g.review.length>100?g.review.substring(0,100)+"...":g.review,'"']})]}),e.jsxs("div",{className:"flex flex-col items-end ml-2",children:[e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:new Date(g.activity_date).toLocaleDateString()}),e.jsx("span",{className:"text-xs text-zinc-400 dark:text-zinc-500",children:g.type})]})]})})]},L))})})]})]})})]}),e.jsxs(we,{className:"col-span-12",children:[e.jsx(Ne,{children:e.jsx("div",{className:"text-heading-3",children:"Books Finished per Year (click a bar)"})}),e.jsx(je,{children:E?e.jsxs("div",{className:"flex flex-col items-center justify-center h-72",children:[e.jsx(Re,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Loading reading statistics..."})]}):a.length===0?e.jsx(Ue,{illustration:"dashboard",title:"No reading data yet",description:"Start tracking your reading by adding books and marking them as finished. Your reading statistics will appear here as you build your library.",tips:["Add books to your library and mark them as 'Finished'","Set reading dates to track your progress over time","Use the Dashboard tiles to filter your library view","Your yearly progress will display here"],action:e.jsx(_,{onClick:s,children:"Go to Library"})}):e.jsx("div",{className:"w-full h-72",children:e.jsx(Ga,{width:"100%",height:"100%",children:e.jsxs(Ya,{data:a,children:[e.jsx(Va,{strokeDasharray:"3 3"}),e.jsx(Ka,{dataKey:"year"}),e.jsx(Ha,{allowDecimals:!1}),e.jsx(Xa,{}),e.jsx(qa,{dataKey:"finished",fill:"#6366f1",onClick:(g,L)=>{if(console.log("Bar clicked with data:",g),console.log("Index:",L),console.log("Bars data:",a),L>=0&&L<a.length){const A=Number(a[L].year);console.log("Year from bars array:",A),isNaN(A)?console.log("Invalid year from bars array"):(console.log("Calling onYearClick with year:",A),t(A))}else console.log("Invalid index:",L)}})]})})})})]})]})}function Fe({label:s,value:t,onClick:a,icon:n}){return e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsxs("div",{className:`p-6 dashboard-stat rounded-2xl transition-all duration-300 ${a?"cursor-pointer hover:scale-105 hover:shadow-xl hover:-translate-y-2 hover:rotate-1 group":""}`,onClick:a,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"stat-number group-hover:text-white transition-colors",children:t}),n&&e.jsx("span",{className:"text-2xl opacity-80 group-hover:scale-125 group-hover:rotate-12 transition-all duration-300",children:n})]}),e.jsx("div",{className:"stat-label opacity-90 group-hover:opacity-100 transition-opacity",children:s})]})})}async function ot(s={}){return typeof s=="object"&&Object.freeze(s),await y("plugin:dialog|open",{options:s})}async function Te(s={}){return typeof s=="object"&&Object.freeze(s),await y("plugin:dialog|save",{options:s})}var _s;(function(s){s[s.Start=0]="Start",s[s.Current=1]="Current",s[s.End=2]="End"})(_s||(_s={}));async function kt(s,t){if(s instanceof URL&&s.protocol!=="file:")throw new TypeError("Must be a file URL.");const a=await y("plugin:fs|read_text_file",{path:s instanceof URL?s.toString():s,options:t}),n=a instanceof ArrayBuffer?a:Uint8Array.from(a);return new TextDecoder().decode(n)}async function Le(s,t,a){if(s instanceof URL&&s.protocol!=="file:")throw new TypeError("Must be a file URL.");const n=new TextEncoder;await y("plugin:fs|write_text_file",n.encode(t),{headers:{path:encodeURIComponent(s instanceof URL?s.toString():s),options:JSON.stringify(a)}})}function Ss({onBack:s}){const[t,a]=c.useState([]),[n,r]=c.useState(""),[o,i]=c.useState(""),[u,d]=c.useState(""),[p,x]=c.useState(""),[b,E]=c.useState(""),[w,S]=c.useState(""),[T,I]=c.useState(""),[N,R]=c.useState(""),[h,f]=c.useState([]),[g,L]=c.useState(""),[A,M]=c.useState(""),[J,K]=c.useState(""),[xe,ge]=c.useState(!0),[te,he]=c.useState(""),[ae,_e]=c.useState("all");c.useEffect(()=>{(async()=>{ge(!0);try{const C=await $(),U=await C.select(`
        SELECT h.id, COALESCE(b.title, h.source_title) AS book, COALESCE(b.author, h.source_author) AS author, h.text, h.created_at, h.commentary
        FROM highlights h LEFT JOIN books b ON b.id = h.book_id
        ORDER BY h.rowid DESC
      `);a(U);const le=await C.select("SELECT id, title, author FROM books ORDER BY title COLLATE NOCASE");f(le)}finally{ge(!1)}})()},[]);const v=async()=>{if(!b.trim())return;await ea(g||null,b.trim(),w||void 0,T||void 0,A||null,J||null),E(""),S(""),I(""),L(""),M(""),K("");const le=await(await $()).select(`
      SELECT h.id, COALESCE(b.title, h.source_title) AS book, COALESCE(b.author, h.source_author) AS author, h.text, h.created_at, h.commentary
      FROM highlights h 
      LEFT JOIN books b ON b.id = h.book_id
      ORDER BY h.rowid DESC
    `);a(le)},W=async C=>{await ta(C);const le=await(await $()).select(`
      SELECT h.id, COALESCE(b.title, h.source_title) AS book, COALESCE(b.author, h.source_author) AS author, h.text, h.created_at, h.commentary
      FROM highlights h LEFT JOIN books b ON b.id = h.book_id
      ORDER BY h.rowid DESC
    `);a(le)},B=(C,U,le,Oe)=>{r(C),i(U),d(le?le.substring(0,10):""),x(Oe||"")},Z=async()=>{if(!n)return;await sa(n,o,u||void 0,p),r(""),i(""),d(""),x("");const U=await(await $()).select(`
      SELECT h.id, COALESCE(b.title, h.source_title) AS book, COALESCE(b.author, h.source_author) AS author, h.text, h.created_at, h.commentary
      FROM highlights h LEFT JOIN books b ON b.id = h.book_id
      ORDER BY h.rowid DESC
    `);a(U)},X=c.useMemo(()=>{if(!te.trim())return t;const C=te.toLowerCase();return t.filter(U=>{switch(ae){case"book":return U.book.toLowerCase().includes(C);case"author":return U.author.toLowerCase().includes(C);case"text":return U.text.toLowerCase().includes(C);case"all":default:return U.book.toLowerCase().includes(C)||U.author.toLowerCase().includes(C)||U.text.toLowerCase().includes(C)}})},[t,te,ae]);return e.jsxs(we,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-heading-2 flex items-center gap-2",children:[e.jsx($a,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})," Gems (",X.length,X.length!==t.length?` of ${t.length}`:"",")"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(_,{onClick:async()=>{try{console.log("Starting gems export from Highlights view...");const C=await as();console.log("Generated gems CSV length:",C.length);const U=await Te({title:"Export Gems CSV",defaultPath:"gems.csv",filters:[{name:"CSV",extensions:["csv"]}]});console.log("Selected gems file path:",U),U?(await Le(U,C),console.log("Gems file written successfully"),alert("Gems CSV exported successfully!")):console.log("No file path selected")}catch(C){console.error("Gems export failed:",C),alert(`Gems export failed: ${C}`)}},className:"flex items-center gap-2 w-24",children:[e.jsx(Be,{className:"w-4 h-4"})," Export"]})})]})}),e.jsxs(je,{children:[e.jsxs("div",{className:"mb-4 p-3 rounded-xl border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(Q,{placeholder:"Search book...",value:N,onChange:C=>R(C.target.value)}),e.jsxs("select",{className:"mt-2 w-full px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-950",value:g,onChange:C=>L(C.target.value),children:[e.jsx("option",{value:"",children:"Select a bookâ€¦"}),h.filter(C=>(C.title+" "+C.author).toLowerCase().includes(N.toLowerCase())).map(C=>e.jsxs("option",{value:C.id,children:[C.title," â€” ",C.author]},C.id))]}),e.jsx("div",{className:"text-xs opacity-70 mt-2",children:"Or specify an alternate source (won't create a book):"}),e.jsx(Q,{className:"mt-2",placeholder:"Source title (article, talk, etc.)",value:A,onChange:C=>M(C.target.value)}),e.jsx(Q,{className:"mt-2",placeholder:"Source author (optional)",value:J,onChange:C=>K(C.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Ze,{rows:3,placeholder:"Gem textâ€¦",value:b,onChange:C=>E(C.target.value)}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Date (optional)"}),e.jsx(Q,{type:"date",value:w,onChange:C=>S(C.target.value)})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Commentary (optional)"}),e.jsx(Ze,{rows:2,placeholder:"Why this gem mattersâ€¦",value:T,onChange:C=>I(C.target.value)})]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(_,{onClick:v,className:"flex items-center gap-2 w-28",children:[e.jsx(ct,{className:"w-4 h-4"})," Add Gem"]})})]}),e.jsxs("div",{className:"mb-4 p-3 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-950",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ke,{className:"w-4 h-4 text-zinc-500"}),e.jsx("h3",{className:"font-medium text-sm",children:"Search Gems"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2 relative",children:[e.jsx(Q,{placeholder:"Search in gems...",value:te,onChange:C=>he(C.target.value),className:"pr-8"}),te&&e.jsx("button",{onClick:()=>he(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600 transition-colors",children:e.jsx(ht,{className:"w-4 h-4"})})]}),e.jsxs("select",{value:ae,onChange:C=>_e(C.target.value),className:"px-3 py-2 rounded-xl border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-950 text-sm",children:[e.jsx("option",{value:"all",children:"Search All"}),e.jsx("option",{value:"book",children:"Book Title"}),e.jsx("option",{value:"author",children:"Author"}),e.jsx("option",{value:"text",children:"Gem Text"})]}),e.jsx("div",{className:"text-xs text-zinc-500 flex items-center",children:te&&`${X.length} result${X.length!==1?"s":""}`})]})]}),xe?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Re,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Loading your gems..."})]}):X.length===0?t.length===0?e.jsx(Ue,{illustration:"highlights",title:"No gems yet",description:"Start capturing memorable quotes, notes, and ideas from your books. Gems help you remember and revisit your favorite moments.",tips:["Add gems from the form above","Copy and paste interesting passages or notes from your books","Include context or personal notes","Export your gems as CSV for backup"],action:e.jsxs(_,{onClick:()=>{const C=document.querySelector('textarea[placeholder*="Gem text"]');C&&C.focus()},children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Add Your First Gem"]})}):e.jsx(Ue,{illustration:"search",title:"No matching gems",description:`No gems match "${te}" in ${ae==="all"?"any field":ae}.`,tips:["Try adjusting your search query","Use different filter options","Check spelling and try broader terms","Clear search to see all gems"],action:e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{onClick:()=>he(""),variant:"secondary",children:"Clear Search"}),e.jsxs(_,{onClick:()=>{const C=document.querySelector('textarea[placeholder*="Gem text"]');C&&C.focus()},children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Add New Gem"]})]})}):e.jsx("div",{className:"space-y-2",children:X.map(C=>e.jsxs("div",{className:"p-3 rounded-xl border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"text-xs opacity-70 mb-1",children:[C.book," â€” ",C.author]}),C.created_at&&e.jsx("div",{className:"text-xs text-zinc-500",children:new Date(C.created_at).toLocaleDateString()}),n===C.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ze,{rows:3,value:o,onChange:U=>i(U.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Date"}),e.jsx(Q,{type:"date",value:u,onChange:U=>d(U.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-zinc-600 dark:text-zinc-400 mb-1",children:"Commentary"}),e.jsx(Ze,{rows:2,placeholder:"Why this gem mattersâ€¦",value:p,onChange:U=>x(U.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{onClick:Z,children:"Save"}),e.jsx(_,{variant:"secondary",onClick:()=>{r(""),i("")},children:"Cancel"})]})]}):e.jsxs("div",{className:"text-sm whitespace-pre-wrap",children:[te&&te.trim()?C.text.split(new RegExp(`(${te.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((U,le)=>U.toLowerCase()===te.toLowerCase()?e.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-800 px-1 rounded",children:U},le):U):C.text,C.commentary&&e.jsx("div",{className:"mt-2 text-xs text-zinc-600 dark:text-zinc-400 italic",children:C.commentary})]}),e.jsxs("div",{className:"mt-2 flex gap-1 justify-end",children:[n!==C.id&&e.jsx(_,{size:"sm",variant:"ghost",onClick:()=>B(C.id,C.text,C.created_at,C.commentary),className:"p-1 hover:scale-110 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 hover:shadow-md",title:"Edit highlight",children:e.jsx(Pa,{className:"w-3 h-3 text-blue-600 hover:text-blue-700 transition-colors"})}),e.jsx(_,{size:"sm",variant:"ghost",onClick:()=>W(C.id),className:"p-1 hover:scale-110 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200 hover:shadow-md",title:"Delete highlight",children:e.jsx(Et,{className:"w-3 h-3 text-red-600 hover:text-red-700 transition-colors"})})]})]},C.id))})]})]})}const jn=async s=>{try{const{writeText:t}=await Gt(async()=>{const{writeText:a}=await import("./index-DbTFBFyd.js");return{writeText:a}},__vite__mapDeps([0,1,2,3]));await t(s)}catch(t){throw new Error(`Failed to copy to clipboard: ${t}`)}},vn=()=>["title","author","seriesNames","seriesNumbers","obtained","type","status","tags","latestStart","latestEnd","latestRating","latestReview","highlightsCount"].join(",")+`
`,kn=()=>["id","book","author","text","created_at","commentary"].join(",")+`
`,En=()=>["id","book_id","title","author","start_date","end_date","rating","review","format","current_page","total_pages","progress_percentage"].join(",")+`
`;function _n({mode:s,setMode:t,extraTheme:a,setExtraTheme:n,onBack:r}){const[o,i]=c.useState(!1),[u,d]=c.useState(null),[p,x]=c.useState(!1),[b,E]=c.useState(!1),[w,S]=c.useState("localreads.sqlite"),[T,I]=c.useState(ts()),N=async()=>{i(!0);try{d(null)}catch(h){console.error("Update check failed:",h)}finally{i(!1)}},R=async()=>{try{console.log("Update installation would happen here")}catch(h){console.error("Update installation failed:",h)}};return rs([{key:"e",ctrlKey:!0,action:async()=>{x(!0);try{const h=await Ee(),f=await Jt(h),g=await Te({title:"Export Library CSV",defaultPath:"localreads.csv",filters:[{name:"CSV",extensions:["csv"]}]});g&&(await Le(g,f),alert("Library CSV exported successfully!"))}catch(h){alert(`Export failed: ${h}`)}finally{x(!1)}},description:"Quick Export Library CSV"}],[]),e.jsx(ns,{onClick:r,children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"p-6 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ut,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h2",{className:"text-heading-2",children:"Settings"})]}),e.jsx(_,{variant:"ghost",onClick:r,className:"p-2",children:e.jsx(ht,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[75vh]",children:e.jsx(we,{className:"border-0 rounded-none shadow-none",children:e.jsx(je,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸŒ—"}),e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white",children:"Appearance"})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Choose your preferred appearance and color scheme"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm font-medium mb-2 text-zinc-700 dark:text-zinc-300",children:"Theme Mode"}),e.jsxs("div",{className:"flex gap-1 p-0.5 bg-zinc-100 dark:bg-gray-800 rounded-lg overflow-hidden w-fit",children:[e.jsx(Mt,{selected:s==="light",onClick:()=>t("light"),icon:"â˜€ï¸",label:"Light"}),e.jsx(Mt,{selected:s==="dark",onClick:()=>t("dark"),icon:"ðŸŒ™",label:"Dark"}),e.jsx(Mt,{selected:s==="system",onClick:()=>t("system"),icon:"ðŸ’»",label:"System"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2 text-zinc-700 dark:text-zinc-300",children:"Color Themes"}),e.jsxs("div",{className:"flex flex-wrap gap-1 p-0.5 bg-zinc-100 dark:bg-gray-800 rounded-lg w-fit",children:[e.jsx(ze,{selected:a===null,onClick:()=>n(null),emoji:"âšª",label:"Default",colors:["#6366f1","#818cf8"]}),e.jsx(ze,{selected:a==="sepia",onClick:()=>n("sepia"),emoji:"ðŸ“œ",label:"Sepia",colors:["#d2691e","#daa520"]}),e.jsx(ze,{selected:a==="forest",onClick:()=>n("forest"),emoji:"ðŸŒ²",label:"Forest",colors:["#22c55e","#16a34a"]}),e.jsx(ze,{selected:a==="ocean",onClick:()=>n("ocean"),emoji:"ðŸŒŠ",label:"Ocean",colors:["#0ea5e9","#0284c7"]}),e.jsx(ze,{selected:a==="lavender",onClick:()=>n("lavender"),emoji:"ðŸŒ¸",label:"Lavender",colors:["#8b5cf6","#7c3aed"]}),e.jsx(ze,{selected:a==="sunset",onClick:()=>n("sunset"),emoji:"ðŸŒ…",label:"Sunset",colors:["#f97316","#fb7185"]}),e.jsx(ze,{selected:a==="neon",onClick:()=>n("neon"),emoji:"âš¡",label:"Neon",colors:["#22d3ee","#a78bfa"]}),e.jsx(ze,{selected:a==="candy",onClick:()=>n("candy"),emoji:"ðŸ¬",label:"Candy",colors:["#ec4899","#f472b6"]}),e.jsx(ze,{selected:a==="mint",onClick:()=>n("mint"),emoji:"ðŸŒ¿",label:"Mint",colors:["#2dd4bf","#34d399"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“…"}),e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white",children:"Date Format"})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Used when importing CSVs to interpret ambiguous dates"}),e.jsx("div",{className:"flex gap-1 p-0.5 bg-zinc-100 dark:bg-gray-800 rounded-lg overflow-hidden w-fit",children:[{key:"auto",label:"Auto"},{key:"YMD",label:"YYYY-MM-DD"},{key:"MDY",label:"MM/DD/YYYY"},{key:"DMY",label:"DD/MM/YYYY"}].map(h=>e.jsx(Sn,{selected:T===h.key,onClick:()=>{I(h.key),en(h.key)},icon:"ðŸ“†",label:h.label},h.key))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”„"}),e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white",children:"Updates"})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Check for and install application updates"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(_,{onClick:N,disabled:o,variant:"secondary",className:"flex items-center gap-2 w-40",children:[o?e.jsx(dt,{className:"w-4 h-4 animate-spin"}):e.jsx(dt,{className:"w-4 h-4"}),o?"Checking...":"Check for Updates"]}),u&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:["Update Available: v",u.version]}),e.jsxs(_,{onClick:R,size:"sm",className:"flex items-center gap-2 w-24",children:[e.jsx(jt,{className:"w-4 h-4"}),"Install"]})]}),u.body&&e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:u.body})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ—„ï¸"}),e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white",children:"Database"})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Manage your database location and settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs(_,{onClick:async()=>{const h=await Qt();S(h),alert(`Database file: ${h}`)},className:"flex items-center gap-2 w-32",children:[e.jsx(jt,{className:"w-4 h-4"})," Show DB Path"]}),e.jsx("span",{className:"opacity-70 truncate",children:w})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs",children:e.jsxs(_,{onClick:async()=>{const h=await Qt();if(!h){alert("Error: Could not determine database path. This might indicate a configuration issue.");return}const f=h.substring(0,h.lastIndexOf("/"));console.log("Database file path:",h),console.log("Attempting to open directory:",f);try{const g=await Gt(()=>import("./index-CwBU1vPS.js"),__vite__mapDeps([4,1,2,3]));console.log("Opener plugin loaded:",g);const L=g;if(console.log("Available methods:",Object.keys(L)),typeof L.open=="function")console.log("Using opener.open to open directory"),await L.open(f);else if(typeof L.openPath=="function")console.log("Using opener.openPath to open directory"),await L.openPath(f);else throw new Error("No suitable open function found in opener plugin");console.log("Directory opened successfully")}catch(g){console.error("Failed to open file location:",g);let L="Unknown error",A="Try opening the path manually in your file manager.";if(g?.message){const M=g.message.toLowerCase();M.includes("permission")||M.includes("access")?(L="Permission denied - insufficient file system permissions",A="Check if the app has permission to access files, or try running as administrator."):M.includes("not found")||M.includes("no such file")?(L="Database file or directory does not exist",A="The database may not have been created yet. Try adding a book first."):M.includes("opener")||M.includes("plugin")?(L="File opener plugin not available or not working",A="This feature requires the desktop app. Make sure you are not using the web version."):M.includes("platform")||M.includes("unsupported")?(L="Opening files not supported on this platform",A="Your operating system may not support automatic file opening."):L=`System error: ${g.message}`}else typeof g=="string"&&(L=g);try{await jn(f),alert(`âŒ Cannot Open File Location

Reason: ${L}

Suggestion: ${A}

âœ… Database directory path copied to clipboard:
${f}

You can paste this path into your file manager to navigate there manually. The database file "${h.split("/").pop()}" will be in that directory.`)}catch(M){console.error("Failed to copy to clipboard:",M);let J="Unknown clipboard error";M?.message&&(M.message.includes("permission")?J="No permission to access clipboard":M.message.includes("plugin")?J="Clipboard plugin not available":J=M.message),alert(`âŒ Cannot Open File Location

Reason: ${L}

Suggestion: ${A}

âŒ Also failed to copy to clipboard
Clipboard Error: ${J}

ðŸ“ Database directory path (copy manually):
${f}

ðŸ“„ Database file: ${h.split("/").pop()}`)}}},className:"flex items-center gap-2 w-40",children:[e.jsx(jt,{className:"w-4 h-4"})," Open DB File Location"]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs(_,{onClick:async()=>{const h=await ot({multiple:!1,directory:!1,canCreateDirectories:!0,defaultPath:"localreads.sqlite"});h&&typeof h=="string"&&(await ha(h),S(h),alert(`Database path updated. Will use: ${h}`))},className:"flex items-center gap-2 w-40",children:[e.jsx(jt,{className:"w-4 h-4"})," Change DB Location"]}),e.jsx("span",{className:"opacity-70",children:"Pick a .sqlite file (existing or new)"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“¥ðŸ“¤"}),e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white",children:"Import & Export"})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Manage your data with CSV and JSON formats"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ“š"}),"Books & Library"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{onClick:async()=>{x(!0);try{console.log("Starting library export...");const h=await Ee();console.log("Got rows:",h.length);const f=await Jt(h);console.log("Generated CSV length:",f.length);const g=await Te({title:"Export Library CSV",defaultPath:"localreads.csv",filters:[{name:"CSV",extensions:["csv"]}]});console.log("Selected file path:",g),g?(await Le(g,f),console.log("File written successfully"),alert("Library CSV exported successfully!")):console.log("No file path selected")}catch(h){console.error("Export failed:",h),alert(`Export failed: ${h}`)}finally{x(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:p,children:[e.jsx(Be,{className:"w-3 h-3"})," ",p?"Exportingâ€¦":"Export CSV"]}),e.jsxs(_,{onClick:async()=>{E(!0);try{const h=await ot({multiple:!1,filters:[{name:"CSV",extensions:["csv"]}]});if(!h)return;const f=await kt(h),{importCsv:g}=await Gt(async()=>{const{importCsv:L}=await Promise.resolve().then(()=>xn);return{importCsv:L}},void 0);await g(f),alert("Library CSV import complete")}finally{E(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:b,children:[e.jsx(vt,{className:"w-3 h-3"})," ",b?"Importingâ€¦":"Import CSV"]}),e.jsxs(_,{onClick:async()=>{try{const h=vn(),f=await Te({title:"Save Books CSV Template",defaultPath:"books_template.csv",filters:[{name:"CSV",extensions:["csv"]}]});f&&(await Le(f,h),alert(`Books CSV template saved successfully!

The template includes these columns:
title, author, seriesName, seriesNumber, seriesNames, seriesNumbers, obtained, type, status, tags, latestStart, latestEnd, latestRating, latestReview, highlightsCount`))}catch(h){alert(`Template export failed: ${h}`)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",variant:"secondary",children:[e.jsx(Be,{className:"w-3 h-3"})," Template"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:"âœ¨"}),"Gems"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{onClick:async()=>{x(!0);try{console.log("Starting gems export...");const h=await as();console.log("Generated gems CSV length:",h.length);const f=await Te({title:"Export Gems CSV",defaultPath:"gems.csv",filters:[{name:"CSV",extensions:["csv"]}]});console.log("Selected gems file path:",f),f?(await Le(f,h),console.log("Gems file written successfully"),alert("Gems CSV exported successfully!")):console.log("No gems file path selected")}catch(h){console.error("Gems export failed:",h),alert(`Gems export failed: ${h}`)}finally{x(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:p,children:[e.jsx(Be,{className:"w-3 h-3"})," ",p?"Exportingâ€¦":"Export CSV"]}),e.jsxs(_,{onClick:async()=>{E(!0);try{const h=await ot({multiple:!1,filters:[{name:"CSV",extensions:["csv"]}]});if(!h)return;const f=await kt(h);await ma(f),alert("Gems import complete")}finally{E(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:b,children:[e.jsx(vt,{className:"w-3 h-3"})," ",b?"Importingâ€¦":"Import CSV"]}),e.jsxs(_,{onClick:async()=>{try{const h=kn(),f=await Te({title:"Save Gems CSV Template",defaultPath:"gems_template.csv",filters:[{name:"CSV",extensions:["csv"]}]});f&&(await Le(f,h),alert(`Gems CSV template saved successfully!

The template includes these columns:
id, book, author, text, created_at, commentary`))}catch(h){alert(`Template export failed: ${h}`)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",variant:"secondary",children:[e.jsx(Be,{className:"w-3 h-3"})," Template"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ“–"}),"Reads"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{onClick:async()=>{x(!0);try{const h=await da(),f=await Te({title:"Export Reads CSV",defaultPath:"reads.csv",filters:[{name:"CSV",extensions:["csv"]}]});f&&(await Le(f,h),alert("Reads CSV exported successfully!"))}catch(h){alert(`Reads export failed: ${h}`)}finally{x(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:p,children:[e.jsx(Be,{className:"w-3 h-3"})," ",p?"Exportingâ€¦":"Export CSV"]}),e.jsxs(_,{onClick:async()=>{E(!0);try{const h=await ot({multiple:!1,filters:[{name:"CSV",extensions:["csv"]}]});if(!h)return;const f=await kt(h);await ua(f),alert("Reads CSV import complete")}finally{E(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:b,children:[e.jsx(vt,{className:"w-3 h-3"})," ",b?"Importingâ€¦":"Import CSV"]}),e.jsxs(_,{onClick:async()=>{try{const h=En(),f=await Te({title:"Save Reads CSV Template",defaultPath:"reads_template.csv",filters:[{name:"CSV",extensions:["csv"]}]});f&&(await Le(f,h),alert(`Reads CSV template saved successfully!

Columns:
id, book_id, title, author, start_date, end_date, rating, review, format, current_page, total_pages, progress_percentage`))}catch(h){alert(`Template export failed: ${h}`)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",variant:"secondary",children:[e.jsx(Be,{className:"w-3 h-3"})," Template"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ’¾"}),"Full Data Backup (JSON)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{onClick:async()=>{x(!0);try{console.log("Starting JSON export...");const h=await oa();console.log("Generated JSON length:",h.length);const f=await Te({title:"Export Full JSON",defaultPath:"localreads.json",filters:[{name:"JSON",extensions:["json"]}]});console.log("Selected JSON file path:",f),f?(await Le(f,h),console.log("JSON file written successfully"),alert("JSON exported successfully!")):console.log("No JSON file path selected")}catch(h){console.error("JSON export failed:",h),alert(`JSON export failed: ${h}`)}finally{x(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:p,children:[e.jsx(Be,{className:"w-3 h-3"})," ",p?"Exportingâ€¦":"Export Backup"]}),e.jsxs(_,{onClick:async()=>{E(!0);try{const h=await ot({multiple:!1,filters:[{name:"JSON",extensions:["json"]}]});if(!h)return;const f=await kt(h);await ca(f),alert("JSON import complete")}finally{E(!1)}},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",disabled:b,children:[e.jsx(vt,{className:"w-3 h-3"})," ",b?"Importingâ€¦":"Restore Backup"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ§¹"}),e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white",children:"Data Cleanup"})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 mb-4",children:"Find and resolve data inconsistencies"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(_,{onClick:()=>{r(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("show-duplicates"))},50)},className:"flex items-center gap-1 justify-center text-xs w-28",size:"sm",children:[e.jsx(Je,{className:"w-3 h-3"})," Find Duplicates"]}),e.jsxs(_,{onClick:()=>{r(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("show-non-compliant"))},50)},className:"flex items-center gap-1 justify-center text-xs w-32",size:"sm",children:[e.jsx(Je,{className:"w-3 h-3"})," Find Non-Compliant"]})]})]})]})})})})]})})}function Mt({selected:s,onClick:t,icon:a,label:n}){return e.jsxs("button",{className:`flex flex-col items-center gap-1 p-2 rounded-md transition-all duration-300 min-w-20 max-w-20 flex-shrink-0 settings-button-fixed ${s?"bg-white dark:bg-zinc-600 shadow-md text-indigo-600 dark:text-white font-medium border border-indigo-200 dark:border-zinc-500":"hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:text-zinc-800 dark:hover:text-white"}`,style:{width:"80px",minWidth:"80px",maxWidth:"80px"},onClick:t,children:[e.jsx("span",{className:"text-sm",children:a}),e.jsx("span",{className:"text-xs font-medium",children:n})]})}function Sn({selected:s,onClick:t,icon:a,label:n}){return e.jsxs("button",{className:`flex flex-col items-center gap-1 p-2 rounded-md transition-all duration-300 min-w-24 max-w-24 flex-shrink-0 date-format-button-fixed ${s?"bg-white dark:bg-zinc-600 shadow-md text-indigo-600 dark:text-white font-medium border border-indigo-200 dark:border-zinc-500":"hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:text-zinc-800 dark:hover:text-white"}`,style:{width:"100px",minWidth:"100px",maxWidth:"100px"},onClick:t,children:[e.jsx("span",{className:"text-sm",children:a}),e.jsx("span",{className:"text-xs font-medium",children:n})]})}function ze({selected:s,onClick:t,emoji:a,label:n,colors:r}){return e.jsxs("button",{className:`flex flex-col items-center gap-1 p-2 rounded-md transition-all duration-300 min-w-20 max-w-20 flex-shrink-0 settings-button-fixed ${s?"bg-white dark:bg-zinc-600 shadow-md text-indigo-600 dark:text-white font-medium border border-indigo-200 dark:border-zinc-500":"hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-300 hover:text-zinc-800 dark:hover:text-white"}`,style:{width:"80px",minWidth:"80px",maxWidth:"80px"},onClick:t,children:[e.jsx("span",{className:"text-sm",children:a}),e.jsx("div",{className:"flex gap-0.5 mb-0.5",children:r.map((o,i)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full border border-white dark:border-zinc-800",style:{backgroundColor:o}},i))}),e.jsx("span",{className:"text-xs font-medium leading-tight",children:n})]})}function Cs({onBack:s}){const[t,a]=c.useState([]),[n,r]=c.useState(!0),[o,i]=c.useState("priority"),[u,d]=c.useState("desc"),[p,x]=c.useState(!1),[b,E]=c.useState(null),[w,S]=c.useState(""),[T,I]=c.useState(1),[N,R]=c.useState(!0),[h,f]=c.useState(!1),[g,L]=c.useState(0),[A,M]=c.useState(25);c.useEffect(()=>{K()},[]),c.useEffect(()=>{t.length>0&&(console.log("=== ALL BOOKS IN NEXT UP ==="),t.forEach((v,W)=>{console.log(`Book ${W+1}:`,v.title),console.log("  Series name:",v.series_name),console.log("  Series number:",v.series_number),console.log("  Series array:",v.series),console.log("  ---")}))},[t]);const J=async(v,W)=>{try{await Js(v,!W),await K()}catch(B){console.error("Error toggling Next Up priority:",B)}},K=c.useCallback(async(v=1,W=!1)=>{v===1?r(!0):f(!0);try{const[B,Z]=await Promise.all([Ee({status:"To Read"}),Ee({status:"Paused"})]),X=[...B,...Z].map(H=>{let se=0;return H.next_up_priority?se+=1e3:(H.status==="Paused"&&(se+=50),H.series_name&&(se+=20),H.reads_count>0&&(se+=30),H.highlightsCount>0&&(se+=15),H.tags&&H.tags.trim()&&(se+=5),se+=Math.random()*10),{...H,priority_score:se}}),U=[...w.trim()?X.filter(H=>{const se=w.trim().toLowerCase();return[H.title,H.author,H.series_name||"",...Array.isArray(H.series)?H.series.map(ne=>ne?.name||""):[],H.tags||""].join(" ").toLowerCase().includes(se)}):X].sort((H,se)=>{let oe,ne;switch(o){case"priority":oe=H.priority_score,ne=se.priority_score;break;case"title":oe=H.title.toLowerCase(),ne=se.title.toLowerCase();break;case"author":oe=H.author.toLowerCase(),ne=se.author.toLowerCase();break;case"series":oe=H.series_name?.toLowerCase()||"",ne=se.series_name?.toLowerCase()||"";break;case"added":oe=H.id,ne=se.id;break;default:oe=H.priority_score,ne=se.priority_score}return o==="priority"||o==="added"?u==="asc"?oe-ne:ne-oe:u==="asc"?oe.localeCompare(ne):ne.localeCompare(oe)}),le=(v-1)*A,Oe=le+A,ee=U.slice(le,Oe);W?a(H=>[...H,...ee]):(a(ee),I(1)),R(Oe<U.length),L(U.length)}catch(B){console.error("Error loading next up books:",B)}finally{r(!1),f(!1)}},[w,o,u,A]),xe=c.useCallback(()=>{if(!h&&N){const v=T+1;I(v),K(v,!0)}},[h,N,T,K]),ge=c.useCallback(v=>{M(v),I(1),setTimeout(()=>{a([]),R(!0),K(1,!1)},300)},[K]);c.useEffect(()=>{K(1,!1)},[w,o,u,K]);const te=t,he=v=>{o===v?d(W=>W==="asc"?"desc":"asc"):(i(v),d("desc"))},ae=v=>{E(v),x(!0)},_e=()=>{x(!1),E(null),K(1,!1)};return e.jsxs(we,{children:[e.jsxs(Ne,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-heading-2 flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),"Next Up (",g,")"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mt-1",children:"Your reading queue, prioritized by engagement and context"})]}),e.jsx("div",{className:"w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"}),e.jsx(Q,{value:w,onChange:v=>S(v.target.value),placeholder:"Search Next Up",className:"pl-9"})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400 self-center",children:"Sort by:"}),[{key:"priority",label:"Priority",icon:Pe},{key:"title",label:"Title",icon:mt},{key:"author",label:"Author",icon:xt},{key:"series",label:"Series",icon:zt},{key:"added",label:"Recently Added",icon:Wt}].map(({key:v,label:W,icon:B})=>e.jsxs(_,{variant:o===v?"primary":"secondary",size:"sm",onClick:()=>he(v),className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),W,o===v&&(u==="asc"?e.jsx(Bs,{className:"w-3 h-3"}):e.jsx($s,{className:"w-3 h-3"}))]},v))]})]}),e.jsxs(je,{children:[n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Re,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Loading your reading queue..."})]}):te.length===0?e.jsx(Ue,{illustration:"books",title:"Your reading queue is empty",description:"Add some books to your 'To Read' list to see personalized recommendations here.",tips:["Books you've paused get highest priority","Series books are prioritized to maintain reading flow","Books with highlights show you've shown interest","Use tags to help organize your reading priorities"],action:e.jsx(_,{onClick:s,children:"Browse Library"})}):e.jsx("div",{className:"space-y-4",children:te.map((v,W)=>e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl border border-zinc-200 dark:border-zinc-700 p-4 hover:shadow-md transition-all duration-300 hover:border-indigo-300 dark:hover:border-indigo-600 group cursor-pointer",onClick:()=>ae(v),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-heading-3 text-zinc-900 dark:text-zinc-100 truncate",children:v.title}),v.next_up_priority&&e.jsx(G,{variant:"primary",size:"sm",className:"shrink-0 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"â­ Next Up"}),o==="priority"&&!v.next_up_priority&&e.jsxs(G,{variant:W<3?"primary":"secondary",size:"sm",className:"shrink-0",children:["#",W+1]})]}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400 truncate mb-1",children:v.author}),(v.series_name||v.series?.length)&&e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-500 truncate",title:v.series_name&&(v.series_number!=null&&v.series_number>0?`${v.series_name} #${v.series_number}`:v.series_name),children:[v.series_name,(()=>{const B=v.series_number;return console.log("Book:",v.title,"Series data:",{series_name:v.series_name,series_number:v.series_number,final_number:B}),B!=null&&B>0?` #${B}`:""})()]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",onClick:B=>B.stopPropagation(),children:[e.jsx("input",{type:"checkbox",id:`next-up-${v.id}`,checked:v.next_up_priority||!1,onChange:B=>{B.stopPropagation(),J(v.id,v.next_up_priority||!1)},onClick:B=>B.stopPropagation(),className:"w-4 h-4 text-indigo-600 border-zinc-300 dark:border-zinc-600 rounded focus:ring-indigo-500 focus:ring-2 cursor-pointer"}),e.jsx("label",{htmlFor:`next-up-${v.id}`,className:"text-xs text-zinc-600 dark:text-zinc-400 select-none cursor-pointer",onClick:B=>{B.stopPropagation(),J(v.id,v.next_up_priority||!1)},children:"Next Up"})]}),e.jsx(G,{variant:v.status==="Paused"?"warning":"default",size:"sm",className:"shrink-0",children:v.status}),e.jsx(G,{variant:"secondary",size:"sm",className:"shrink-0",children:v.type})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[v.status==="Paused"&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-600 dark:text-amber-400",children:[e.jsx(Wt,{className:"w-3 h-3"}),e.jsx("span",{children:"In Progress"})]}),v.reads_count>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(Pe,{className:"w-3 h-3"}),e.jsx("span",{children:"Previously Read"})]}),v.series_name&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400",children:[e.jsx(zt,{className:"w-3 h-3"}),e.jsx("span",{children:"Part of Series"})]}),v.latest?.start_date&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-600 dark:text-purple-400",children:[e.jsx(Qe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Started ",new Date(v.latest.start_date).toLocaleDateString()]})]})]}),v.tags&&v.tags.trim()&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[v.tags.split(";").slice(0,4).map(B=>e.jsx(G,{variant:"primary",size:"sm",className:"text-xs",children:B.trim()},B)),v.tags.split(";").length>4&&e.jsxs(G,{variant:"primary",size:"sm",className:"text-xs opacity-60",children:["+",v.tags.split(";").length-4]})]})]},v.id))}),N&&e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx(_,{onClick:xe,disabled:h,variant:"secondary",size:"lg",className:"px-8 transition-all duration-300",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading more books..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Load More Books (",A,")"]})})}),h&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsx(Ae,{className:"w-4 h-4 animate-spin"}),"Loading more books..."]})}),e.jsx("div",{className:"flex justify-center pt-4 border-t border-zinc-200 dark:border-zinc-700",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("span",{className:"text-zinc-600 dark:text-zinc-400",children:"Books per page:"}),e.jsx("div",{className:"flex gap-1",children:[25,50,100].map(v=>e.jsx("button",{onClick:()=>ge(v),className:`px-3 py-1 rounded-lg transition-all duration-200 ${A===v?"bg-indigo-500 text-white shadow-md":"bg-zinc-100 dark:bg-zinc-700 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-600"}`,children:v},v))}),e.jsxs("span",{className:"text-zinc-500 dark:text-zinc-400 text-xs",children:["(Total: ",g," books)"]})]})})]}),p&&e.jsx(ya,{book:b,onClose:()=>{x(!1),E(null)},onSave:_e})]})}function zs({onBack:s}){const[t,a]=c.useState([]),[n,r]=c.useState(!0),[o,i]=c.useState("read_count"),[u,d]=c.useState("desc"),[p,x]=c.useState("");c.useEffect(()=>{b()},[]);const b=async()=>{r(!0);try{const R=(await Ee({})).filter(f=>f.reads_count>1).map(async f=>{const g=await bt(f.id);return{...f,all_reads:g.sort((L,A)=>{const M=L.end_date||L.start_date||"9999-12-31",J=A.end_date||A.start_date||"9999-12-31";return new Date(J).getTime()-new Date(M).getTime()})}}),h=await Promise.all(R);a(h)}catch(N){console.error("Error loading re-read books:",N)}finally{r(!1)}},E=c.useMemo(()=>{const N=p.trim().toLowerCase();return N?t.filter(R=>[R.title,R.author,R.series_name||"",...Array.isArray(R.series)?R.series.map(f=>f?.name||""):[],...Array.isArray(R.tags)?R.tags:[]].join(" ").toLowerCase().includes(N)):t},[t,p]),w=c.useMemo(()=>[...E].sort((N,R)=>{let h,f;switch(o){case"read_count":h=N.reads_count,f=R.reads_count;break;case"latest_read":h=N.latest?.end_date||N.latest?.start_date||"",f=R.latest?.end_date||R.latest?.start_date||"";break;case"title":h=N.title.toLowerCase(),f=R.title.toLowerCase();break;case"author":h=N.author.toLowerCase(),f=R.author.toLowerCase();break;case"rating":const g=N.all_reads.filter(A=>A.rating).map(A=>A.rating),L=R.all_reads.filter(A=>A.rating).map(A=>A.rating);h=g.length?g.reduce((A,M)=>A+M,0)/g.length:0,f=L.length?L.reduce((A,M)=>A+M,0)/L.length:0;break;default:h=N.reads_count,f=R.reads_count}return typeof h=="number"?u==="asc"?h-f:f-h:u==="asc"?h.localeCompare(f):f.localeCompare(h)}),[E,o,u]),S=N=>{o===N?d(R=>R==="asc"?"desc":"asc"):(i(N),d("desc"))},T=N=>{const R=N.filter(h=>h.rating).map(h=>h.rating);return R.length?R.reduce((h,f)=>h+f,0)/R.length:0},I=N=>{const R=N.map(L=>L.end_date||L.start_date).filter(L=>!!L).sort();if(R.length<2)return null;const h=new Date(R[0]),g=new Date(R[R.length-1]).getFullYear()-h.getFullYear();return g===0?"Same year":g===1?"1 year span":`${g} year span`};return e.jsxs(we,{children:[e.jsxs(Ne,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-heading-2 flex items-center gap-2",children:[e.jsx(dt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),"Re-reads (",w.length,")"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400 mt-1",children:"Books you've read multiple times, with complete reading history"})]}),e.jsx("div",{className:"w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"}),e.jsx(Q,{value:p,onChange:N=>x(N.target.value),placeholder:"Search Re-reads",className:"pl-9"})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400 self-center",children:"Sort by:"}),[{key:"read_count",label:"Read Count",icon:dt},{key:"latest_read",label:"Latest Read",icon:Wt},{key:"rating",label:"Avg Rating",icon:Pe},{key:"title",label:"Title",icon:mt},{key:"author",label:"Author",icon:mt}].map(({key:N,label:R,icon:h})=>e.jsxs(_,{variant:o===N?"primary":"secondary",size:"sm",onClick:()=>S(N),className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),R,o===N&&(u==="asc"?e.jsx(Bs,{className:"w-3 h-3"}):e.jsx($s,{className:"w-3 h-3"}))]},N))]})]}),e.jsx(je,{children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Re,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:"Loading your re-read history..."})]}):w.length===0?e.jsx(Ue,{illustration:"books",title:"No re-reads yet",description:"Books that you've read multiple times will appear here, along with your complete reading timeline for each book.",tips:["Mark a book as 'Finished' multiple times to create re-read entries","Each read can have its own dates, rating, and review","Track how your opinion of a book changes over time","Perfect for favorite books you return to regularly"],action:e.jsx(_,{onClick:s,children:"Browse Library"})}):e.jsx("div",{className:"space-y-6",children:w.map(N=>{const R=T(N.all_reads),h=I(N.all_reads);return e.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl border border-zinc-200 dark:border-zinc-700 p-4 hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h3",{className:"text-heading-3 text-zinc-900 dark:text-zinc-100 mb-1",children:N.title}),e.jsxs("p",{className:"text-zinc-600 dark:text-zinc-400 mb-1",children:["by ",N.author]}),(N.series_name||N.series?.length)&&e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-500",title:[N.series_name&&(N.series_number!=null&&N.series_number>0?`${N.series_name} #${N.series_number}`:N.series_name),...(N.series||[]).map(f=>f.number!=null&&f.number>0?`${f.name} #${f.number}`:f.name)].filter(Boolean).join(" â€¢ "),children:[N.series_name||N.series?.[0]?.name,(()=>{const f=N.series_number!=null?N.series_number:N.series?.[0]?.number;return f!=null&&f>0?` #${f}`:""})(),N.series?.length&&(N.series_name?N.series.length:Math.max(0,N.series.length-1))>0&&e.jsxs("span",{className:"ml-1 opacity-70",children:["+",N.series_name?N.series.length:N.series.length-1]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs(G,{variant:"success",size:"sm",className:"shrink-0",children:[N.reads_count," reads"]}),R>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:R.toFixed(1)})]})]})]}),e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-zinc-50 dark:bg-zinc-800/50",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-zinc-600 dark:text-zinc-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(dt,{className:"w-3 h-3"}),e.jsxs("span",{children:[N.reads_count," times read"]})]}),h&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"w-3 h-3"}),e.jsx("span",{children:h})]}),R>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Avg: ",R.toFixed(1),"/5"]})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3",children:"Reading Timeline"}),e.jsx("div",{className:"space-y-3",children:N.all_reads.map((f,g)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-900/50",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mt-1",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 text-xs font-bold",children:N.all_reads.length-g})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.start_date&&e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:["Started: ",new Date(f.start_date).toLocaleDateString()]}),f.end_date&&e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:["Finished: ",new Date(f.end_date).toLocaleDateString()]}),f.format&&e.jsx(G,{variant:"secondary",size:"sm",className:"text-xs",children:f.format})]}),f.rating&&e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[[...Array(f.rating)].map((L,A)=>e.jsx(Pe,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"},A)),e.jsxs("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 ml-1",children:[f.rating,"/5"]})]}),f.review&&e.jsxs("div",{className:"text-xs text-zinc-600 dark:text-zinc-400 italic mt-1",children:['"',f.review,'"']})]})})})]},f.id))})]}),N.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-4 pt-3 border-t border-zinc-200 dark:border-zinc-700",children:N.tags.map(f=>e.jsx(G,{variant:"primary",size:"sm",className:"text-xs",children:f},f))})]},N.id)})})})]})}function Ts({onBack:s,onSelectAuthor:t}){const[a,n]=c.useState([]),[r,o]=c.useState(""),[i,u]=c.useState(!0),[d,p]=c.useState(0);c.useEffect(()=>{(async()=>{u(!0);try{const b=await Ee({});n(b)}finally{u(!1)}})()},[]),c.useEffect(()=>{const b=()=>{p(Date.now())};return window.addEventListener("shuffle-items",b),()=>window.removeEventListener("shuffle-items",b)},[]);const x=c.useMemo(()=>{const b=new Map;for(const w of a){const S=String(w.author||"").split(/[;,]/).map(T=>T.trim()).filter(Boolean);for(const T of S)b.set(T,(b.get(T)||0)+1)}let E=Array.from(b.entries());if(r.trim()){const w=r.trim().toLowerCase();E=E.filter(([S])=>S.toLowerCase().includes(w))}if(d){const w=S=>{const T=Math.sin(S)*1e4;return T-Math.floor(T)};for(let S=E.length-1;S>0;S--){const T=Math.floor(w(d+S)*(S+1));[E[S],E[T]]=[E[T],E[S]]}return E}return E.sort((w,S)=>S[1]!==w[1]?S[1]-w[1]:w[0].localeCompare(S[0]))},[a,r,d]);return e.jsx("div",{className:"grid grid-cols-12 gap-4",children:e.jsx("div",{className:"col-span-12",children:e.jsxs(we,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-heading-2",children:"Authors"}),x.length>0&&e.jsx(G,{variant:"secondary",size:"sm",children:x.length})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(_,{variant:"secondary",size:"sm",onClick:()=>p(Date.now()),className:"flex items-center gap-2",title:"Shuffle authors order",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Shuffle"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 opacity-70"}),e.jsx(Q,{className:"pl-9 w-64",placeholder:"Search authors...",value:r,onChange:b=>o(b.target.value)})]})]})]})}),e.jsx(je,{children:i?e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 py-8",children:"Loading authorsâ€¦"}):x.length===0?e.jsx(Ue,{illustration:"search",title:"No authors found",description:r?"Try a different search term.":"Add some books to see authors here.",action:e.jsx(_,{onClick:s,children:"Back to Library"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:x.map(([b,E])=>e.jsx("button",{onClick:()=>t(b),className:"text-left p-3 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 hover:shadow-md hover:border-indigo-300 dark:hover:border-indigo-600 transition-all",title:`Show books by ${b}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4 text-zinc-400"}),e.jsx("span",{className:"font-medium",children:b})]}),e.jsx(G,{variant:"primary",size:"sm",children:E})]})},b))})})]})})})}function Ls({onBack:s,onSelectSeries:t}){const[a,n]=c.useState([]),[r,o]=c.useState(""),[i,u]=c.useState(!0),[d,p]=c.useState(0);c.useEffect(()=>{(async()=>{u(!0);try{const b=await Ee({});n(b)}finally{u(!1)}})()},[]),c.useEffect(()=>{const b=()=>{p(Date.now())};return window.addEventListener("shuffle-items",b),()=>window.removeEventListener("shuffle-items",b)},[]);const x=c.useMemo(()=>{const b=new Map;for(const w of a){if(w.series_name&&w.series_name.trim()){const S=w.series_name.trim();b.set(S,(b.get(S)||0)+1)}if(w.series&&Array.isArray(w.series)){for(const S of w.series)if(S.name&&S.name.trim()){const T=S.name.trim();b.set(T,(b.get(T)||0)+1)}}}let E=Array.from(b.entries());if(r.trim()){const w=r.trim().toLowerCase();E=E.filter(([S])=>S.toLowerCase().includes(w))}if(d){const w=S=>{const T=Math.sin(S)*1e4;return T-Math.floor(T)};for(let S=E.length-1;S>0;S--){const T=Math.floor(w(d+S)*(S+1));[E[S],E[T]]=[E[T],E[S]]}return E}return E.sort((w,S)=>S[1]!==w[1]?S[1]-w[1]:w[0].localeCompare(S[0]))},[a,r,d]);return e.jsx("div",{className:"grid grid-cols-12 gap-4",children:e.jsx("div",{className:"col-span-12",children:e.jsxs(we,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-heading-2",children:"Series"}),x.length>0&&e.jsx(G,{variant:"secondary",size:"sm",children:x.length})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(_,{variant:"secondary",size:"sm",onClick:()=>p(Date.now()),className:"flex items-center gap-2",title:"Shuffle series order",children:[e.jsx(Ps,{className:"w-4 h-4"}),"Shuffle"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 opacity-70"}),e.jsx(Q,{className:"pl-9 w-64",placeholder:"Search series...",value:r,onChange:b=>o(b.target.value)})]})]})]})}),e.jsx(je,{children:i?e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 py-8",children:"Loading seriesâ€¦"}):x.length===0?e.jsx(Ue,{illustration:"search",title:"No series found",description:r?"Try a different search term.":"Add some books with series to see them here.",action:e.jsx(_,{onClick:s,children:"Back to Library"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:x.map(([b,E])=>e.jsx("button",{onClick:()=>t(b),className:"text-left p-3 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 hover:shadow-md hover:border-indigo-300 dark:hover:border-indigo-600 transition-all",title:`Show books in series: ${b}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{className:"w-4 h-4 text-zinc-400"}),e.jsx("span",{className:"font-medium",children:b})]}),e.jsx(G,{variant:"primary",size:"sm",children:E})]})},b))})})]})})})}const Cn=typeof window<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0,ke=Cn?"âŒ˜":"Ctrl",As=[{key:`${ke}+L`,description:"Go to Library",category:"Navigation"},{key:`${ke}+D`,description:"Go to Dashboard",category:"Navigation"},{key:`${ke}+H`,description:"Go to Gems",category:"Navigation"},{key:`${ke}+A`,description:"Go to Authors",category:"Navigation"},{key:`${ke}+S`,description:"Go to Series",category:"Navigation"},{key:`${ke}+U`,description:"Go to Next Up",category:"Navigation"},{key:`${ke}+Shift+R`,description:"Go to Re-reads",category:"Navigation"},{key:`${ke}+N`,description:"Add New Book",category:"Actions"},{key:`${ke}+R`,description:"Refresh Library",category:"Actions"},{key:`${ke}+Shift+S`,description:"Shuffle Series/Authors Order",category:"Actions"},{key:`${ke}+E`,description:"Export Library CSV (in Settings)",category:"Actions"},{key:"/",description:"Focus Search",category:"Search & Filters"},{key:"F",description:"Focus Search (in Library)",category:"Search & Filters"},{key:"C",description:"Clear All Filters",category:"Search & Filters"},{key:"Esc",description:"Clear Filters & Escape",category:"Search & Filters"},{key:"1",description:"Show To Read Books",category:"Quick Filters"},{key:"2",description:"Show Currently Reading",category:"Quick Filters"},{key:"3",description:"Show Finished Books",category:"Quick Filters"},{key:"4",description:"Show Books from This Year",category:"Quick Filters"},{key:"?",description:"Show/Hide Keyboard Shortcuts",category:"General"}];function zn({isOpen:s,onClose:t}){if(!s)return null;const a=Array.from(new Set(As.map(n=>n.category)));return e.jsx(ns,{onClick:t,children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"p-6 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Keyboard Shortcuts"})]}),e.jsx(_,{variant:"ghost",onClick:t,className:"p-2",children:e.jsx(ht,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(n=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm mb-3 text-zinc-800 dark:text-zinc-200 border-b border-zinc-200 dark:border-zinc-700 pb-2",children:n}),e.jsx("div",{className:"space-y-2",children:As.filter(r=>r.category===n).map((r,o)=>e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-800 dark:group-hover:text-zinc-200 transition-colors",children:r.description}),e.jsx("kbd",{className:"px-2 py-1 text-xs font-mono bg-zinc-100 dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-600 rounded shadow-sm",children:r.key})]},o))})]},n))}),e.jsx("div",{className:"mt-6 p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-xl",children:e.jsxs("p",{className:"text-xs text-zinc-600 dark:text-zinc-400 leading-relaxed",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," Keyboard shortcuts work when you're not actively typing in input fields. Use ",e.jsx("kbd",{className:"px-1 bg-zinc-200 dark:bg-zinc-700 rounded text-xs",children:"Esc"})," to blur inputs and then use shortcuts."]})})]})]})})}function Tn(){const s=()=>(typeof localStorage<"u"&&localStorage.getItem("localreads.themeMode"))??"system",t=()=>(typeof localStorage<"u"&&localStorage.getItem("localreads.extraTheme"))??null,[a,n]=c.useState(s),[r,o]=c.useState(t),[i,u]=c.useState(()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches:!1);return c.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const p=window.matchMedia("(prefers-color-scheme: dark)"),x=b=>u(b.matches);return p.addEventListener("change",x),()=>p.removeEventListener("change",x)},[]),c.useEffect(()=>{typeof localStorage<"u"&&localStorage.setItem("localreads.themeMode",a)},[a]),c.useEffect(()=>{typeof localStorage<"u"&&(r?localStorage.setItem("localreads.extraTheme",r):localStorage.removeItem("localreads.extraTheme"))},[r]),{mode:a,setMode:n,dark:a==="dark"?!0:a==="light"?!1:i,extraTheme:r,setExtraTheme:o}}const Se=typeof window<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0;function Ln(){const{dark:s,mode:t,setMode:a,extraTheme:n,setExtraTheme:r}=Tn(),[o,i]=c.useState("library"),[u,d]=c.useState(0),[p,x]=c.useState(!1),[b,E]=c.useState(!1),[w,S]=c.useState(""),[T,I]=c.useState(!1),[N,R]=c.useState([]),[h,f]=c.useState("");return rs([{key:"l",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>i("library"),description:"Go to Library"},{key:"d",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>i("dashboard"),description:"Go to Dashboard"},{key:"h",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>i("highlights"),description:"Go to Gems"},{key:"a",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>i("authors"),description:"Go to Authors"},{key:"s",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>i("series"),description:"Go to Series"},{key:"u",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>i("nextup"),description:"Go to Next Up"},{key:"r",...Se?{metaKey:!0}:{ctrlKey:!0},shiftKey:!0,action:()=>i("rereads"),description:"Go to Re-reads"},{key:"n",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>{i("library"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("add-book"))},100)},description:"Add New Book"},{key:"r",...Se?{metaKey:!0}:{ctrlKey:!0},action:()=>{d(g=>g+1),window.dispatchEvent(new CustomEvent("refresh-library"))},description:"Refresh Library"},{key:"/",action:()=>{i("library"),setTimeout(()=>{const g=document.querySelector('input[placeholder*="Search"]');g&&(g.focus(),g.select())},100)},description:"Focus Search"},{key:"?",action:()=>x(g=>!g),description:"Show/Hide Keyboard Shortcuts"},{key:"s",...Se?{metaKey:!0}:{ctrlKey:!0},shiftKey:!0,action:()=>{window.dispatchEvent(new CustomEvent("shuffle-items"))},description:"Shuffle Series/Authors"}],[o,u]),c.useEffect(()=>{const g=[];switch(g.push({label:"Home",action:()=>i("library")}),o){case"library":g.push({label:"Library"});break;case"dashboard":g.push({label:"Dashboard"});break;case"highlights":g.push({label:"Gems"});break;case"authors":g.push({label:"Authors"});break;case"series":g.push({label:"Series"});break;case"nextup":g.push({label:"Next Up"});break;case"rereads":g.push({label:"Re-reads"});break}h&&g.push({label:h}),R(g)},[o,h]),c.useEffect(()=>{const g=L=>{f(L.detail||"")};return window.addEventListener("update-breadcrumb",g),()=>window.removeEventListener("update-breadcrumb",g)},[]),c.useEffect(()=>{const g=()=>S("");return window.addEventListener("clear-global-search",g),()=>window.removeEventListener("clear-global-search",g)},[]),c.useEffect(()=>{w&&o==="library"?f(`Search: "${w}"`):!w&&h.startsWith("Search:")&&f("")},[w,o,h]),e.jsx(pn,{children:e.jsxs("div",{className:`${s?"dark":""} ${n?`theme-${n}`:""}`,children:[e.jsxs("div",{className:"app-container min-h-screen bg-zinc-50 dark:bg-zinc-900",children:[e.jsxs("div",{className:"block sm:hidden",children:[e.jsx("div",{className:"p-2 bg-zinc-50 dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 sticky top-0 z-40 safe-top backdrop-blur supports-[backdrop-filter]:bg-zinc-50/80 dark:supports-[backdrop-filter]:bg-zinc-900/80",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ke,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 opacity-70"}),e.jsx(Q,{className:"pl-9 w-full",placeholder:"Search books...",value:w,onChange:g=>S(g.target.value)})]}),e.jsx("button",{onClick:()=>E(!0),className:"p-2 rounded-xl transition-all duration-200 hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200",title:"Settings",children:e.jsx(Ut,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"mobile-content px-2 pt-2 pb-24 safe-bottom",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[o==="library"&&e.jsx(vs,{onOpenHighlights:()=>i("highlights"),onOpenDashboard:()=>i("dashboard"),refreshSignal:u,globalSearch:w}),o==="dashboard"&&e.jsx(Es,{onBack:()=>i("library"),onYearClick:g=>{console.log("Dashboard onYearClick called with year:",g),i("library"),console.log("Dispatching filter-year event with detail:",g),window.dispatchEvent(new CustomEvent("filter-year",{detail:g}))}}),o==="highlights"&&e.jsx(Ss,{onBack:()=>i("library")}),o==="nextup"&&e.jsx(Cs,{onBack:()=>i("library")}),o==="rereads"&&e.jsx(zs,{onBack:()=>i("library")}),o==="authors"&&e.jsx(Ts,{onBack:()=>i("library"),onSelectAuthor:g=>{i("library"),S(g)}}),o==="series"&&e.jsx(Ls,{onBack:()=>i("library"),onSelectSeries:g=>{i("library"),S(g)}})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-40 grid grid-cols-6 gap-1 p-2 bg-white/90 dark:bg-zinc-900/90 border-t border-zinc-200 dark:border-zinc-800 backdrop-blur card safe-bottom",children:[e.jsx(qe,{active:o==="library",onClick:()=>i("library"),extraTheme:n,mobile:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“š"}),e.jsx("span",{className:"text-xs",children:"Library"})]})}),e.jsx(qe,{active:o==="dashboard",onClick:()=>i("dashboard"),extraTheme:n,mobile:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“ˆ"}),e.jsx("span",{className:"text-xs",children:"Dashboard"})]})}),e.jsx(qe,{active:o==="highlights",onClick:()=>i("highlights"),extraTheme:n,mobile:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’Ž"}),e.jsx("span",{className:"text-xs",children:"Gems"})]})}),e.jsx(qe,{active:o==="nextup",onClick:()=>i("nextup"),extraTheme:n,mobile:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ§­"}),e.jsx("span",{className:"text-xs",children:"Next Up"})]})}),e.jsx(qe,{active:o==="rereads",onClick:()=>i("rereads"),extraTheme:n,mobile:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”"}),e.jsx("span",{className:"text-xs",children:"Re-reads"})]})}),e.jsx(qe,{active:o==="series",onClick:()=>i("series"),extraTheme:n,mobile:!0,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”—"}),e.jsx("span",{className:"text-xs",children:"Series"})]})})]})]}),e.jsxs("div",{className:"hidden sm:flex h-screen",children:[e.jsx("div",{className:"relative bg-white dark:bg-zinc-800 border-r border-zinc-200 dark:border-zinc-700 w-16 overflow-visible group",onMouseEnter:()=>I(!0),onMouseLeave:()=>I(!1),children:e.jsx("div",{className:`absolute inset-0 bg-white dark:bg-zinc-800 border-r border-zinc-200 dark:border-zinc-700 sidebar-slide z-10 ${T?"w-64 shadow-xl":"w-16 shadow-none"}`,children:e.jsxs("div",{className:"flex flex-col h-full relative z-20",children:[e.jsx("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-700 min-h-[73px] flex items-center",children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 flex-shrink-0",children:e.jsx("img",{src:new URL("/assets/icon-ovCew-V4.png",import.meta.url).href,alt:"LocalReads",className:"w-8 h-8 rounded"})}),e.jsx("div",{className:`ml-3 overflow-hidden sidebar-text-slide ${T?"opacity-100 max-w-xs delay-150 transform translate-x-0":"opacity-0 max-w-0 delay-0 transform -translate-x-2"}`,children:e.jsx("h1",{className:"text-heading-2 font-bold text-zinc-900 dark:text-zinc-100 whitespace-nowrap",children:"LocalReads"})})]})}),e.jsxs("nav",{className:"flex-1 p-2 space-y-1",children:[e.jsx(Me,{active:o==="library",onClick:()=>i("library"),icon:"ðŸ“š",label:"Library",expanded:T,extraTheme:n}),e.jsx(Me,{active:o==="dashboard",onClick:()=>i("dashboard"),icon:"ðŸ“ˆ",label:"Dashboard",expanded:T,extraTheme:n}),e.jsx(Me,{active:o==="highlights",onClick:()=>i("highlights"),icon:"ðŸ’Ž",label:"Gems",expanded:T,extraTheme:n}),e.jsx(Me,{active:o==="authors",onClick:()=>i("authors"),icon:"ðŸ‘¤",label:"Authors",expanded:T,extraTheme:n}),e.jsx(Me,{active:o==="series",onClick:()=>i("series"),icon:"ðŸ”—",label:"Series",expanded:T,extraTheme:n}),e.jsx(Me,{active:o==="nextup",onClick:()=>i("nextup"),icon:"ðŸ§­",label:"Next Up",expanded:T,extraTheme:n}),e.jsx(Me,{active:o==="rereads",onClick:()=>i("rereads"),icon:"ðŸ”",label:"Re-reads",expanded:T,extraTheme:n})]}),e.jsx("div",{className:"p-2 border-t border-zinc-200 dark:border-zinc-700",children:e.jsx(Me,{active:!1,onClick:()=>x(!0),icon:e.jsx(Us,{className:"w-5 h-5"}),label:"Shortcuts",expanded:T,extraTheme:n})})]})})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white dark:bg-zinc-800 border-b border-zinc-200 dark:border-zinc-700 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[N.length>1&&e.jsx("nav",{className:"flex items-center gap-2 text-sm",children:N.map((g,L)=>e.jsxs(es.Fragment,{children:[L>0&&e.jsx(Ua,{className:"w-4 h-4 text-zinc-400 dark:text-zinc-500"}),g.action?e.jsx("button",{onClick:g.action,className:"text-zinc-600 dark:text-zinc-300 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors",children:g.label}):e.jsx("span",{className:"text-zinc-900 dark:text-zinc-100 font-medium",children:g.label})]},L))}),e.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-zinc-100 capitalize",children:o==="nextup"?"Next Up":o==="rereads"?"Re-reads":o==="highlights"?"Gems":o==="authors"?"Authors":o==="series"?"Series":o})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 opacity-70"}),e.jsx(Q,{className:"pl-9 w-64",placeholder:"Search books...",value:w,onChange:g=>S(g.target.value)})]}),e.jsx("button",{onClick:()=>E(!0),className:"p-2 rounded-xl transition-all duration-200 hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200",title:"Settings",children:e.jsx(Ut,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[o==="library"&&e.jsx(vs,{onOpenHighlights:()=>i("highlights"),onOpenDashboard:()=>i("dashboard"),refreshSignal:u,globalSearch:w}),o==="dashboard"&&e.jsx(Es,{onBack:()=>i("library"),onYearClick:g=>{console.log("Dashboard onYearClick called with year:",g),i("library"),console.log("Dispatching filter-year event with detail:",g),window.dispatchEvent(new CustomEvent("filter-year",{detail:g}))}}),o==="highlights"&&e.jsx(Ss,{onBack:()=>i("library")}),o==="nextup"&&e.jsx(Cs,{onBack:()=>i("library")}),o==="rereads"&&e.jsx(zs,{onBack:()=>i("library")}),o==="authors"&&e.jsx(Ts,{onBack:()=>i("library"),onSelectAuthor:g=>{i("library"),S(g)}}),o==="series"&&e.jsx(Ls,{onBack:()=>i("library"),onSelectSeries:g=>{i("library"),S(g)}})]})})]})]})]}),e.jsx(zn,{isOpen:p,onClose:()=>x(!1)}),b&&e.jsx(_n,{mode:t,setMode:a,extraTheme:n,setExtraTheme:r,onBack:()=>E(!1)})]})})}function qe({active:s,onClick:t,children:a,extraTheme:n,mobile:r=!1}){const o=r?"p-3 rounded-xl font-medium transition-all duration-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 min-h-[60px] flex items-center justify-center":"px-4 py-2 rounded-xl font-medium transition-all duration-300 hover:bg-zinc-100 dark:hover:bg-zinc-800",i=s?"bg-zinc-100 dark:bg-zinc-800 shadow-sm":"";return s&&n&&!r?e.jsx("button",{className:`${o} btn-primary transform hover:scale-105`,onClick:t,children:a}):e.jsx("button",{className:`${o} ${i}`,onClick:t,children:a})}function Me({active:s,onClick:t,icon:a,label:n,expanded:r,extraTheme:o}){const i="w-full flex items-center p-3 rounded-xl font-medium transition-all duration-200 ease-out hover:bg-zinc-100 dark:hover:bg-zinc-700 group",u=s?"bg-zinc-100 dark:bg-zinc-700 shadow-sm":"";return s&&o?e.jsxs("button",{className:`${i} btn-primary transform hover:scale-105`,onClick:t,title:n,children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 flex-shrink-0",children:typeof a=="string"?e.jsx("span",{className:"text-lg",children:a}):a}),e.jsx("div",{className:`ml-3 overflow-hidden sidebar-text-slide ${r?"opacity-100 max-w-xs delay-150 transform translate-x-0":"opacity-0 max-w-0 delay-0 transform -translate-x-2"}`,children:e.jsx("span",{className:"whitespace-nowrap block",children:n})})]}):e.jsxs("button",{className:`${i} ${u}`,onClick:t,title:n,children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 flex-shrink-0",children:typeof a=="string"?e.jsx("span",{className:"text-lg",children:a}):a}),e.jsx("div",{className:`ml-3 overflow-hidden sidebar-text-slide ${r?"opacity-100 max-w-xs delay-150 transform translate-x-0":"opacity-0 max-w-0 delay-0 transform -translate-x-2"}`,children:e.jsx("span",{className:"whitespace-nowrap block",children:n})})]})}class wa{constructor(...t){this.type="Logical",t.length===1?"Logical"in t[0]?(this.width=t[0].Logical.width,this.height=t[0].Logical.height):(this.width=t[0].width,this.height=t[0].height):(this.width=t[0],this.height=t[1])}toPhysical(t){return new tt(this.width*t,this.height*t)}[ve](){return{width:this.width,height:this.height}}toJSON(){return this[ve]()}}class tt{constructor(...t){this.type="Physical",t.length===1?"Physical"in t[0]?(this.width=t[0].Physical.width,this.height=t[0].Physical.height):(this.width=t[0].width,this.height=t[0].height):(this.width=t[0],this.height=t[1])}toLogical(t){return new wa(this.width/t,this.height/t)}[ve](){return{width:this.width,height:this.height}}toJSON(){return this[ve]()}}class $e{constructor(t){this.size=t}toLogical(t){return this.size instanceof wa?this.size:this.size.toLogical(t)}toPhysical(t){return this.size instanceof tt?this.size:this.size.toPhysical(t)}[ve](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[ve]()}}class Na{constructor(...t){this.type="Logical",t.length===1?"Logical"in t[0]?(this.x=t[0].Logical.x,this.y=t[0].Logical.y):(this.x=t[0].x,this.y=t[0].y):(this.x=t[0],this.y=t[1])}toPhysical(t){return new ye(this.x*t,this.y*t)}[ve](){return{x:this.x,y:this.y}}toJSON(){return this[ve]()}}class ye{constructor(...t){this.type="Physical",t.length===1?"Physical"in t[0]?(this.x=t[0].Physical.x,this.y=t[0].Physical.y):(this.x=t[0].x,this.y=t[0].y):(this.x=t[0],this.y=t[1])}toLogical(t){return new Na(this.x/t,this.y/t)}[ve](){return{x:this.x,y:this.y}}toJSON(){return this[ve]()}}class et{constructor(t){this.position=t}toLogical(t){return this.position instanceof Na?this.position:this.position.toLogical(t)}toPhysical(t){return this.position instanceof ye?this.position:this.position.toPhysical(t)}[ve](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[ve]()}}var ue;(function(s){s.WINDOW_RESIZED="tauri://resize",s.WINDOW_MOVED="tauri://move",s.WINDOW_CLOSE_REQUESTED="tauri://close-requested",s.WINDOW_DESTROYED="tauri://destroyed",s.WINDOW_FOCUS="tauri://focus",s.WINDOW_BLUR="tauri://blur",s.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",s.WINDOW_THEME_CHANGED="tauri://theme-changed",s.WINDOW_CREATED="tauri://window-created",s.WEBVIEW_CREATED="tauri://webview-created",s.DRAG_ENTER="tauri://drag-enter",s.DRAG_OVER="tauri://drag-over",s.DRAG_DROP="tauri://drag-drop",s.DRAG_LEAVE="tauri://drag-leave"})(ue||(ue={}));async function ja(s,t){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(s,t),await y("plugin:event|unlisten",{event:s,eventId:t})}async function At(s,t,a){var n;const r=typeof a?.target=="string"?{kind:"AnyLabel",label:a.target}:(n=a?.target)!==null&&n!==void 0?n:{kind:"Any"};return y("plugin:event|listen",{event:s,target:r,handler:an(t)}).then(o=>async()=>ja(s,o))}async function is(s,t,a){return At(s,n=>{ja(s,n.id),t(n)},a)}async function va(s,t){await y("plugin:event|emit",{event:s,payload:t})}async function ka(s,t,a){await y("plugin:event|emit_to",{target:typeof s=="string"?{kind:"AnyLabel",label:s}:s,event:t,payload:a})}class ut extends nn{constructor(t){super(t)}static async new(t,a,n){return y("plugin:image|new",{rgba:Lt(t),width:a,height:n}).then(r=>new ut(r))}static async fromBytes(t){return y("plugin:image|from_bytes",{bytes:Lt(t)}).then(a=>new ut(a))}static async fromPath(t){return y("plugin:image|from_path",{path:t}).then(a=>new ut(a))}async rgba(){return y("plugin:image|rgba",{rid:this.rid}).then(t=>new Uint8Array(t))}async size(){return y("plugin:image|size",{rid:this.rid})}}function Lt(s){return s==null?null:typeof s=="string"?s:s instanceof ut?s.rid:s}var Zt;(function(s){s[s.Critical=1]="Critical",s[s.Informational=2]="Informational"})(Zt||(Zt={}));class An{constructor(t){this._preventDefault=!1,this.event=t.event,this.id=t.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var Rs;(function(s){s.None="none",s.Normal="normal",s.Indeterminate="indeterminate",s.Paused="paused",s.Error="error"})(Rs||(Rs={}));function Ea(){return new Rt(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function Bt(){return y("plugin:window|get_all_windows").then(s=>s.map(t=>new Rt(t,{skip:!0})))}const $t=["tauri://created","tauri://error"];class Rt{constructor(t,a={}){var n;this.label=t,this.listeners=Object.create(null),a?.skip||y("plugin:window|create",{options:{...a,parent:typeof a.parent=="string"?a.parent:(n=a.parent)===null||n===void 0?void 0:n.label,label:t}}).then(async()=>this.emit("tauri://created")).catch(async r=>this.emit("tauri://error",r))}static async getByLabel(t){var a;return(a=(await Bt()).find(n=>n.label===t))!==null&&a!==void 0?a:null}static getCurrent(){return Ea()}static async getAll(){return Bt()}static async getFocusedWindow(){for(const t of await Bt())if(await t.isFocused())return t;return null}async listen(t,a){return this._handleTauriEvent(t,a)?()=>{const n=this.listeners[t];n.splice(n.indexOf(a),1)}:At(t,a,{target:{kind:"Window",label:this.label}})}async once(t,a){return this._handleTauriEvent(t,a)?()=>{const n=this.listeners[t];n.splice(n.indexOf(a),1)}:is(t,a,{target:{kind:"Window",label:this.label}})}async emit(t,a){if($t.includes(t)){for(const n of this.listeners[t]||[])n({event:t,id:-1,payload:a});return}return va(t,a)}async emitTo(t,a,n){if($t.includes(a)){for(const r of this.listeners[a]||[])r({event:a,id:-1,payload:n});return}return ka(t,a,n)}_handleTauriEvent(t,a){return $t.includes(t)?(t in this.listeners?this.listeners[t].push(a):this.listeners[t]=[a],!0):!1}async scaleFactor(){return y("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return y("plugin:window|inner_position",{label:this.label}).then(t=>new ye(t))}async outerPosition(){return y("plugin:window|outer_position",{label:this.label}).then(t=>new ye(t))}async innerSize(){return y("plugin:window|inner_size",{label:this.label}).then(t=>new tt(t))}async outerSize(){return y("plugin:window|outer_size",{label:this.label}).then(t=>new tt(t))}async isFullscreen(){return y("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return y("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return y("plugin:window|is_maximized",{label:this.label})}async isFocused(){return y("plugin:window|is_focused",{label:this.label})}async isDecorated(){return y("plugin:window|is_decorated",{label:this.label})}async isResizable(){return y("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return y("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return y("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return y("plugin:window|is_closable",{label:this.label})}async isVisible(){return y("plugin:window|is_visible",{label:this.label})}async title(){return y("plugin:window|title",{label:this.label})}async theme(){return y("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return y("plugin:window|is_always_on_top",{label:this.label})}async center(){return y("plugin:window|center",{label:this.label})}async requestUserAttention(t){let a=null;return t&&(t===Zt.Critical?a={type:"Critical"}:a={type:"Informational"}),y("plugin:window|request_user_attention",{label:this.label,value:a})}async setResizable(t){return y("plugin:window|set_resizable",{label:this.label,value:t})}async setEnabled(t){return y("plugin:window|set_enabled",{label:this.label,value:t})}async isEnabled(){return y("plugin:window|is_enabled",{label:this.label})}async setMaximizable(t){return y("plugin:window|set_maximizable",{label:this.label,value:t})}async setMinimizable(t){return y("plugin:window|set_minimizable",{label:this.label,value:t})}async setClosable(t){return y("plugin:window|set_closable",{label:this.label,value:t})}async setTitle(t){return y("plugin:window|set_title",{label:this.label,value:t})}async maximize(){return y("plugin:window|maximize",{label:this.label})}async unmaximize(){return y("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return y("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return y("plugin:window|minimize",{label:this.label})}async unminimize(){return y("plugin:window|unminimize",{label:this.label})}async show(){return y("plugin:window|show",{label:this.label})}async hide(){return y("plugin:window|hide",{label:this.label})}async close(){return y("plugin:window|close",{label:this.label})}async destroy(){return y("plugin:window|destroy",{label:this.label})}async setDecorations(t){return y("plugin:window|set_decorations",{label:this.label,value:t})}async setShadow(t){return y("plugin:window|set_shadow",{label:this.label,value:t})}async setEffects(t){return y("plugin:window|set_effects",{label:this.label,value:t})}async clearEffects(){return y("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(t){return y("plugin:window|set_always_on_top",{label:this.label,value:t})}async setAlwaysOnBottom(t){return y("plugin:window|set_always_on_bottom",{label:this.label,value:t})}async setContentProtected(t){return y("plugin:window|set_content_protected",{label:this.label,value:t})}async setSize(t){return y("plugin:window|set_size",{label:this.label,value:t instanceof $e?t:new $e(t)})}async setMinSize(t){return y("plugin:window|set_min_size",{label:this.label,value:t instanceof $e?t:t?new $e(t):null})}async setMaxSize(t){return y("plugin:window|set_max_size",{label:this.label,value:t instanceof $e?t:t?new $e(t):null})}async setSizeConstraints(t){function a(n){return n?{Logical:n}:null}return y("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:a(t?.minWidth),minHeight:a(t?.minHeight),maxWidth:a(t?.maxWidth),maxHeight:a(t?.maxHeight)}})}async setPosition(t){return y("plugin:window|set_position",{label:this.label,value:t instanceof et?t:new et(t)})}async setFullscreen(t){return y("plugin:window|set_fullscreen",{label:this.label,value:t})}async setFocus(){return y("plugin:window|set_focus",{label:this.label})}async setIcon(t){return y("plugin:window|set_icon",{label:this.label,value:Lt(t)})}async setSkipTaskbar(t){return y("plugin:window|set_skip_taskbar",{label:this.label,value:t})}async setCursorGrab(t){return y("plugin:window|set_cursor_grab",{label:this.label,value:t})}async setCursorVisible(t){return y("plugin:window|set_cursor_visible",{label:this.label,value:t})}async setCursorIcon(t){return y("plugin:window|set_cursor_icon",{label:this.label,value:t})}async setBackgroundColor(t){return y("plugin:window|set_background_color",{color:t})}async setCursorPosition(t){return y("plugin:window|set_cursor_position",{label:this.label,value:t instanceof et?t:new et(t)})}async setIgnoreCursorEvents(t){return y("plugin:window|set_ignore_cursor_events",{label:this.label,value:t})}async startDragging(){return y("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(t){return y("plugin:window|start_resize_dragging",{label:this.label,value:t})}async setBadgeCount(t){return y("plugin:window|set_badge_count",{label:this.label,value:t})}async setBadgeLabel(t){return y("plugin:window|set_badge_label",{label:this.label,value:t})}async setOverlayIcon(t){return y("plugin:window|set_overlay_icon",{label:this.label,value:t?Lt(t):void 0})}async setProgressBar(t){return y("plugin:window|set_progress_bar",{label:this.label,value:t})}async setVisibleOnAllWorkspaces(t){return y("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:t})}async setTitleBarStyle(t){return y("plugin:window|set_title_bar_style",{label:this.label,value:t})}async setTheme(t){return y("plugin:window|set_theme",{label:this.label,value:t})}async onResized(t){return this.listen(ue.WINDOW_RESIZED,a=>{a.payload=new tt(a.payload),t(a)})}async onMoved(t){return this.listen(ue.WINDOW_MOVED,a=>{a.payload=new ye(a.payload),t(a)})}async onCloseRequested(t){return this.listen(ue.WINDOW_CLOSE_REQUESTED,async a=>{const n=new An(a);await t(n),n.isPreventDefault()||await this.destroy()})}async onDragDropEvent(t){const a=await this.listen(ue.DRAG_ENTER,i=>{t({...i,payload:{type:"enter",paths:i.payload.paths,position:new ye(i.payload.position)}})}),n=await this.listen(ue.DRAG_OVER,i=>{t({...i,payload:{type:"over",position:new ye(i.payload.position)}})}),r=await this.listen(ue.DRAG_DROP,i=>{t({...i,payload:{type:"drop",paths:i.payload.paths,position:new ye(i.payload.position)}})}),o=await this.listen(ue.DRAG_LEAVE,i=>{t({...i,payload:{type:"leave"}})});return()=>{a(),r(),n(),o()}}async onFocusChanged(t){const a=await this.listen(ue.WINDOW_FOCUS,r=>{t({...r,payload:!0})}),n=await this.listen(ue.WINDOW_BLUR,r=>{t({...r,payload:!1})});return()=>{a(),n()}}async onScaleChanged(t){return this.listen(ue.WINDOW_SCALE_FACTOR_CHANGED,t)}async onThemeChanged(t){return this.listen(ue.WINDOW_THEME_CHANGED,t)}}var Os;(function(s){s.Disabled="disabled",s.Throttle="throttle",s.Suspend="suspend"})(Os||(Os={}));var Ds;(function(s){s.AppearanceBased="appearanceBased",s.Light="light",s.Dark="dark",s.MediumLight="mediumLight",s.UltraDark="ultraDark",s.Titlebar="titlebar",s.Selection="selection",s.Menu="menu",s.Popover="popover",s.Sidebar="sidebar",s.HeaderView="headerView",s.Sheet="sheet",s.WindowBackground="windowBackground",s.HudWindow="hudWindow",s.FullScreenUI="fullScreenUI",s.Tooltip="tooltip",s.ContentBackground="contentBackground",s.UnderWindowBackground="underWindowBackground",s.UnderPageBackground="underPageBackground",s.Mica="mica",s.Blur="blur",s.Acrylic="acrylic",s.Tabbed="tabbed",s.TabbedDark="tabbedDark",s.TabbedLight="tabbedLight"})(Ds||(Ds={}));var Is;(function(s){s.FollowsWindowActiveState="followsWindowActiveState",s.Active="active",s.Inactive="inactive"})(Is||(Is={}));function _a(){return new ls(Ea(),window.__TAURI_INTERNALS__.metadata.currentWebview.label,{skip:!0})}async function Fs(){return y("plugin:webview|get_all_webviews").then(s=>s.map(t=>new ls(new Rt(t.windowLabel,{skip:!0}),t.label,{skip:!0})))}const Pt=["tauri://created","tauri://error"];class ls{constructor(t,a,n){this.window=t,this.label=a,this.listeners=Object.create(null),n?.skip||y("plugin:webview|create_webview",{windowLabel:t.label,options:{...n,label:a}}).then(async()=>this.emit("tauri://created")).catch(async r=>this.emit("tauri://error",r))}static async getByLabel(t){var a;return(a=(await Fs()).find(n=>n.label===t))!==null&&a!==void 0?a:null}static getCurrent(){return _a()}static async getAll(){return Fs()}async listen(t,a){return this._handleTauriEvent(t,a)?()=>{const n=this.listeners[t];n.splice(n.indexOf(a),1)}:At(t,a,{target:{kind:"Webview",label:this.label}})}async once(t,a){return this._handleTauriEvent(t,a)?()=>{const n=this.listeners[t];n.splice(n.indexOf(a),1)}:is(t,a,{target:{kind:"Webview",label:this.label}})}async emit(t,a){if(Pt.includes(t)){for(const n of this.listeners[t]||[])n({event:t,id:-1,payload:a});return}return va(t,a)}async emitTo(t,a,n){if(Pt.includes(a)){for(const r of this.listeners[a]||[])r({event:a,id:-1,payload:n});return}return ka(t,a,n)}_handleTauriEvent(t,a){return Pt.includes(t)?(t in this.listeners?this.listeners[t].push(a):this.listeners[t]=[a],!0):!1}async position(){return y("plugin:webview|webview_position",{label:this.label}).then(t=>new ye(t))}async size(){return y("plugin:webview|webview_size",{label:this.label}).then(t=>new tt(t))}async close(){return y("plugin:webview|webview_close",{label:this.label})}async setSize(t){return y("plugin:webview|set_webview_size",{label:this.label,value:t instanceof $e?t:new $e(t)})}async setPosition(t){return y("plugin:webview|set_webview_position",{label:this.label,value:t instanceof et?t:new et(t)})}async setFocus(){return y("plugin:webview|set_webview_focus",{label:this.label})}async setAutoResize(t){return y("plugin:webview|set_webview_auto_resize",{label:this.label,value:t})}async hide(){return y("plugin:webview|webview_hide",{label:this.label})}async show(){return y("plugin:webview|webview_show",{label:this.label})}async setZoom(t){return y("plugin:webview|set_webview_zoom",{label:this.label,value:t})}async reparent(t){return y("plugin:webview|reparent",{label:this.label,window:typeof t=="string"?t:t.label})}async clearAllBrowsingData(){return y("plugin:webview|clear_all_browsing_data")}async setBackgroundColor(t){return y("plugin:webview|set_webview_background_color",{color:t})}async onDragDropEvent(t){const a=await this.listen(ue.DRAG_ENTER,i=>{t({...i,payload:{type:"enter",paths:i.payload.paths,position:new ye(i.payload.position)}})}),n=await this.listen(ue.DRAG_OVER,i=>{t({...i,payload:{type:"over",position:new ye(i.payload.position)}})}),r=await this.listen(ue.DRAG_DROP,i=>{t({...i,payload:{type:"drop",paths:i.payload.paths,position:new ye(i.payload.position)}})}),o=await this.listen(ue.DRAG_LEAVE,i=>{t({...i,payload:{type:"leave"}})});return()=>{a(),r(),n(),o()}}}function Sa(){const s=_a();return new wt(s.label,{skip:!0})}async function Ms(){return y("plugin:window|get_all_windows").then(s=>s.map(t=>new wt(t,{skip:!0})))}class wt{constructor(t,a={}){var n;this.label=t,this.listeners=Object.create(null),a?.skip||y("plugin:webview|create_webview_window",{options:{...a,parent:typeof a.parent=="string"?a.parent:(n=a.parent)===null||n===void 0?void 0:n.label,label:t}}).then(async()=>this.emit("tauri://created")).catch(async r=>this.emit("tauri://error",r))}static async getByLabel(t){var a;const n=(a=(await Ms()).find(r=>r.label===t))!==null&&a!==void 0?a:null;return n?new wt(n.label,{skip:!0}):null}static getCurrent(){return Sa()}static async getAll(){return Ms()}async listen(t,a){return this._handleTauriEvent(t,a)?()=>{const n=this.listeners[t];n.splice(n.indexOf(a),1)}:At(t,a,{target:{kind:"WebviewWindow",label:this.label}})}async once(t,a){return this._handleTauriEvent(t,a)?()=>{const n=this.listeners[t];n.splice(n.indexOf(a),1)}:is(t,a,{target:{kind:"WebviewWindow",label:this.label}})}async setBackgroundColor(t){return y("plugin:window|set_background_color",{color:t}).then(()=>y("plugin:webview|set_webview_background_color",{color:t}))}}Rn(wt,[Rt,ls]);function Rn(s,t){(Array.isArray(t)?t:[t]).forEach(a=>{Object.getOwnPropertyNames(a.prototype).forEach(n=>{var r;typeof s.prototype=="object"&&s.prototype&&n in s.prototype||Object.defineProperty(s.prototype,n,(r=Object.getOwnPropertyDescriptor(a.prototype,n))!==null&&r!==void 0?r:Object.create(null))})})}const On=Ws(document.getElementById("root"));On.render(e.jsx(es.StrictMode,{children:e.jsx(Ln,{})}));queueMicrotask(()=>{try{const s=Sa?.();s&&typeof s.show=="function"&&requestAnimationFrame(()=>requestAnimationFrame(()=>{s.show()}))}catch{}});export{y as i};
